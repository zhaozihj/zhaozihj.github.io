

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  
    <meta name="description" content="DAY1f12之后那个网络是当前页面发起的请求 你可以点击那个小删除号，删除页面上那些静态资源请求，然后点击一个按钮，这时候出现的请求就是这个按钮对应的请求，但如果按了之后跳转了页面(也就是刷新了页面)，则这个请求可能会很快消失，显示的会是跳转过去后那个页面的请求 瑞吉外卖项目springBoot +ssm企业级项目 前置知识：Java基础知识 ​                   javawe">
<meta property="og:type" content="article">
<meta property="og:title" content="瑞吉外卖项目">
<meta property="og:url" content="http://example.com/2022/09/29/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E9%A1%B9%E7%9B%AE/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="DAY1f12之后那个网络是当前页面发起的请求 你可以点击那个小删除号，删除页面上那些静态资源请求，然后点击一个按钮，这时候出现的请求就是这个按钮对应的请求，但如果按了之后跳转了页面(也就是刷新了页面)，则这个请求可能会很快消失，显示的会是跳转过去后那个页面的请求 瑞吉外卖项目springBoot +ssm企业级项目 前置知识：Java基础知识 ​                   javawe">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/img/miaowazhongzi.jpg">
<meta property="article:published_time" content="2022-09-29T15:31:35.000Z">
<meta property="article:modified_time" content="2023-04-10T13:01:13.407Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/img/miaowazhongzi.jpg">
  
  
  
  <title>瑞吉外卖项目 - Hexo</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.3","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg","onlypost":true,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>java宝库</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                About
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="瑞吉外卖项目"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-09-29 23:31" pubdate>
          September 29, 2022 pm
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          149k words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          1244 mins
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">瑞吉外卖项目</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="DAY1"><a href="#DAY1" class="headerlink" title="DAY1"></a>DAY1</h1><p>f12之后那个网络是当前页面发起的请求</p>
<p>你可以点击那个小删除号，删除页面上那些静态资源请求，然后点击一个按钮，这时候出现的请求就是这个按钮对应的请求，但如果按了之后跳转了页面(也就是刷新了页面)，则这个请求可能会很快消失，显示的会是跳转过去后那个页面的请求</p>
<h1 id="瑞吉外卖项目"><a href="#瑞吉外卖项目" class="headerlink" title="瑞吉外卖项目"></a>瑞吉外卖项目</h1><p>springBoot +ssm企业级项目</p>
<p>前置知识：Java基础知识</p>
<p>​                   javaweb</p>
<p>​                    MySql</p>
<p>​                     SpringBoot</p>
<p>​                    SSM（Spring，SpringMVC，Mybatis）</p>
<p>​                   Maven</p>
<p>软件开发整体介绍</p>
<p>需求分析–》设计–》编码–》测试–》上线运维</p>
<p><img src="D:\img\202211241031498.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221124103157501"></p>
<p>角色分工</p>
<p><img src="D:\img\202211241036755.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221124103619974"></p>
<p>软件环境：</p>
<p>开发环境：开发人员在开发阶段使用的环境（本地或者专门一台服务器），一般外部用户无法访问</p>
<p>测试环境：专门给测试人员使用的环境，用于测试项目，一班外部用户无法访问</p>
<h2 id="项目整体介绍"><a href="#项目整体介绍" class="headerlink" title="项目整体介绍"></a>项目整体介绍</h2><p><img src="D:\img\202211241111204.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221124111119307"></p>
<p>技术选型</p>
<p><img src="D:\img\202211241113026.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221124111355260"></p>
<p>功能开发</p>
<p><img src="D:\img\202211241116825.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221124111634127"></p>
<p><img src="D:\img\202211241125637.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221124112505492"></p>
<p>这个是角色需求</p>
<h2 id="数据库环境搭建"><a href="#数据库环境搭建" class="headerlink" title="数据库环境搭建"></a>数据库环境搭建</h2><p>mysql默认编码是utf-8</p>
<p>创建数据库 ，设置字符集为 utf8mb4这个是utf8的一个超集兼容utf-8</p>
<p>character前面还可以加一个default</p>
<p>create database reggle character set utf8mb4; </p>
<p>资料中提供了sql语句，可以点开navicat，右键数据库，点击运行sql文件，然后导入所有的表</p>
<p>数据库中的用户密码要转换为md5加密格式</p>
<p><img src="D:\img\202211241945253.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221124194513152"></p>
<h2 id="创建maven工程"><a href="#创建maven工程" class="headerlink" title="创建maven工程"></a>创建maven工程</h2><p>创建工程后，配置maven环境</p>
<p><img src="D:\img\202211241501286.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221124150057982"></p>
<p>pom.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.4.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>/&gt;</span> <span class="hljs-comment">&lt;!-- lookup parent from repository --&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.itheima<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>reggie_take_out<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br><br>        <span class="hljs-comment">&lt;!--springboot--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--测试场境的包--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--web场景的包--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>compile<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--mybatis--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.4.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>        <span class="hljs-comment">&lt;!--pojo快速开发包--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.18.20<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>        <span class="hljs-comment">&lt;!--将对象转json的包--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>fastjson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.76<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>        <span class="hljs-comment">&lt;!--通用语言包--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>commons-lang<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-lang<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.6<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>        <span class="hljs-comment">&lt;!---mysql驱动包--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>        <span class="hljs-comment">&lt;!--druid数据源包--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.23<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!--打包成jar包的包--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.4.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure>



<p>application.yml</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment">#tomacat端口号</span><br><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-comment">#应用的名称，不必须</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">reggie_take_out</span><br>    <span class="hljs-comment">#配置数据源为druid</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">druid:</span><br>      <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br>      <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/reggle?serverTimezone=Asia/Shanghai&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=false&amp;allowPublicKeyRetrieval=true</span><br>      <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>      <span class="hljs-attr">password:</span> <span class="hljs-string">root</span><br><span class="hljs-attr">mybatis-plus:</span><br>  <span class="hljs-attr">configuration:</span><br>    <span class="hljs-comment">#在映射实体或者属性时，将数据库中表名和字段名中的下划线去掉，按照驼峰命名法映射</span><br>    <span class="hljs-attr">map-underscore-to-camel-case:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">log-impl:</span> <span class="hljs-string">org.apache.ibatis.logging.stdout.StdOutImpl</span><br>  <span class="hljs-attr">global-config:</span><br>    <span class="hljs-attr">db-config:</span><br>      <span class="hljs-attr">id-type:</span> <span class="hljs-string">ASSIGN_ID</span><br></code></pre></td></tr></table></figure>

<p>下面截图是项目的文件架构，以及创建的springboot主程序类</p>
<p><img src="D:\img\202211241543291.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221124154314925"></p>
<p>进行静态资源的配置</p>
<p>在config包下创建WebMvcConfig配置类（也可以用yml文件）</p>
<p><strong>用了这个配置类（继承WebMvcConfigurationSupport）之后，springboot对springmvc相关的自动配置都不会实现了，视图解析器，静态资源路径之类的</strong></p>
<p><strong>Spring Boot中只能有一个WebMvcConfigurationSupport配置类是真正起作用的，对于这个问题，其实可以通过<code>implements WebMvcConfigurer</code>来解决，多个不同的类实现这个接口后的配置都可以正常运行。</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.config;<br><br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurationSupport;<br><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebMvcConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">WebMvcConfigurationSupport</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addResourceHandlers</span><span class="hljs-params">(ResourceHandlerRegistry registry)</span> &#123;<br>        log.info(<span class="hljs-string">&quot;开始进行静态资源映射&quot;</span>);<br>        <span class="hljs-comment">//这个的意思是  /backend/**请求对应到 类路径下的backend文件夹下的资源</span><br>        registry.addResourceHandler(<span class="hljs-string">&quot;/backend/**&quot;</span>).addResourceLocations(<span class="hljs-string">&quot;classpath:backend/&quot;</span>);<br>        registry.addResourceHandler(<span class="hljs-string">&quot;/front/**&quot;</span>).addResourceLocations(<span class="hljs-string">&quot;classpath:front/&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p>也可以用类来继承WebMvcConfigurer</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.config;<br><br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurationSupport;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;<br><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebMvcConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span> &#123;<br><br>    <span class="hljs-comment">//配置拦截器</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addInterceptors</span><span class="hljs-params">(InterceptorRegistry registry)</span> &#123;<br>        registry.addInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LoginInterceptor</span>())<br>                .addPathPatterns(<span class="hljs-string">&quot;/**&quot;</span>)  <span class="hljs-comment">//所有请求都被拦截包括静态资源</span><br>                .excludePathPatterns(<span class="hljs-string">&quot;/employee/login&quot;</span>,<span class="hljs-string">&quot;/employee/logout&quot;</span>,<span class="hljs-string">&quot;/backend/**&quot;</span>,<span class="hljs-string">&quot;/front/**&quot;</span>); <span class="hljs-comment">//放行的请求</span><br>    &#125;<br><br>    <span class="hljs-comment">//配置静态资源的映射</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addResourceHandlers</span><span class="hljs-params">(ResourceHandlerRegistry registry)</span> &#123;<br>        log.info(<span class="hljs-string">&quot;开始进行静态资源映射&quot;</span>);<br>        <span class="hljs-comment">//这个的意思是  /backend/**请求对应到 类路径下的backend文件夹下的资源</span><br>        registry.addResourceHandler(<span class="hljs-string">&quot;/backend/**&quot;</span>).addResourceLocations(<span class="hljs-string">&quot;classpath:backend/&quot;</span>);<br>        registry.addResourceHandler(<span class="hljs-string">&quot;/front/**&quot;</span>).addResourceLocations(<span class="hljs-string">&quot;classpath:front/&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>





<h2 id="后台登陆功能开发"><a href="#后台登陆功能开发" class="headerlink" title="后台登陆功能开发"></a>后台登陆功能开发</h2><p>需求分析  代码开发   功能测试</p>
<p>Employee类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.entity;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.FieldFill;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.TableField;<br><span class="hljs-keyword">import</span> lombok.Data;<br><span class="hljs-keyword">import</span> java.io.Serializable;<br><span class="hljs-keyword">import</span> java.time.LocalDateTime;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">员工实体类</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Employee</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">1L</span>;<br><br>    <span class="hljs-keyword">private</span> Long id;<br><br>    <span class="hljs-keyword">private</span> String username;<br><br>    <span class="hljs-keyword">private</span> String name;<br><br>    <span class="hljs-keyword">private</span> String password;<br><br>    <span class="hljs-keyword">private</span> String phone;<br><br>    <span class="hljs-keyword">private</span> String sex;<br><br>    <span class="hljs-keyword">private</span> String idNumber;<br><br>    <span class="hljs-keyword">private</span> Integer status;<br><br>    <span class="hljs-comment">//驼峰命名法和数据库表中的字段名相对应</span><br>    <span class="hljs-keyword">private</span> LocalDateTime createTime;<br><br>    <span class="hljs-keyword">private</span> LocalDateTime updateTime;<br><br>    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT)</span><br>    <span class="hljs-keyword">private</span> Long createUser;<br><br>    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span><br>    <span class="hljs-keyword">private</span> Long updateUser;<br><br>&#125;<br></code></pre></td></tr></table></figure>







<p>R这是一个公共类，专门作为返回值的，用户后端往前端返回数据的时候用的</p>
<p>springboot中，后端往前端返回java对象默认就是返回json对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.common;<br><br><span class="hljs-keyword">import</span> lombok.Data;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">R</span>&lt;T&gt; &#123;<br><br>    <span class="hljs-keyword">private</span> Integer code; <span class="hljs-comment">//编码：1成功，0和其它数字为失败</span><br><br>    <span class="hljs-keyword">private</span> String msg; <span class="hljs-comment">//错误信息</span><br><br>    <span class="hljs-keyword">private</span> T data; <span class="hljs-comment">//数据，就是查询到的实体类</span><br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Map</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>(); <span class="hljs-comment">//动态数据</span><br><br>    <span class="hljs-comment">//静态方法，当登陆成功可以调用来获得R对象，将查询得到的实体类作为方法参数</span><br>    <span class="hljs-comment">//R调用这个方法就可以获得R对象</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; R&lt;T&gt; <span class="hljs-title function_">success</span><span class="hljs-params">(T object)</span> &#123;<br>        R&lt;T&gt; r = <span class="hljs-keyword">new</span> <span class="hljs-title class_">R</span>&lt;T&gt;();<br>        r.data = object;<br>        r.code = <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">return</span> r;<br>    &#125;<br><br>       <span class="hljs-comment">//静态方法，当登陆失败可以调用来获得R对象，将错误信息作为方法参数</span><br>    <span class="hljs-comment">//R调用这个方法就可以获得R对象</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; R&lt;T&gt; <span class="hljs-title function_">error</span><span class="hljs-params">(String msg)</span> &#123;<br>        <span class="hljs-type">R</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">R</span>();<br>        r.msg = msg;<br>        r.code = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">return</span> r;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> R&lt;T&gt; <span class="hljs-title function_">add</span><span class="hljs-params">(String key, Object value)</span> &#123;<br>        <span class="hljs-built_in">this</span>.map.put(key, value);<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>使用R的原因：</p>
<p>返回的实体类中要有data属性，msg属性，code属性，所以直接给他集中到R类里</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs javascript">  <span class="hljs-attr">methods</span>: &#123;<br>    <span class="hljs-comment">//当点击登录键的时候会调用这个handleLogin方法，校验后会发起请求</span><br>    <span class="hljs-keyword">async</span> <span class="hljs-title function_">handleLogin</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">$refs</span>.<span class="hljs-property">loginForm</span>.<span class="hljs-title function_">validate</span>(<span class="hljs-keyword">async</span> (valid) =&gt; &#123;<br>        <span class="hljs-comment">//校验</span><br>        <span class="hljs-keyword">if</span> (valid) &#123;<br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span> = <span class="hljs-literal">true</span><br>          <span class="hljs-comment">//发送请求，res就是请求的返回值</span><br>          <span class="hljs-comment">//通过res.code,res.data,res.msg来获取值</span><br>          <span class="hljs-keyword">let</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">loginApi</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">loginForm</span>)<br>          <span class="hljs-keyword">if</span> (<span class="hljs-title class_">String</span>(res.<span class="hljs-property">code</span>) === <span class="hljs-string">&#x27;1&#x27;</span>) &#123;<br>            <span class="hljs-comment">//可以把员工的信息，员工实体放到data，前端页面把他转为json，存储到浏览器当中</span><br>            <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&#x27;userInfo&#x27;</span>,<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(res.<span class="hljs-property">data</span>))<br>            <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>= <span class="hljs-string">&#x27;/backend/index.html&#x27;</span><br>          &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">//这个msg是错误信息</span><br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(res.<span class="hljs-property">msg</span>)<br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span> = <span class="hljs-literal">false</span><br>          &#125;<br>        &#125;<br>      &#125;)<br>    &#125;<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>





<p><img src="D:\img\202211241945687.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221124194551823"></p>
<p>这个是全部文件的形式</p>
<p>点击登录之后，出现的请i求url的路径，决定了那个controller中的路径规定</p>
<p><img src="D:\img\202211241947364.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221124194701280"></p>
<p>这个是根据前端发起的是ajax请求，用的是data所以是以json字符串格式返回数据决定了后台接收参数时要用@RequestBody</p>
<p><img src="D:\img\202211241948092.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221124194809817"></p>
<p>Controller中登录方法的开发流程</p>
<p><img src="D:\img\202211241955314.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221124195531164"></p>
<p>EmployeeController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.controller;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;<br><span class="hljs-keyword">import</span> com.itheima.reggie.common.R;<br><span class="hljs-keyword">import</span> com.itheima.reggie.entity.Employee;<br><span class="hljs-keyword">import</span> com.itheima.reggie.service.EmployeeService;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.util.DigestUtils;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PostMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestBody;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpSession;<br><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/employee&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EmployeeController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> EmployeeService employeeService;<br><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    登录功能</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-comment">//加上外面类的实际就是/employee/login</span><br>    <span class="hljs-comment">//这个是根据点击登陆后url得到的</span><br>    <span class="hljs-meta">@PostMapping(&quot;/login&quot;)</span><br>    <span class="hljs-comment">//这里使用@RequestBody是因为前端用ajax请求以json字符串格式发送数据</span><br>    <span class="hljs-keyword">public</span> R&lt;Employee&gt; <span class="hljs-title function_">login</span><span class="hljs-params">(HttpServletRequest request, <span class="hljs-meta">@RequestBody</span> Employee employee)</span><br>    &#123;<br>        <span class="hljs-comment">//   1.将页面提交的密码password进行md5加密处理</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">password</span> <span class="hljs-operator">=</span> employee.getPassword();<br>        password= DigestUtils.md5DigestAsHex(password.getBytes());<br>        <span class="hljs-comment">// 2.根据页面提交的用户名username查询数据库</span><br>        LambdaQueryWrapper&lt;Employee&gt; lambdaQueryWrapper=<span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>        <span class="hljs-comment">//eq方法是判断这个有没有username是等于第二个参数的</span><br>        lambdaQueryWrapper.eq(Employee::getUsername,employee.getUsername());<br>        <span class="hljs-comment">//数据库中设置username的时候，设置的是unique，所以最多只有一条，所以可以用getOne()方法</span><br>        <span class="hljs-type">Employee</span> <span class="hljs-variable">one</span> <span class="hljs-operator">=</span> employeeService.getOne(lambdaQueryWrapper);<br><br>        <span class="hljs-comment">//3.如果没有查询到则返回登陆失败结果</span><br>        <span class="hljs-comment">//这个R.error就可以创建一个R对象，详情见R类那</span><br>        <span class="hljs-keyword">if</span>(one==<span class="hljs-literal">null</span>)&#123;<br>            <span class="hljs-keyword">return</span> R.error(<span class="hljs-string">&quot;用户名不存在&quot;</span>);<br>        &#125;<br>        <span class="hljs-comment">// 4.密码比对，如果不一致则返回登陆失败结果</span><br>        <span class="hljs-keyword">if</span>(!one.getPassword().equals(password))&#123;<br>            <span class="hljs-keyword">return</span> R.error(<span class="hljs-string">&quot;密码错误&quot;</span>);<br>        &#125;<br>        <span class="hljs-comment">//    5.查看员工状态，如果为已禁用状态，则返回员工已禁用结果</span><br>        <span class="hljs-keyword">if</span>(one.getStatus()==<span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-keyword">return</span> R.error(<span class="hljs-string">&quot;员工已被禁用&quot;</span>);<br>        &#125;<br>        <span class="hljs-comment">//        6.登陆成功，将员工id存入Session并返回登陆成功结果</span><br>        <span class="hljs-comment">//这里存的一定是数据库中查找出来的那个对象的id</span><br>        request.getSession().setAttribute(<span class="hljs-string">&quot;employee&quot;</span>,one.getId());<br>        <span class="hljs-keyword">return</span> R.success(one);<br><br>    &#125;<br><br><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    登出功能</span><br><span class="hljs-comment">     */</span><br><span class="hljs-meta">@PostMapping(&quot;/logout&quot;)</span><br>    <span class="hljs-keyword">public</span> R&lt;String&gt; <span class="hljs-title function_">logout</span><span class="hljs-params">(HttpServletRequest request)</span>&#123;<br>        <span class="hljs-comment">//1.清理Session中的用户id</span><br>    <span class="hljs-type">HttpSession</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> request.getSession();<br>      session.removeAttribute(<span class="hljs-string">&quot;employee&quot;</span>);<br><br>      <span class="hljs-comment">//2.返回结果</span><br>    <span class="hljs-keyword">return</span> R.success(<span class="hljs-string">&quot;退出成功&quot;</span>);<br>&#125;<br><br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">新增员工</span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">//路径是/employee所以不用加</span><br><span class="hljs-meta">@PostMapping</span><br><span class="hljs-comment">//@RequestBody接受json数据格式</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveEmployee</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Employee employee)</span>&#123;<br>    log.info(<span class="hljs-string">&quot;员工信息:&#123;&#125;&quot;</span>,employee.toString());<br>&#125;<br><br><br><br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>EmployeeService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.service;<br><br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;<br><span class="hljs-keyword">import</span> com.itheima.reggie.entity.Employee;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">EmployeeService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">IService</span>&lt;Employee&gt; &#123;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>EmployeeServiceImpl</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">package</span> com.itheima.reggie.service.impl;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.<span class="hljs-type">ServiceImpl</span>;<br><span class="hljs-keyword">import</span> com.itheima.reggie.entity.<span class="hljs-type">Employee</span>;<br><span class="hljs-keyword">import</span> com.itheima.reggie.mapper.<span class="hljs-type">EmployeeMapper</span>;<br><span class="hljs-keyword">import</span> com.itheima.reggie.service.<span class="hljs-type">EmployeeService</span>;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.<span class="hljs-type">Service</span>;<br><br><span class="hljs-meta">@Service</span><br>public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EmployeeServiceImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ServiceImpl&lt;EmployeeMapper</span>, <span class="hljs-title">Employee&gt;</span> <span class="hljs-title">implements</span> <span class="hljs-title">EmployeeService</span> </span>&#123;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>EmployeeMapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.mapper;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;<br><span class="hljs-keyword">import</span> com.itheima.reggie.entity.Employee;<br><span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Mapper;<br><br><span class="hljs-meta">@Mapper</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">EmployeeMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseMapper</span>&lt;Employee&gt; &#123;<br>&#125;<br></code></pre></td></tr></table></figure>



<p>request.js中，把超时时间设置大一点，设置断点调试就不会超时了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js">(<span class="hljs-keyword">function</span> (<span class="hljs-params">win</span>) &#123;<br>  axios.<span class="hljs-property">defaults</span>.<span class="hljs-property">headers</span>[<span class="hljs-string">&#x27;Content-Type&#x27;</span>] = <span class="hljs-string">&#x27;application/json;charset=utf-8&#x27;</span><br>  <span class="hljs-comment">// 创建axios实例</span><br>  <span class="hljs-keyword">const</span> service = axios.<span class="hljs-title function_">create</span>(&#123;<br>    <span class="hljs-comment">// axios中请求配置有baseURL选项，表示请求URL公共部分</span><br>    <span class="hljs-attr">baseURL</span>: <span class="hljs-string">&#x27;/&#x27;</span>,<br>    <span class="hljs-comment">// 超时</span><br>    <span class="hljs-attr">timeout</span>: <span class="hljs-number">1000000</span><br>  &#125;)<br></code></pre></td></tr></table></figure>



<p>登陆成功</p>
<p>把返回到json对象转换为json字符串，存储在浏览器上，可以通过图片方式查看</p>
<p>​            localStorage.setItem(‘userInfo’,JSON.stringify(res.data))</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-attr">methods</span>: &#123;<br>    <span class="hljs-comment">//当点击登录键的时候会调用这个handleLogin方法，校验后会发起请求</span><br>    <span class="hljs-keyword">async</span> <span class="hljs-title function_">handleLogin</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">$refs</span>.<span class="hljs-property">loginForm</span>.<span class="hljs-title function_">validate</span>(<span class="hljs-keyword">async</span> (valid) =&gt; &#123;<br>        <span class="hljs-comment">//校验</span><br>        <span class="hljs-keyword">if</span> (valid) &#123;<br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span> = <span class="hljs-literal">true</span><br>          <span class="hljs-comment">//发送请求，res就是请求的返回值</span><br>          <span class="hljs-comment">//通过res.code,res.data,res.msg来获取值</span><br>          <span class="hljs-keyword">let</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">loginApi</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">loginForm</span>)<br>          <span class="hljs-keyword">if</span> (<span class="hljs-title class_">String</span>(res.<span class="hljs-property">code</span>) === <span class="hljs-string">&#x27;1&#x27;</span>) &#123;<br>            <span class="hljs-comment">//可以把员工的信息，员工实体放到data，前端页面把他转为json，存储到浏览器当中</span><br>            <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&#x27;userInfo&#x27;</span>,<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(res.<span class="hljs-property">data</span>))<br>            <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>= <span class="hljs-string">&#x27;/backend/index.html&#x27;</span><br>          &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">//这个msg是错误信息</span><br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(res.<span class="hljs-property">msg</span>)<br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span> = <span class="hljs-literal">false</span><br>          &#125;<br>        &#125;<br>      &#125;)<br>    &#125;<br>  &#125;<br>&#125;)<br><br><br></code></pre></td></tr></table></figure>

<p><img src="D:\img\202211242143631.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221124214316801"></p>
<h2 id="后台退出功能开发"><a href="#后台退出功能开发" class="headerlink" title="后台退出功能开发"></a>后台退出功能开发</h2><p>一点击这个退出按钮，就会调用这个方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">methods</span>: &#123;<br>  <span class="hljs-title function_">logout</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">logoutApi</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>)=&gt;</span>&#123;<br>      <span class="hljs-keyword">if</span>(res.<span class="hljs-property">code</span> === <span class="hljs-number">1</span>)&#123;<br>        <span class="hljs-comment">//从浏览器中移除userInfo</span><br>        <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">removeItem</span>(<span class="hljs-string">&#x27;userInfo&#x27;</span>)<br>      <span class="hljs-comment">//跳转到登陆界面</span><br>        <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span> = <span class="hljs-string">&#x27;/backend/page/login/login.html&#x27;</span><br>      &#125;<br>    &#125;)<br>  &#125;,<br></code></pre></td></tr></table></figure>

<p>看发起的请求，点击退出键之后，的请求路径，以及请求方式等等，都能用f12网络看出来</p>
<p><a target="_blank" rel="noopener" href="http://localhost:8080/employee/logout">http://localhost:8080/employee/logout</a></p>
<p><img src="D:\img\202211251445142.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221125144516242">**</p>
<p>Controller的编写思路</p>
<p><img src="D:\img\202211251447498.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221125144701461"></p>
<p>index.html</p>
<p>userInfo对象的由来</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-comment">//当vue对象创建调用这个方法的时候，浏览器获取userInfo对象</span><br><span class="hljs-function"><span class="hljs-title">created</span><span class="hljs-params">()</span></span> &#123;<br>  const userInfo = window<span class="hljs-selector-class">.localStorage</span><span class="hljs-selector-class">.getItem</span>(<span class="hljs-string">&#x27;userInfo&#x27;</span>)<br>  <span class="hljs-keyword">if</span> (userInfo) &#123;<br>    <span class="hljs-comment">//将userInfojson字符串转为json对象</span><br>    this<span class="hljs-selector-class">.userInfo</span> = JSON<span class="hljs-selector-class">.parse</span>(userInfo)<br>  &#125;<br>  this<span class="hljs-selector-class">.closeLoading</span>()<br>&#125;,<br></code></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;right-menu&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;avatar-wrapper&quot;</span>&gt;</span>&#123;&#123; userInfo.name &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-comment">&lt;!-- &lt;div class=&quot;logout&quot; @click=&quot;logout&quot;&gt;退出&lt;/div&gt; --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;images/icons/btn_close@2x.png&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;outLogin&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;退出&quot;</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;logout&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>这个userInfo.name显示的是页面上这个，也就是登路后存储的实体类信息，的name属性</p>
<p><img src="D:\img\202211251450997.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221125145043949"></p>
<p>Controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@PostMapping(&quot;/logout&quot;)</span><br>    <span class="hljs-keyword">public</span> R&lt;String&gt; <span class="hljs-title function_">logout</span><span class="hljs-params">(HttpServletRequest request)</span>&#123;<br>        <span class="hljs-comment">//1.清理Session中的用户id</span><br>    <span class="hljs-type">HttpSession</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> request.getSession();<br>      session.removeAttribute(<span class="hljs-string">&quot;employee&quot;</span>);<br><br>      <span class="hljs-comment">//2.返回结果</span><br>    <span class="hljs-keyword">return</span> R.success(<span class="hljs-string">&quot;退出成功&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>



<p>index.html分析</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">iframe</span></span><br><span class="hljs-tag">  <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;cIframe&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;c_iframe&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;cIframe&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">:src</span>=<span class="hljs-string">&quot;iframeUrl&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;100%&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">height</span>=<span class="hljs-string">&quot;auto&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">frameborder</span>=<span class="hljs-string">&quot;0&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">v-show</span>=<span class="hljs-string">&quot;!loading&quot;</span></span><br><span class="hljs-tag">&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">iframe</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>这个iframe标签就是左边栏右边的那一页面，每次点击左边栏的时候，iframeUrl机会改变，所以右边页面会变</p>
<p>点击调用menuHandle方法改iframeUrl</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs html">menuHandle(item, goBackFlag) &#123;<br>  this.loading = true<br>  this.menuActived = item.id<br>  this.iframeUrl = item.url<br>  this.headTitle = item.name<br>  this.goBackFlag = goBackFlag<br>  this.closeLoading()<br>&#125;,<br></code></pre></td></tr></table></figure>

<p><img src="D:\img\202211251503468.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221125150301408"></p>
<p>默认的iframeUrl和menuList</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs html">  defAct: &#x27;2&#x27;,<br>  menuActived: &#x27;2&#x27;,<br>  userInfo: &#123;&#125;,<br>  menuList: [<br>    // &#123;<br>    //   id: &#x27;1&#x27;,<br>    //   name: &#x27;门店管理&#x27;,<br>    //   children: [<br>        &#123;<br>          id: &#x27;2&#x27;,<br>          name: &#x27;员工管理&#x27;,<br>          url: &#x27;page/member/list.html&#x27;,<br>          icon: &#x27;icon-member&#x27;<br>        &#125;,<br>        &#123;<br>          id: &#x27;3&#x27;,<br>          name: &#x27;分类管理&#x27;,<br>          url: &#x27;page/category/list.html&#x27;,<br>          icon: &#x27;icon-category&#x27;<br>        &#125;,<br>        &#123;<br>          id: &#x27;4&#x27;,<br>          name: &#x27;菜品管理&#x27;,<br>          url: &#x27;page/food/list.html&#x27;,<br>          icon: &#x27;icon-food&#x27;<br>        &#125;,<br>        &#123;<br>          id: &#x27;5&#x27;,<br>          name: &#x27;套餐管理&#x27;,<br>          url: &#x27;page/combo/list.html&#x27;,<br>          icon: &#x27;icon-combo&#x27;<br>        &#125;,<br>        &#123;<br>          id: &#x27;6&#x27;,<br>          name: &#x27;订单明细&#x27;,<br>          url: &#x27;page/order/list.html&#x27;,<br>          icon: &#x27;icon-order&#x27;<br>        &#125;<br>    //   ],<br>    // &#125;,<br>  ],<br>  iframeUrl: &#x27;page/member/list.html&#x27;,<br>  headTitle: &#x27;员工管理&#x27;,<br>  goBackFlag: false,<br>  loading: true,<br>  timer: null<br>&#125;<br></code></pre></td></tr></table></figure>

<p>显示上面图片左边的栏</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;item in menuList&quot;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;item.id&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">el-submenu</span> <span class="hljs-attr">:index</span>=<span class="hljs-string">&quot;item.id&quot;</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">&quot;item.children &amp;&amp; item.children.length&gt;0&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">slot</span>=<span class="hljs-string">&quot;title&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;iconfont&quot;</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">&quot;item.icon&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>&#123;&#123;item.name&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h1 id="Day2"><a href="#Day2" class="headerlink" title="Day2"></a>Day2</h1><p>这个当中有多个工具类，类似于mvc包中的BeanUtils，javautil包中的UUID这里面都有类似的工具</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--有各种工具类--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>cn.hutool<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hutool-all<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.7.17<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>





<h2 id="完善登录功能"><a href="#完善登录功能" class="headerlink" title="完善登录功能"></a>完善登录功能</h2><p><strong>验证这个操作的时候记得清理缓存</strong></p>
<p><strong>当改变了前端的页面的时候都要进行一下历史纪录的清除</strong></p>
<p>保证只有登录成功之后才能到，index.html中去，没有登陆会跳转到登录页面</p>
<p>主程序</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie;<br><br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<br><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<br><span class="hljs-keyword">import</span> org.springframework.boot.web.servlet.ServletComponentScan;<br><br><span class="hljs-comment">//加入日志功能</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-comment">//使原生组件生效</span><br><span class="hljs-meta">@ServletComponentScan</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReggieApplication</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(ReggieApplication.class,args);<br>        log.info(<span class="hljs-string">&quot;项目启动成功&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p>过滤器</p>
<p>测试拦截，</p>
<p>filter包下的LoginCheckFilter类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.filter;<br><br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.boot.web.servlet.FilterRegistrationBean;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;<br><br><span class="hljs-keyword">import</span> javax.servlet.*;<br><span class="hljs-keyword">import</span> javax.servlet.annotation.WebFilter;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-comment">//拦截所有请求，拦截器名字是loginInterceptor</span><br><span class="hljs-comment">//</span><br><span class="hljs-meta">@WebFilter(filterName = &quot;loginInterceptor&quot;,urlPatterns = &quot;/*&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginCheckFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Filter</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilter</span><span class="hljs-params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="hljs-keyword">throws</span> IOException, ServletException &#123;<br>        HttpServletRequest request=(HttpServletRequest)servletRequest;<br>        HttpServletResponse response=(HttpServletResponse)servletResponse;<br>        log.info(<span class="hljs-string">&quot;拦截到请求：&#123;&#125;&quot;</span>+request.getRequestURI());<br>        filterChain.doFilter(request,response);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p>完善拦截器</p>
<p><img src="D:\img\202211251549350.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221125154926401"></p>
<p><strong>感觉很麻烦放弃了，想要自己搞一个拦截器</strong></p>
<p>mvc的配置文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.config;<br><br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurationSupport;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;<br><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebMvcConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span> &#123;<br><br>    <span class="hljs-comment">//配置拦截器</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addInterceptors</span><span class="hljs-params">(InterceptorRegistry registry)</span> &#123;<br>        registry.addInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LoginInterceptor</span>())<br>                .addPathPatterns(<span class="hljs-string">&quot;/**&quot;</span>)  <span class="hljs-comment">//所有请求都被拦截包括静态资源</span><br>                .excludePathPatterns(<span class="hljs-string">&quot;/employee/login&quot;</span>,<span class="hljs-string">&quot;/backend/**&quot;</span>,<span class="hljs-string">&quot;/front/**&quot;</span>); <span class="hljs-comment">//放行的请求</span><br>    &#125;<br><br>    <span class="hljs-comment">//配置静态资源的映射</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addResourceHandlers</span><span class="hljs-params">(ResourceHandlerRegistry registry)</span> &#123;<br>        log.info(<span class="hljs-string">&quot;开始进行静态资源映射&quot;</span>);<br>        <span class="hljs-comment">//这个的意思是  /backend/**请求对应到 类路径下的backend文件夹下的资源</span><br>        registry.addResourceHandler(<span class="hljs-string">&quot;/backend/**&quot;</span>).addResourceLocations(<span class="hljs-string">&quot;classpath:backend/&quot;</span>);<br>        registry.addResourceHandler(<span class="hljs-string">&quot;/front/**&quot;</span>).addResourceLocations(<span class="hljs-string">&quot;classpath:front/&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p>拦截器类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.config;<br><br><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;<br><span class="hljs-keyword">import</span> com.itheima.reggie.common.R;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;<br><br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpSession;<br><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>       String requestURI=request.getRequestURI();<br>       log.info(<span class="hljs-string">&quot;请求已经拦截&#123;&#125;&quot;</span>,requestURI);<br>       <span class="hljs-comment">//获取session</span><br>        <span class="hljs-type">HttpSession</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> request.getSession();<br>        <span class="hljs-comment">//获取session中employee</span><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">employee</span> <span class="hljs-operator">=</span> session.getAttribute(<span class="hljs-string">&quot;employee&quot;</span>);<br>        <span class="hljs-comment">//employee不为空就是登陆了放行</span><br>        <span class="hljs-keyword">if</span>(employee!=<span class="hljs-literal">null</span>)&#123;<br>            <span class="hljs-comment">//放行</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>  <span class="hljs-comment">//如果未登录返回未登录结果，通过输出流方式向客户端页面响应数据</span><br>        response.getWriter().write(JSON.toJSONString(R.error(<span class="hljs-string">&quot;NOLOGIN&quot;</span>)));<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br><br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>



<p>前端：</p>
<p>js文件夹下的request.js</p>
<p>前端响应拦截器，拦截后端的响应</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 响应拦截器</span><br>  service.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;<br>      <span class="hljs-comment">//如果返回的res满足这些条件可以跳转系统登录页面</span><br>      <span class="hljs-keyword">if</span> (res.<span class="hljs-property">data</span>.<span class="hljs-property">code</span> === <span class="hljs-number">0</span> &amp;&amp; res.<span class="hljs-property">data</span>.<span class="hljs-property">msg</span> === <span class="hljs-string">&#x27;NOTLOGIN&#x27;</span>) &#123;<span class="hljs-comment">// 返回登录页面</span><br>          <span class="hljs-comment">//打印日志</span><br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;---/backend/page/login/login.html---&#x27;</span>)<br>          <span class="hljs-comment">//去除浏览器userInfo</span><br>        <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">removeItem</span>(<span class="hljs-string">&#x27;userInfo&#x27;</span>)<br>          <span class="hljs-comment">//跳转系统登陆页面</span><br>        <span class="hljs-variable language_">window</span>.<span class="hljs-property">top</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span> = <span class="hljs-string">&#x27;/backend/page/login/login.html&#x27;</span><br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> res.<span class="hljs-property">data</span><br>      &#125;<br>    &#125;,<br></code></pre></td></tr></table></figure>

<p>这个res中的内容是固定的，决定了返回的内容,决定了返回的对象msg一定是NOTLOGIN，</p>
<h2 id="员工管理业务开发"><a href="#员工管理业务开发" class="headerlink" title="员工管理业务开发"></a>员工管理业务开发</h2><h3 id="新增员工"><a href="#新增员工" class="headerlink" title="新增员工"></a>新增员工</h3><p>添加员工的页面是backend&#x2F;page&#x2F;member&#x2F;add.html</p>
<p>展示员工的页面是backend&#x2F;page&#x2F;member&#x2F;list.html</p>
<p>st是add</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;el-button<br>  type=<span class="hljs-string">&quot;primary&quot;</span><br>  @click=<span class="hljs-string">&quot;addMemberHandle(&#x27;add&#x27;)&quot;</span><br>&gt;<br>  + 添加员工<br>&lt;/el-button&gt;<br></code></pre></td></tr></table></figure>



<p>addMemberHandler方法</p>
<p>st是add，能跳转到add.html</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs js"> <span class="hljs-comment">// 添加</span><br>addMemberHandle (st) &#123;<br>  <span class="hljs-keyword">if</span> (st === <span class="hljs-string">&#x27;add&#x27;</span>)&#123;<br>    <span class="hljs-variable language_">window</span>.<span class="hljs-property">parent</span>.<span class="hljs-title function_">menuHandle</span>(&#123;<br>      <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;2&#x27;</span>,<br>      <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/backend/page/member/add.html&#x27;</span>,<br>      <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;添加员工&#x27;</span><br>    &#125;,<span class="hljs-literal">true</span>)<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-variable language_">window</span>.<span class="hljs-property">parent</span>.<span class="hljs-title function_">menuHandle</span>(&#123;<br>      <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;2&#x27;</span>,<br>      <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/backend/page/member/add.html?id=&#x27;</span>+st,<br>      <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;修改员工&#x27;</span><br>    &#125;,<span class="hljs-literal">true</span>)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>这menuHandler会让首页的那个iframe变为自己的这个url</p>
<p>这个有点类似之前说的那个一进去首页，页面是员工管理那个一样</p>
<p>index.html</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">menuHandle</span>(<span class="hljs-params">item, goBackFlag</span>) &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span> = <span class="hljs-literal">true</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">menuActived</span> = item.<span class="hljs-property">id</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">iframeUrl</span> = item.<span class="hljs-property">url</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">headTitle</span> = item.<span class="hljs-property">name</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">goBackFlag</span> = goBackFlag<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">closeLoading</span>()<br>&#125;,<br></code></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">iframe</span></span><br><span class="hljs-tag">  <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;cIframe&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;c_iframe&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;cIframe&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">:src</span>=<span class="hljs-string">&quot;iframeUrl&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;100%&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">height</span>=<span class="hljs-string">&quot;auto&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">frameborder</span>=<span class="hljs-string">&quot;0&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">v-show</span>=<span class="hljs-string">&quot;!loading&quot;</span></span><br><span class="hljs-tag">&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">iframe</span>&gt;</span><br></code></pre></td></tr></table></figure>





<p>点击添加员工后会跳转到add.html</p>
<p>点add.html中的保存会发ajax请求</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 新增---添加员工</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">addEmployee</span> (params) &#123;<br>  <span class="hljs-keyword">return</span> $axios(&#123;<br>    <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/employee&#x27;</span>,<br>    <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;post&#x27;</span>,<br>    <span class="hljs-attr">data</span>: &#123; ...params &#125;<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure>





<p>上面这个结论从页面也可以获得</p>
<p><img src="D:\img\202211251858742.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221125185830833"></p>
<p><img src="D:\img\202211251858468.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221125185836609"></p>
<p>点击add.html中的保存键，就可以出现&#x2F;employee请求，以及这些payload</p>
<p>Controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">新增员工</span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">//路径是/employee所以不用加</span><br><span class="hljs-meta">@PostMapping</span><br><span class="hljs-comment">//@RequestBody接受json数据格式</span><br>    <span class="hljs-keyword">public</span> R&lt;String&gt; <span class="hljs-title function_">saveEmployee</span><span class="hljs-params">(HttpServletRequest request,<span class="hljs-meta">@RequestBody</span> Employee employee)</span>&#123;<br><br>    log.info(<span class="hljs-string">&quot;员工信息:&#123;&#125;&quot;</span>,employee.toString());<br>    <span class="hljs-comment">//设置默认密码，密码进行md5加密</span><br>    employee.setPassword(DigestUtils.md5DigestAsHex(<span class="hljs-string">&quot;123456&quot;</span>.getBytes()));<br>    <span class="hljs-comment">//设置开始创立时间</span><br>    employee.setCreateTime(LocalDateTime.now());<br>    <span class="hljs-comment">//设置更新创立时间</span><br>    employee.setUpdateTime(LocalDateTime.now());<br><br>    <span class="hljs-comment">//获取当前用登陆用户的id</span><br>    <span class="hljs-comment">//获取的默认是Object对象，进行向下转型</span><br>    <span class="hljs-type">long</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> (Long)request.getSession().getAttribute(<span class="hljs-string">&quot;employee&quot;</span>);<br>    employee.setCreateUser(id);<br>    employee.setUpdateUser(id);<br>    employeeService.save(employee);<br>    <span class="hljs-keyword">return</span> R.success(<span class="hljs-string">&quot;新增员工成功&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>如果假如两个username相同的字段，会出现500错误</p>
<h3 id="全局异常处理器"><a href="#全局异常处理器" class="headerlink" title="全局异常处理器"></a>全局异常处理器</h3><p>张三账号存在，如果再录入，就会出现500错误</p>
<p>错误信息</p>
<p>Duplicate entry ‘123’ for key ‘idx_username’</p>
<p>common包下的GlobalExceptionHandler类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.common;<br><br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ControllerAdvice;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><br><span class="hljs-keyword">import</span> java.sql.SQLIntegrityConstraintViolationException;<br><br><span class="hljs-comment">//这里是指所有Controller注解和RestController注解标记的类中的方法异常捕捉</span><br><span class="hljs-meta">@ControllerAdvice(annotations = &#123;RestController.class, Controller.class&#125;)</span><br><span class="hljs-comment">//返回json要加上这个注解</span><br><span class="hljs-meta">@ResponseBody</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GlobalExceptionHandler</span> &#123;<br><br>    <span class="hljs-comment">//这里的注解的value是这个方法捕捉的异常类型</span><br>    <span class="hljs-meta">@ExceptionHandler(&#123;SQLIntegrityConstraintViolationException.class&#125;)</span><br>    <span class="hljs-comment">//参数ex是异常信息</span><br>    <span class="hljs-keyword">public</span> R&lt;String&gt; <span class="hljs-title function_">exceptionHandler</span><span class="hljs-params">(SQLIntegrityConstraintViolationException ex)</span>&#123;<br>        <span class="hljs-comment">//获取异常信息</span><br>        <span class="hljs-comment">//Duplicate entry &#x27;123&#x27; for key &#x27;idx_username&#x27;</span><br>        log.error(ex.getMessage());<br><br>        String message=ex.getMessage();<br>        <span class="hljs-keyword">if</span>(message.contains(<span class="hljs-string">&quot;Duplicate entry&quot;</span>))&#123;<br>            String[] s = message.split(<span class="hljs-string">&quot; &quot;</span>);<br>            <span class="hljs-comment">//从异常信息中获取重复的用户名</span><br>            message=s[<span class="hljs-number">2</span>]+<span class="hljs-string">&quot;已存在&quot;</span>;<br>            <span class="hljs-comment">//这个msg内容会在页面显示</span><br>            <span class="hljs-keyword">return</span> R.error(message);<br>        &#125;<br>        <span class="hljs-keyword">return</span> R.error(<span class="hljs-string">&quot;未知错误&quot;</span>);<br>    &#125;<br><br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>这里决定了返回的msg会在页面显示</p>
<p>这是add.html</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">else</span> &#123;<br>                      <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(res.<span class="hljs-property">msg</span> || <span class="hljs-string">&#x27;操作失败&#x27;</span>)<br>                    &#125;<br></code></pre></td></tr></table></figure>

<h3 id="员工信息分页查询"><a href="#员工信息分页查询" class="headerlink" title="员工信息分页查询"></a>员工信息分页查询</h3><p><img src="D:\img\202211261016820.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221126101624000"></p>
<p>这是员工页面的一个请求，可以看出传了page和pageSize参数</p>
<p>created函数，在vue创建的时候就会调用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">created</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-comment">//init()方法下面有</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">init</span>()<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span> = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&#x27;userInfo&#x27;</span>)).<span class="hljs-property">username</span><br>&#125;,<br></code></pre></td></tr></table></figure>

<p>init()</p>
<p>这里的params使用json格式来进行参数传递，但上面确是跟在url后面那种格式，下面解释</p>
<p>page和pageSize都有默认值在前端，page是1，pageSize是10</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">async</span> init () &#123;<br>  <span class="hljs-keyword">const</span> params = &#123;<br>    <span class="hljs-attr">page</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">page</span>,<br>    <span class="hljs-attr">pageSize</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageSize</span>,<br>    <span class="hljs-attr">name</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">input</span> ? <span class="hljs-variable language_">this</span>.<span class="hljs-property">input</span> : <span class="hljs-literal">undefined</span><br>  &#125;<br>  <span class="hljs-keyword">await</span> <span class="hljs-title function_">getMemberList</span>(params).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">String</span>(res.<span class="hljs-property">code</span>) === <span class="hljs-string">&#x27;1&#x27;</span>) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">tableData</span> = res.<span class="hljs-property">data</span>.<span class="hljs-property">records</span> || []<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">counts</span> = res.<span class="hljs-property">data</span>.<span class="hljs-property">total</span><br>    &#125;<br>  &#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;请求出错了：&#x27;</span> + err)<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure>

<p>getMemberList方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getMemberList</span> (params) &#123;<br>  <span class="hljs-keyword">return</span> $axios(&#123;<br>    <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/employee/page&#x27;</span>,<br>    <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;get&#x27;</span>,<br>    params<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure>

<p>这就是为什么一进入list.html就会发起&#x2F;employee&#x2F;page的查询请求的原因</p>
<p>解释params使用json格式来进行参数传递，但上面确是跟在url后面那种格式</p>
<p>request.js</p>
<p>request拦截器，拦截到get请求</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">if</span> (config.<span class="hljs-property">method</span> === <span class="hljs-string">&#x27;get&#x27;</span> &amp;&amp; config.<span class="hljs-property">params</span>) &#123;<br>  <span class="hljs-keyword">let</span> url = config.<span class="hljs-property">url</span> + <span class="hljs-string">&#x27;?&#x27;</span>;<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> propName <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(config.<span class="hljs-property">params</span>)) &#123;<br>    <span class="hljs-keyword">const</span> value = config.<span class="hljs-property">params</span>[propName];<br>    <span class="hljs-keyword">var</span> part = <span class="hljs-built_in">encodeURIComponent</span>(propName) + <span class="hljs-string">&quot;=&quot;</span>;<br>    <span class="hljs-keyword">if</span> (value !== <span class="hljs-literal">null</span> &amp;&amp; <span class="hljs-title function_">typeof</span>(value) !== <span class="hljs-string">&quot;undefined&quot;</span>) &#123;<br>      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> value === <span class="hljs-string">&#x27;object&#x27;</span>) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(value)) &#123;<br>          <span class="hljs-keyword">let</span> params = propName + <span class="hljs-string">&#x27;[&#x27;</span> + key + <span class="hljs-string">&#x27;]&#x27;</span>;<br>          <span class="hljs-keyword">var</span> subPart = <span class="hljs-built_in">encodeURIComponent</span>(params) + <span class="hljs-string">&quot;=&quot;</span>;<br>          url += subPart + <span class="hljs-built_in">encodeURIComponent</span>(value[key]) + <span class="hljs-string">&quot;&amp;&quot;</span>;<br>        &#125;<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        url += part + <span class="hljs-built_in">encodeURIComponent</span>(value) + <span class="hljs-string">&quot;&amp;&quot;</span>;<br>      &#125;<br>    &#125;<br>  &#125;<br></code></pre></td></tr></table></figure>



<p>这里就是请求成功之后，then是回调函数，所以要满足res.code&#x3D;1以及下面的一些条件</p>
<p>只要把数据按照规定返回，就可以进行页面渲染，页面展示</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">async</span> init () &#123;<br>  <span class="hljs-keyword">const</span> params = &#123;<br>    <span class="hljs-attr">page</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">page</span>,<br>    <span class="hljs-attr">pageSize</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageSize</span>,<br>    <span class="hljs-attr">name</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">input</span> ? <span class="hljs-variable language_">this</span>.<span class="hljs-property">input</span> : <span class="hljs-literal">undefined</span><br>  &#125;<br>  <span class="hljs-keyword">await</span> <span class="hljs-title function_">getMemberList</span>(params).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">String</span>(res.<span class="hljs-property">code</span>) === <span class="hljs-string">&#x27;1&#x27;</span>) &#123;<br>        <span class="hljs-comment">//返回的各条记录</span><br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">tableData</span> = res.<span class="hljs-property">data</span>.<span class="hljs-property">records</span> || []<br>        <span class="hljs-comment">//返回的记录的总数</span><br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">counts</span> = res.<span class="hljs-property">data</span>.<span class="hljs-property">total</span><br>    &#125;<br>  &#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;请求出错了：&#x27;</span> + err)<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure>



<p>后端代码的开发思路</p>
<p><img src="D:\img\202211261033438.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221126103309463"></p>
<p>配置分页插件</p>
<p>在config包下的MybatisConfig类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.config;<br><br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.DbType;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.plugins.MybatisPlusInterceptor;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.plugins.inner.PaginationInnerInterceptor;<br><span class="hljs-keyword">import</span> org.mybatis.spring.annotation.MapperScan;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">配置分页插件</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@MapperScan(&quot;com.itheima.reggie.mapper&quot;)</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MybatisPlusConfig</span> &#123;<br>    <span class="hljs-comment">//往ioc容器中添加bean</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> MybatisPlusInterceptor <span class="hljs-title function_">mybatisPlusInterceptor</span><span class="hljs-params">()</span>&#123;<br>        MybatisPlusInterceptor interceptor=<span class="hljs-keyword">new</span> <span class="hljs-title class_">MybatisPlusInterceptor</span>();<br>        <span class="hljs-comment">//参数中设置的式数据库类型</span><br>        interceptor.addInnerInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PaginationInnerInterceptor</span>(DbType.MYSQL));<br>        <span class="hljs-keyword">return</span> interceptor;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p>Controller方法返回的R的data属性是Page类型的对象,因为Page类中有total和records属性，符合前端所规定的</p>
<p>而且除了page和pageSize还要加一个name参数</p>
<p>根据员工name搜索员工信息</p>
<p><img src="D:\img\202211261043920.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221126104324444"></p>
<p><a target="_blank" rel="noopener" href="http://localhost:8080/employee/page?page=1&amp;pageSize=10&amp;name=123%EF%BC%8C%E8%BF%99%E4%B8%AA%E5%B0%B1%E6%98%AF%E5%8A%A0%E4%B8%8Aname%E7%9A%84%E8%AF%B7%E6%B1%82%E5%9C%B0%E5%9D%80">http://localhost:8080/employee/page?page=1&amp;pageSize=10&amp;name=123，这个就是加上name的请求地址</a></p>
<p>小测试：</p>
<p>EmployeeController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//查询分页信息</span><br><span class="hljs-meta">@GetMapping(&quot;/page&quot;)</span><br>    <span class="hljs-keyword">public</span> R&lt;Page&gt; <span class="hljs-title function_">page</span><span class="hljs-params">(<span class="hljs-type">int</span> page,<span class="hljs-type">int</span> pageSize,String name)</span>&#123;<br>    log.info(<span class="hljs-string">&quot;page=&#123;&#125;,pageSize=&#123;&#125;,name=&#123;&#125;&quot;</span>,page,pageSize,name);<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br></code></pre></td></tr></table></figure>



<p>完善</p>
<p>EmployeeController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//查询分页信息</span><br><span class="hljs-meta">@GetMapping(&quot;/page&quot;)</span><br>    <span class="hljs-keyword">public</span> R&lt;Page&gt; <span class="hljs-title function_">page</span><span class="hljs-params">(<span class="hljs-type">int</span> page,<span class="hljs-type">int</span> pageSize,String name)</span>&#123;<br>    log.info(<span class="hljs-string">&quot;page=&#123;&#125;,pageSize=&#123;&#125;,name=&#123;&#125;&quot;</span>,page,pageSize,name);<br><br>    <span class="hljs-comment">//构造分页构造器</span><br>    Page pageInfo=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>(page,pageSize);<br>    <span class="hljs-comment">//构造条件构造器</span><br>    LambdaQueryWrapper&lt;Employee&gt; lambdaQueryWrapper=<span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>    <span class="hljs-comment">//这个意思是在name不为空的情况下，加上这个条件是employee的name为传递的参数</span><br>    <span class="hljs-comment">//第一个参数为true就加上这个条件，第一个参数为false就不加这个参数</span><br>    lambdaQueryWrapper.like(StringUtils.isNotEmpty(name),Employee::getName,name);<br>    <span class="hljs-comment">//添加排序条件</span><br>    lambdaQueryWrapper.orderByDesc(Employee::getUpdateTime);<br><br>    <span class="hljs-comment">//查询满足这个条件构造器的记录，然后分页之后对应的数据</span><br>    employeeService.page(pageInfo,lambdaQueryWrapper);<br>    <span class="hljs-keyword">return</span> R.success(pageInfo);<br>&#125;<br></code></pre></td></tr></table></figure>



<p>没有name的查询的sql语句</p>
<p> SELECT id,username,name,password,phone,sex,id_number,status,create_time,update_time,create_user,update_user FROM employee ORDER BY update_time DESC LIMIT ?</p>
<p>有name的查询sql语句；</p>
<p>SELECT id,username,name,password,phone,sex,id_number,status,create_time,update_time,create_user,update_user FROM employee WHERE (name LIKE ?) ORDER BY update_time DESC LIMIT ?</p>
<p>这是返回到json格式的数据</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>	<span class="hljs-attr">&quot;code&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>	<span class="hljs-attr">&quot;msg&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br>	<span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>		<span class="hljs-attr">&quot;records&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">&#123;</span><br>			<span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1596322557820121089</span><span class="hljs-punctuation">,</span><br>			<span class="hljs-attr">&quot;username&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1234&quot;</span><span class="hljs-punctuation">,</span><br>			<span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;123&quot;</span><span class="hljs-punctuation">,</span><br>			<span class="hljs-attr">&quot;password&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;e10adc3949ba59abbe56e057f20f883e&quot;</span><span class="hljs-punctuation">,</span><br>			<span class="hljs-attr">&quot;phone&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;18364581762&quot;</span><span class="hljs-punctuation">,</span><br>			<span class="hljs-attr">&quot;sex&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1&quot;</span><span class="hljs-punctuation">,</span><br>			<span class="hljs-attr">&quot;idNumber&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;370611200311292613&quot;</span><span class="hljs-punctuation">,</span><br>			<span class="hljs-attr">&quot;status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>			<span class="hljs-attr">&quot;createTime&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2022-11-26T09:58:51&quot;</span><span class="hljs-punctuation">,</span><br>			<span class="hljs-attr">&quot;updateTime&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2022-11-26T09:58:51&quot;</span><span class="hljs-punctuation">,</span><br>			<span class="hljs-attr">&quot;createUser&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>			<span class="hljs-attr">&quot;updateUser&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>		<span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span> <span class="hljs-punctuation">&#123;</span><br>			<span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1596311515371098113</span><span class="hljs-punctuation">,</span><br>			<span class="hljs-attr">&quot;username&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;123&quot;</span><span class="hljs-punctuation">,</span><br>			<span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;123&quot;</span><span class="hljs-punctuation">,</span><br>			<span class="hljs-attr">&quot;password&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;e10adc3949ba59abbe56e057f20f883e&quot;</span><span class="hljs-punctuation">,</span><br>			<span class="hljs-attr">&quot;phone&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;18364581762&quot;</span><span class="hljs-punctuation">,</span><br>			<span class="hljs-attr">&quot;sex&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1&quot;</span><span class="hljs-punctuation">,</span><br>			<span class="hljs-attr">&quot;idNumber&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;370611200311292613&quot;</span><span class="hljs-punctuation">,</span><br>			<span class="hljs-attr">&quot;status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>			<span class="hljs-attr">&quot;createTime&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2022-11-26T09:14:58&quot;</span><span class="hljs-punctuation">,</span><br>			<span class="hljs-attr">&quot;updateTime&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2022-11-26T09:14:58&quot;</span><span class="hljs-punctuation">,</span><br>			<span class="hljs-attr">&quot;createUser&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>			<span class="hljs-attr">&quot;updateUser&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>		<span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span> <span class="hljs-punctuation">&#123;</span><br>			<span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>			<span class="hljs-attr">&quot;username&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;admin&quot;</span><span class="hljs-punctuation">,</span><br>			<span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;管理员&quot;</span><span class="hljs-punctuation">,</span><br>			<span class="hljs-attr">&quot;password&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;e10adc3949ba59abbe56e057f20f883e&quot;</span><span class="hljs-punctuation">,</span><br>			<span class="hljs-attr">&quot;phone&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;13812312312&quot;</span><span class="hljs-punctuation">,</span><br>			<span class="hljs-attr">&quot;sex&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1&quot;</span><span class="hljs-punctuation">,</span><br>			<span class="hljs-attr">&quot;idNumber&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;110101199001010047&quot;</span><span class="hljs-punctuation">,</span><br>			<span class="hljs-attr">&quot;status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>			<span class="hljs-attr">&quot;createTime&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2021-05-06T17:20:07&quot;</span><span class="hljs-punctuation">,</span><br>			<span class="hljs-attr">&quot;updateTime&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2021-05-10T02:24:09&quot;</span><span class="hljs-punctuation">,</span><br>			<span class="hljs-attr">&quot;createUser&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>			<span class="hljs-attr">&quot;updateUser&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>		<span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>		<span class="hljs-attr">&quot;total&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>		<span class="hljs-attr">&quot;size&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10</span><span class="hljs-punctuation">,</span><br>		<span class="hljs-attr">&quot;current&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>		<span class="hljs-attr">&quot;orders&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>		<span class="hljs-attr">&quot;optimizeCountSql&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>		<span class="hljs-attr">&quot;hitCount&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>		<span class="hljs-attr">&quot;countId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br>		<span class="hljs-attr">&quot;maxLimit&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br>		<span class="hljs-attr">&quot;searchCount&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>		<span class="hljs-attr">&quot;pages&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>	<span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>	<span class="hljs-attr">&quot;map&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<p>list.html</p>
<p>这个page-sizes里面是那个一页有多少数据的下拉框的内容</p>
<p>可以通过改变这个page-sizes中的内容，绝顶一页显示多少条数据</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-pagination</span></span><br><span class="hljs-tag">  <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;pageList&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">:page-sizes</span>=<span class="hljs-string">&quot;[10, 20, 30, 40]&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">:page-size</span>=<span class="hljs-string">&quot;pageSize&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">layout</span>=<span class="hljs-string">&quot;total, sizes, prev, pager, next, jumper&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">:total</span>=<span class="hljs-string">&quot;counts&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">:current-page.sync</span>=<span class="hljs-string">&quot;page&quot;</span></span><br><span class="hljs-tag">  @<span class="hljs-attr">size-change</span>=<span class="hljs-string">&quot;handleSizeChange&quot;</span></span><br><span class="hljs-tag">  @<span class="hljs-attr">current-change</span>=<span class="hljs-string">&quot;handleCurrentChange&quot;</span></span><br><span class="hljs-tag">&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-pagination</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>指定page和pageSize初始值</p>
<p>可以改变默认的pageSize或者page</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> &#123;<br>     <span class="hljs-attr">input</span>: <span class="hljs-string">&#x27;&#x27;</span>,<br>     <span class="hljs-attr">counts</span>: <span class="hljs-number">0</span>,<br>     <span class="hljs-attr">page</span>: <span class="hljs-number">1</span>,<br>     <span class="hljs-attr">pageSize</span>: <span class="hljs-number">10</span>,<br>     tableData : [],<br>     id : <span class="hljs-string">&#x27;&#x27;</span>,<br>     status : <span class="hljs-string">&#x27;&#x27;</span>,<br>  &#125;<br>&#125;,<br></code></pre></td></tr></table></figure>

<p><strong>当改变了前端的页面的时候都要进行一下历史纪录的清除</strong></p>
<p><strong>点击搜索号，和分页的时候都是会发起请求的，因为都是有事件绑定在这些键上的</strong></p>
<p><img src="D:\img\202211261355556.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221126135511511"></p>
<p>页面上有帐号状态这一栏，对应的是数据库中的status，但是status是Integer类型的0或1，但页面显示的是正常或者已禁用</p>
<p>这是因为前端有一个处理</p>
<p>判断scope.row.status就是拿到这个查询出来的那一行的状态那个字段的值</p>
<p>row是行的意思</p>
<p>list.html</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;el-button<br>  type=<span class="hljs-string">&quot;text&quot;</span><br>  size=<span class="hljs-string">&quot;small&quot;</span><br>  <span class="hljs-keyword">class</span>=<span class="hljs-string">&quot;delBut non&quot;</span><br>  @click=<span class="hljs-string">&quot;statusHandle(scope.row)&quot;</span><br>  v-<span class="hljs-keyword">if</span>=<span class="hljs-string">&quot;user === &#x27;admin&#x27;&quot;</span><br>&gt;<br>  &#123;&#123; scope.<span class="hljs-property">row</span>.<span class="hljs-property">status</span> == <span class="hljs-string">&#x27;1&#x27;</span> ? <span class="hljs-string">&#x27;禁用&#x27;</span> : <span class="hljs-string">&#x27;启用&#x27;</span> &#125;&#125;<br>&lt;/el-button&gt;<br></code></pre></td></tr></table></figure>



<h3 id="启用禁用员工账号"><a href="#启用禁用员工账号" class="headerlink" title="启用禁用员工账号"></a>启用禁用员工账号</h3><p>需求，只有管理人员才能看到禁用禁用或者启用这个按钮，并且status为1时这里是禁用，为0这里是启用</p>
<p>普通人员登录看不到禁用或者启用，只能看到编辑</p>
<p><img src="D:\img\202211261412461.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221126141216196"></p>
<p>如何实现admin能看到启用禁用，普通用户看不到?</p>
<p>list.html</p>
<p>在创建vue的时候调用的代码，这个地方就获取了user的值，也就是登录的用户的username的值</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html">created() &#123;<br>  this.init()<br>  //取到登陆的用户的username的值赋给this.user<br>  this.user = JSON.parse(localStorage.getItem(&#x27;userInfo&#x27;)).username<br>&#125;,<br></code></pre></td></tr></table></figure>



<p>list.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-button</span></span><br><span class="hljs-tag">  <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;small&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;delBut non&quot;</span></span><br><span class="hljs-tag">  @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;statusHandle(scope.row)&quot;</span></span><br><span class="hljs-tag"> <span class="hljs-attr">这里规定只有登陆的用户名为admin才能有这个禁用或者启用按钮</span></span><br><span class="hljs-tag">  <span class="hljs-attr">v-if</span>=<span class="hljs-string">&quot;user === &#x27;admin&#x27;&quot;</span></span><br><span class="hljs-tag"></span><br><span class="hljs-tag">&gt;</span>&#123;&#123; scope.row.status == &#x27;1&#x27; ? &#x27;禁用&#x27; : &#x27;启用&#x27; &#125;&#125;<br>&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span><br><br><br></code></pre></td></tr></table></figure>



<p>禁用启用的前端代码讲解：</p>
<p>scope.row是这一行数据</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-button</span></span><br><span class="hljs-tag">  <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;small&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;delBut non&quot;</span></span><br><span class="hljs-tag">  @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;statusHandle(scope.row)&quot;</span></span><br><span class="hljs-tag"></span><br><span class="hljs-tag">  <span class="hljs-attr">v-if</span>=<span class="hljs-string">&quot;user === &#x27;admin&#x27;&quot;</span></span><br><span class="hljs-tag">&gt;</span><br>  &#123;&#123; scope.row.status == &#x27;1&#x27; ? &#x27;禁用&#x27; : &#x27;启用&#x27; &#125;&#125;<br></code></pre></td></tr></table></figure>

<p>点击禁用或启用调用statusHandler函数  ，绑定的@click事件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//状态修改</span><br>statusHandle (row) &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = row.<span class="hljs-property">id</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> = row.<span class="hljs-property">status</span><br>  <span class="hljs-variable language_">this</span>.$confirm(<span class="hljs-string">&#x27;确认调整该账号的状态?&#x27;</span>, <span class="hljs-string">&#x27;提示&#x27;</span>, &#123;<br>    <span class="hljs-string">&#x27;confirmButtonText&#x27;</span>: <span class="hljs-string">&#x27;确定&#x27;</span>,<br>    <span class="hljs-string">&#x27;cancelButtonText&#x27;</span>: <span class="hljs-string">&#x27;取消&#x27;</span>,<br>    <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;warning&#x27;</span><br>    &#125;).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-comment">//后面这个id和status是请求的参数，json格式的</span><br>      <span class="hljs-comment">//status就是当前是0就传1，当前是1就传0</span><br>    <span class="hljs-title function_">enableOrDisableEmployee</span>(&#123; <span class="hljs-string">&#x27;id&#x27;</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span>, <span class="hljs-string">&#x27;status&#x27;</span>: !<span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span> &#125;).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;enableOrDisableEmployee&#x27;</span>,res)<br>      <span class="hljs-keyword">if</span> (<span class="hljs-title class_">String</span>(res.<span class="hljs-property">code</span>) === <span class="hljs-string">&#x27;1&#x27;</span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">success</span>(<span class="hljs-string">&#x27;账号状态更改成功！&#x27;</span>)<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleQuery</span>()<br>      &#125;<br>    &#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;请求出错了：&#x27;</span> + err)<br>    &#125;)<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure>

<p>statusHandler中enanbleOrDisableEmployee方法会发起请求</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs lasso"><span class="hljs-comment">// 修改---启用禁用接口</span><br>function enableOrDisableEmployee (<span class="hljs-keyword">params</span>) &#123;<br>  <span class="hljs-keyword">return</span> $axios(&#123;<br>    url: <span class="hljs-string">&#x27;/employee&#x27;</span>,<br>    method: <span class="hljs-string">&#x27;put&#x27;</span>,<br>    <span class="hljs-built_in">data</span>: &#123; <span class="hljs-params">...</span><span class="hljs-keyword">params</span> &#125;<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure>



<p>点击禁用之后的请求</p>
<p><img src="D:\img\202211261436778.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221126143603322"></p>
<p><img src="D:\img\202211261436823.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221126143608824"></p>
<p>上面这个图片的id其实就不是数据库中真实的id，不过后端响应的时候没问题</p>
<p>开始代码开发：</p>
<p>如果直接获取这个请求参数的id，就是被修改的员工的id，放到employee中，其实不是真正这个员工在数据库中得id，因为当id存储到浏览器中时，js精度只有16位，所以在浏览器中存储不准确，如果依据他修改信息则会失败</p>
<p>如何解决这个问题</p>
<p>我们可以在服务器端给页面响应json数据时进行处理，将Long型数据同意转为String字符串</p>
<p>第一步：提供对象转换器，基于Jackson进行java对象到json数据的转换</p>
<p>对象映射器放在common包下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.common;<br><br><span class="hljs-keyword">import</span> com.fasterxml.jackson.databind.DeserializationFeature;<br><span class="hljs-keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;<br><span class="hljs-keyword">import</span> com.fasterxml.jackson.databind.<span class="hljs-keyword">module</span>.SimpleModule;<br><span class="hljs-keyword">import</span> com.fasterxml.jackson.databind.ser.std.ToStringSerializer;<br><span class="hljs-keyword">import</span> com.fasterxml.jackson.datatype.jsr310.deser.LocalDateDeserializer;<br><span class="hljs-keyword">import</span> com.fasterxml.jackson.datatype.jsr310.deser.LocalDateTimeDeserializer;<br><span class="hljs-keyword">import</span> com.fasterxml.jackson.datatype.jsr310.deser.LocalTimeDeserializer;<br><span class="hljs-keyword">import</span> com.fasterxml.jackson.datatype.jsr310.ser.LocalDateSerializer;<br><span class="hljs-keyword">import</span> com.fasterxml.jackson.datatype.jsr310.ser.LocalDateTimeSerializer;<br><span class="hljs-keyword">import</span> com.fasterxml.jackson.datatype.jsr310.ser.LocalTimeSerializer;<br><span class="hljs-keyword">import</span> java.math.BigInteger;<br><span class="hljs-keyword">import</span> java.time.LocalDate;<br><span class="hljs-keyword">import</span> java.time.LocalDateTime;<br><span class="hljs-keyword">import</span> java.time.LocalTime;<br><span class="hljs-keyword">import</span> java.time.format.DateTimeFormatter;<br><span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> com.fasterxml.jackson.databind.DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 对象映射器:基于jackson将Java对象转为json，或者将json转为Java对象</span><br><span class="hljs-comment"> * 将JSON解析为Java对象的过程称为 [从JSON反序列化Java对象]</span><br><span class="hljs-comment"> * 从Java对象生成JSON的过程称为 [序列化Java对象到JSON]</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JacksonObjectMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ObjectMapper</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEFAULT_DATE_FORMAT</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEFAULT_DATE_TIME_FORMAT</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEFAULT_TIME_FORMAT</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;HH:mm:ss&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">JacksonObjectMapper</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>();<br>        <span class="hljs-comment">//收到未知属性时不报异常</span><br>        <span class="hljs-built_in">this</span>.configure(FAIL_ON_UNKNOWN_PROPERTIES, <span class="hljs-literal">false</span>);<br><br>        <span class="hljs-comment">//反序列化时，属性不存在的兼容处理</span><br>        <span class="hljs-built_in">this</span>.getDeserializationConfig().withoutFeatures(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES);<br><br><br>        <span class="hljs-comment">//这几个是设置json对象转java对象</span><br>        <span class="hljs-type">SimpleModule</span> <span class="hljs-variable">simpleModule</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleModule</span>()<br>                .addDeserializer(LocalDateTime.class, <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalDateTimeDeserializer</span>(DateTimeFormatter.ofPattern(DEFAULT_DATE_TIME_FORMAT)))<br>                .addDeserializer(LocalDate.class, <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalDateDeserializer</span>(DateTimeFormatter.ofPattern(DEFAULT_DATE_FORMAT)))<br>                .addDeserializer(LocalTime.class, <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalTimeDeserializer</span>(DateTimeFormatter.ofPattern(DEFAULT_TIME_FORMAT)))<br><br>                <span class="hljs-comment">//这几个是设置java对象转为json对象</span><br>                .addSerializer(BigInteger.class, ToStringSerializer.instance)<br>                <span class="hljs-comment">//这个是把返回的json对象中的long类型的数据转换为String类型</span><br>                .addSerializer(Long.class, ToStringSerializer.instance)<br>                <span class="hljs-comment">//把LocalDateTime类型的变为这种形式    public static final String DEFAULT_DATE_TIME_FORMAT = &quot;yyyy-MM-dd HH:mm:ss&quot;;</span><br>                .addSerializer(LocalDateTime.class, <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalDateTimeSerializer</span>(DateTimeFormatter.ofPattern(DEFAULT_DATE_TIME_FORMAT)))<br>                .addSerializer(LocalDate.class, <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalDateSerializer</span>(DateTimeFormatter.ofPattern(DEFAULT_DATE_FORMAT)))<br>                .addSerializer(LocalTime.class, <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalTimeSerializer</span>(DateTimeFormatter.ofPattern(DEFAULT_TIME_FORMAT)));<br><br>        <span class="hljs-comment">//注册功能模块 例如，可以添加自定义序列化器和反序列化器</span><br>        <span class="hljs-built_in">this</span>.registerModule(simpleModule);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>第二步，在WebMvcConfig配置类中扩展Springmvc消息转换器，在此消息转换器中使用提供的对象转换器进行java对象到json数据的转换</p>
<p>WebMvcConfig中的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//扩展mvc框架消息转换器</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">extendMessageConverters</span><span class="hljs-params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> &#123;<br>    <span class="hljs-comment">//创建消息转换器对象</span><br>    <span class="hljs-comment">//作用：将controller方法的返回值转成相应的json，再通过输出流响应给我们页面</span><br>    MappingJackson2HttpMessageConverter messageConverter=<span class="hljs-keyword">new</span> <span class="hljs-title class_">MappingJackson2HttpMessageConverter</span>();<br>    <span class="hljs-comment">//设置对象转换器，底层使用Jackson将java对象转换为json</span><br>    messageConverter.setObjectMapper(<span class="hljs-keyword">new</span> <span class="hljs-title class_">JacksonObjectMapper</span>());<br>    <span class="hljs-comment">//将上面的消息转换器对象追加到mvc框架的转换器集合中</span><br>    <span class="hljs-comment">//第一个参数是指顺序，0就是第一个，把我们的转换器放到第一个</span><br>    converters.add(<span class="hljs-number">0</span>,messageConverter);<br>&#125;<br></code></pre></td></tr></table></figure>



<p>这个相应看的是那个分页方法，查询后的返回的records中的内容，上面的要修改的员工的id也是从这获取的</p>
<p>服务器响应日期数据转变为”createTime”:”2021-05-06 17:20:07”,”updateTime”:”2021-05-10 02:24:09”</p>
<p>响应id数据转变为字符串：”id”:”1596311515371098113”</p>
<p>Controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//修改员工状态方法</span><br>    <span class="hljs-comment">//前端传回来的是要修改的员工信息的id和修改之后的状态</span><br>    <span class="hljs-meta">@PutMapping</span><br>    <span class="hljs-keyword">public</span> R&lt;String&gt; <span class="hljs-title function_">update</span><span class="hljs-params">(HttpServletRequest request,<span class="hljs-meta">@RequestBody</span> Employee employee)</span>&#123;<br>    log.info(employee.toString());<br><br><span class="hljs-comment">//记录更新时间，和更新的人的id</span><br>        <span class="hljs-comment">//获取登录用户的id</span><br>        <span class="hljs-type">Long</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> (Long) request.getSession().getAttribute(<span class="hljs-string">&quot;employee&quot;</span>);<br>        employee.setUpdateUser(id);<br>        employee.setUpdateTime(LocalDateTime.now());<br>       <span class="hljs-comment">//进行更新操作</span><br>        employeeService.updateById(employee);<br>       <span class="hljs-keyword">return</span> R.success(<span class="hljs-string">&quot;员工信息修改成功&quot;</span>);<br>    &#125;<br></code></pre></td></tr></table></figure>

<p>修改成功后页面弹窗  账号状态更改成功</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">enableOrDisableEmployee</span>(&#123; <span class="hljs-string">&#x27;id&#x27;</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span>, <span class="hljs-string">&#x27;status&#x27;</span>: !<span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span> &#125;).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;<br>         <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;enableOrDisableEmployee&#x27;</span>,res)<br>               <span class="hljs-keyword">if</span> (<span class="hljs-title class_">String</span>(res.<span class="hljs-property">code</span>) === <span class="hljs-string">&#x27;1&#x27;</span>) &#123;<br>                 <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">success</span>(<span class="hljs-string">&#x27;账号状态更改成功！&#x27;</span>)<br>                 <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleQuery</span>()<br>               &#125;<br>             &#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;<br>               <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;请求出错了：&#x27;</span> + err)<br>             &#125;)<br>           &#125;)<br>         &#125;,<br></code></pre></td></tr></table></figure>



<h3 id="编辑员工信息"><a href="#编辑员工信息" class="headerlink" title="编辑员工信息"></a>编辑员工信息</h3><p>点击编辑调用addMemberHandle方法</p>
<p>list.html</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;el-button<br>  type=<span class="hljs-string">&quot;text&quot;</span><br>  size=<span class="hljs-string">&quot;small&quot;</span><br>  <span class="hljs-keyword">class</span>=<span class="hljs-string">&quot;blueBug&quot;</span><br>  @click=<span class="hljs-string">&quot;addMemberHandle(scope.row.id)&quot;</span><br>  :<span class="hljs-keyword">class</span>=<span class="hljs-string">&quot;&#123;notAdmin:user !== &#x27;admin&#x27;&#125;&quot;</span><br>&gt;<br>  编辑<br>&lt;/el-button&gt;<br></code></pre></td></tr></table></figure>

<p>addMemberHandler方法</p>
<p>st是查询出来的那一行数据的id</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs js"> <span class="hljs-comment">// 添加</span><br>addMemberHandle (st) &#123;<br>  <span class="hljs-keyword">if</span> (st === <span class="hljs-string">&#x27;add&#x27;</span>)&#123;<br>    <span class="hljs-variable language_">window</span>.<span class="hljs-property">parent</span>.<span class="hljs-title function_">menuHandle</span>(&#123;<br>      <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;2&#x27;</span>,<br>      <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/backend/page/member/add.html&#x27;</span>,<br>      <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;添加员工&#x27;</span><br>    &#125;,<span class="hljs-literal">true</span>)<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-variable language_">window</span>.<span class="hljs-property">parent</span>.<span class="hljs-title function_">menuHandle</span>(&#123;<br>      <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;2&#x27;</span>,<br>      <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/backend/page/member/add.html?id=&#x27;</span>+st,<br>      <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;修改员工&#x27;</span><br>    &#125;,<span class="hljs-literal">true</span>)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>这menuHandler会让首页的那个iframe变为自己的这个url</p>
<p>这个有点类似之前说的那个一进去首页，页面是员工管理那个一样</p>
<p>index.html</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">menuHandle</span>(<span class="hljs-params">item, goBackFlag</span>) &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span> = <span class="hljs-literal">true</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">menuActived</span> = item.<span class="hljs-property">id</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">iframeUrl</span> = item.<span class="hljs-property">url</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">headTitle</span> = item.<span class="hljs-property">name</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">goBackFlag</span> = goBackFlag<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">closeLoading</span>()<br>&#125;,<br></code></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">iframe</span></span><br><span class="hljs-tag">  <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;cIframe&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;c_iframe&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;cIframe&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">:src</span>=<span class="hljs-string">&quot;iframeUrl&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;100%&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">height</span>=<span class="hljs-string">&quot;auto&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">frameborder</span>=<span class="hljs-string">&quot;0&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">v-show</span>=<span class="hljs-string">&quot;!loading&quot;</span></span><br><span class="hljs-tag">&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">iframe</span>&gt;</span><br></code></pre></td></tr></table></figure>



<p>点击编辑之后跳转add.html,然后这个页面会有这个请求，带有id，然后从数据库中查出信息，在修改页面上显示</p>
<p><img src="D:\img\202211262052574.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221126205242606"></p>
<p>然后对页面上信息进行修改，点击保存后带着修改完信息，发起ajax请求，然后把修改保存到数据库中，然后再在页面显示</p>
<p>点保存之后调用的就是上面那个启用禁用员工账号时的update方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">created</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = <span class="hljs-title function_">requestUrlParam</span>(<span class="hljs-string">&#x27;id&#x27;</span>)<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">actionType</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> ? <span class="hljs-string">&#x27;edit&#x27;</span> : <span class="hljs-string">&#x27;add&#x27;</span><br>  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">init</span>()<br>  &#125;<br>&#125;,<br><span class="hljs-title function_">mounted</span>(<span class="hljs-params"></span>) &#123;<br>&#125;,<br><span class="hljs-attr">methods</span>: &#123;<br>  <span class="hljs-keyword">async</span> init () &#123;<br>    <span class="hljs-title function_">queryEmployeeById</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res)<br>      <span class="hljs-keyword">if</span> (<span class="hljs-title class_">String</span>(res.<span class="hljs-property">code</span>) === <span class="hljs-string">&#x27;1&#x27;</span>) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res.<span class="hljs-property">data</span>)<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">ruleForm</span> = res.<span class="hljs-property">data</span><br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">ruleForm</span>.<span class="hljs-property">sex</span> = res.<span class="hljs-property">data</span>.<span class="hljs-property">sex</span> === <span class="hljs-string">&#x27;0&#x27;</span> ? <span class="hljs-string">&#x27;女&#x27;</span> : <span class="hljs-string">&#x27;男&#x27;</span><br>        <span class="hljs-comment">// this.ruleForm.password = &#x27;&#x27;</span><br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(res.<span class="hljs-property">msg</span> || <span class="hljs-string">&#x27;操作失败&#x27;</span>)<br>      &#125;<br>    &#125;)<br>  &#125;,<br></code></pre></td></tr></table></figure>

<p>vue对象创建后，就调用requestUrlParam得到那个add.html请求后面的id，如果得到了就调用init()方法</p>
<p>queryEmployeeById</p>
<p>发起请求</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 修改页面反查详情接口</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">queryEmployeeById</span> (id) &#123;<br>  <span class="hljs-keyword">return</span> $axios(&#123;<br>    <span class="hljs-attr">url</span>: <span class="hljs-string">`/employee/<span class="hljs-subst">$&#123;id&#125;</span>`</span>,<br>    <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;get&#x27;</span><br>  &#125;)<br></code></pre></td></tr></table></figure>

<p>然后成功后回调函数为</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">async</span> init () &#123;<br>  <span class="hljs-title function_">queryEmployeeById</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res)<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">String</span>(res.<span class="hljs-property">code</span>) === <span class="hljs-string">&#x27;1&#x27;</span>) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res.<span class="hljs-property">data</span>)<br>        <span class="hljs-comment">//把data给这个ruleForm页面就能显示信息</span><br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">ruleForm</span> = res.<span class="hljs-property">data</span><br>        <span class="hljs-comment">//因为页面显示的性别不是0或1而是男女所以这里要判断一下</span><br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">ruleForm</span>.<span class="hljs-property">sex</span> = res.<span class="hljs-property">data</span>.<span class="hljs-property">sex</span> === <span class="hljs-string">&#x27;0&#x27;</span> ? <span class="hljs-string">&#x27;女&#x27;</span> : <span class="hljs-string">&#x27;男&#x27;</span><br>      <span class="hljs-comment">// this.ruleForm.password = &#x27;&#x27;</span><br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(res.<span class="hljs-property">msg</span> || <span class="hljs-string">&#x27;操作失败&#x27;</span>)<br>    &#125;<br></code></pre></td></tr></table></figure>

<p>代码开发：<br>Controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//根据id把员工信息显示到修改的页面上</span><br><span class="hljs-meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span><br><span class="hljs-keyword">public</span> R&lt;Employee&gt; <span class="hljs-title function_">getById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> &#123;<br><br>    log.info(<span class="hljs-string">&quot;根据id查询员工信息&quot;</span>);<br>    <span class="hljs-type">Employee</span> <span class="hljs-variable">employee</span> <span class="hljs-operator">=</span> employeeService.getById(id);<br>    <span class="hljs-keyword">if</span>(employee!=<span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">return</span> R.success(employee);<br>    &#125;<br>    <span class="hljs-keyword">return</span> R.error(<span class="hljs-string">&quot;没有查询到员工信息&quot;</span>);<br>    &#125;<br></code></pre></td></tr></table></figure>

<h1 id="Day3"><a href="#Day3" class="headerlink" title="Day3"></a>Day3</h1><h2 id="公共字段自动填充"><a href="#公共字段自动填充" class="headerlink" title="公共字段自动填充"></a>公共字段自动填充</h2><p>在新增员工时要设置创建时间创键人，修改时间，修改人等字段，在编辑员工的时候也需要设置修改时间和修改人等字段，这些字段属于公共字段，也就是很多表中都由这些字段，能否对这些公共字段在某一个地方统一处理，简化开发呢</p>
<p>答案就是Mybatisplus提供的公共字段填充功能</p>
<p>代码开发：</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202211271311539.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221127131127540"></p>
<p>Employee类</p>
<p>给要自动填充的字段加上注解</p>
<p><strong>在执行数据库操作（insert或update）之前，会给这些属性自动赋值或修改，如果不添加指定注解会修改不了</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.entity;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.FieldFill;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.TableField;<br><span class="hljs-keyword">import</span> lombok.Data;<br><span class="hljs-keyword">import</span> java.io.Serializable;<br><span class="hljs-keyword">import</span> java.time.LocalDateTime;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">员工实体类</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Employee</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">1L</span>;<br><br>    <span class="hljs-keyword">private</span> Long id;<br><br>    <span class="hljs-keyword">private</span> String username;<br><br>    <span class="hljs-keyword">private</span> String name;<br><br>    <span class="hljs-keyword">private</span> String password;<br><br>    <span class="hljs-keyword">private</span> String phone;<br><br>    <span class="hljs-keyword">private</span> String sex;<br><br>    <span class="hljs-keyword">private</span> String idNumber;<br><br>    <span class="hljs-keyword">private</span> Integer status;<br><br>    <span class="hljs-comment">//驼峰命名法和数据库表中的字段名相对应</span><br>   <span class="hljs-comment">//插入时填充字段</span><br>    <span class="hljs-meta">@TableField(fill=FieldFill.INSERT)</span><br>    <span class="hljs-keyword">private</span> LocalDateTime createTime;<br><br>    <span class="hljs-comment">//插入和更新时填充字段</span><br>    <span class="hljs-meta">@TableField(fill=FieldFill.INSERT_UPDATE)</span><br>    <span class="hljs-keyword">private</span> LocalDateTime updateTime;<br><br><br>    <span class="hljs-keyword">private</span> Long createUser;<br><br>    <span class="hljs-comment">//插入和更新时填充字段</span><br>    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span><br>    <span class="hljs-keyword">private</span> Long updateUser;<br><br>&#125;<br></code></pre></td></tr></table></figure>



<p>元数据处理类重点在实现MetaObjectHandler接口</p>
<p>这个类在common包中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.common;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.handlers.MetaObjectHandler;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.apache.ibatis.reflection.MetaObject;<br><span class="hljs-keyword">import</span> org.apache.tomcat.jni.Local;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-keyword">import</span> java.time.LocalDateTime;<br><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyMetaObjectHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MetaObjectHandler</span> &#123;<br><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    插入操作的时候自动填充</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-comment">//这个方法执行insert的时候会执行</span><br>    <span class="hljs-comment">//metaObject中存储了被修改的这个员工的所有信息，也就是元数据</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertFill</span><span class="hljs-params">(MetaObject metaObject)</span> &#123;<br><br>        log.info(<span class="hljs-string">&quot;公共字段自动填充[insert]...&quot;</span>);<br>        log.info(metaObject.toString());<br>        metaObject.setValue(<span class="hljs-string">&quot;createTime&quot;</span>, LocalDateTime.now());<br>        metaObject.setValue(<span class="hljs-string">&quot;updateTime&quot;</span>,LocalDateTime.now());<br>        metaObject.setValue(<span class="hljs-string">&quot;createUser&quot;</span>,<span class="hljs-keyword">new</span> <span class="hljs-title class_">Long</span>(<span class="hljs-number">1</span>));<br>        metaObject.setValue(<span class="hljs-string">&quot;updateUser&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Long</span>(<span class="hljs-number">1</span>));<br><br><br>    &#125;<br><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    更新操作的时候自动填充</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-comment">//这个方法在update的时候会执行</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateFill</span><span class="hljs-params">(MetaObject metaObject)</span> &#123;<br>log.info(<span class="hljs-string">&quot;公共字段自动填充[update]&quot;</span>);<br>log.info(metaObject.toString());<br>        metaObject.setValue(<span class="hljs-string">&quot;updateTime&quot;</span>,LocalDateTime.now());<br>        metaObject.setValue(<span class="hljs-string">&quot;updateUser&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Long</span>(<span class="hljs-number">1</span>));<br>    &#125;<br><br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>Controller中的新增和修改方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//修改员工状态方法</span><br>    <span class="hljs-comment">//前端传回来的是要修改的员工信息的id和修改之后的状态</span><br>    <span class="hljs-meta">@PutMapping</span><br>    <span class="hljs-keyword">public</span> R&lt;String&gt; <span class="hljs-title function_">update</span><span class="hljs-params">(HttpServletRequest request,<span class="hljs-meta">@RequestBody</span> Employee employee)</span>&#123;<br>    log.info(employee.toString());<br><br><span class="hljs-comment">//记录更新时间，和更新的人的id</span><br>        <span class="hljs-comment">//获取登录用户的id</span><br>        <span class="hljs-comment">//下面代码被自动填充代替了</span><br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">        Long id = (Long) request.getSession().getAttribute(&quot;employee&quot;);</span><br><span class="hljs-comment">        employee.setUpdateUser(id);</span><br><span class="hljs-comment">        employee.setUpdateTime(LocalDateTime.now());</span><br><span class="hljs-comment">        */</span><br><br>       <span class="hljs-comment">//进行更新操作</span><br>        employeeService.updateById(employee);<br>       <span class="hljs-keyword">return</span> R.success(<span class="hljs-string">&quot;员工信息修改成功&quot;</span>);<br>    &#125;<br></code></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">新增员工</span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">//路径是/employee所以不用加</span><br><span class="hljs-meta">@PostMapping</span><br><span class="hljs-comment">//@RequestBody接受json数据格式</span><br>    <span class="hljs-keyword">public</span> R&lt;String&gt; <span class="hljs-title function_">saveEmployee</span><span class="hljs-params">(HttpServletRequest request,<span class="hljs-meta">@RequestBody</span> Employee employee)</span>&#123;<br><br>    log.info(<span class="hljs-string">&quot;员工信息:&#123;&#125;&quot;</span>,employee.toString());<br>    <span class="hljs-comment">//设置默认密码，密码进行md5加密</span><br>    employee.setPassword(DigestUtils.md5DigestAsHex(<span class="hljs-string">&quot;123456&quot;</span>.getBytes()));<br>    <span class="hljs-comment">//下面代码被自动填充代替了</span><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    //设置开始创立时间</span><br><span class="hljs-comment">    employee.setCreateTime(LocalDateTime.now());</span><br><span class="hljs-comment">    //设置更新创立时间</span><br><span class="hljs-comment">    employee.setUpdateTime(LocalDateTime.now());</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    //获取当前用登陆用户的id</span><br><span class="hljs-comment">    //获取的默认是Object对象，进行向下转型</span><br><span class="hljs-comment">    long id = (Long)request.getSession().getAttribute(&quot;employee&quot;);</span><br><span class="hljs-comment">    employee.setCreateUser(id);</span><br><span class="hljs-comment">    employee.setUpdateUser(id);</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     */</span><br>    employeeService.save(employee);<br>    <span class="hljs-keyword">return</span> R.success(<span class="hljs-string">&quot;新增员工成功&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>



<p>现在有一个问题：</p>
<p>就是我们在设置更新人和创建人的时候使用的id是固定的，不是获得的登录人存储好的id</p>
<p>解决方案：<br><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202211271357882.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221127135739291"></p>
<p>一次请求是指就是一个url:&#x2F;employee…….这种是一个请求</p>
<p>在拦截器，Controller和元数据对象处理中获取线程的id可能都是一个id，说明这次请求三个方法的执行在一个线程</p>
<p><strong>ThreadLocal不是一个Thread，它是Thread的局部变量，它可以给当前这个线程设置一个变量，其他的线程不能够访问到这个变量，</strong></p>
<p>只有自己这个线程能访问到当前这个变量</p>
<p><strong>并且每一个线程都可以设置同样的变量，每个线程都由ThreadLocal，只是他们互不相干</strong></p>
<p>每一个线程只能用threadLocal保存一个变量</p>
<p>ThreadLocal的常用方法</p>
<p>public void set(T value) ：设置当前线程的线程局部变量的值</p>
<p>public get()：返回当前线程所对应的线程局部变量的值</p>
<p>思路：我们可以在拦截器中获取当前登录用户的id，并调用ThreadLocal的set方法来设置当前线程的线程局部变量的值，然后再元数据对象中的updateFill方法中调用ThreadLocal的get方法来获得当前线程所对应的线程局部变量的值(用户id)</p>
<p><img src="D:\img\202211271423866.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221127142333895"></p>
<p>1.封装的ThreadLocal工具类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.common;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">基于ThreadLocal封装工具类，用户保存和获取当前登录用户id</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseContext</span> &#123;<br>    <span class="hljs-comment">//因为要用它存储id，id是long型所以这个泛型是Long</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ThreadLocal&lt;Long&gt; threadLocal=<span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;();<br>    <span class="hljs-comment">//保存id为线程局部变量</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setCurrentId</span><span class="hljs-params">(Long id)</span>&#123;<br>        threadLocal.set(id);<br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Long <span class="hljs-title function_">getCurrentId</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> threadLocal.get();<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>2.拦截器<strong>（错误的）</strong></p>
<p>获取id后存储到ThreadLocal中</p>
<p>WebMvcConfig中的配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-comment">//一般都是一个方法接受请求了，然后才能把一个参数设置为HttpServletRequest request，获得request对象</span><br><span class="hljs-comment">//其实这个地方有request属性可以，但这个不是真的request对象</span><br><span class="hljs-comment">//所以在拦截器配置方法中他不能得到这个request.getSession()，因为request是个null，会报空指针异常</span><br><span class="hljs-comment">//reques对象</span><br><span class="hljs-keyword">public</span> HttpServletRequest request;<br><span class="hljs-comment">//配置拦截器</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addInterceptors</span><span class="hljs-params">(InterceptorRegistry registry)</span> &#123;<br>    request.getSession()<br>    log.info(<span class="hljs-string">&quot;拦截器加载成功&quot;</span>);<br>    <span class="hljs-comment">//获取登录用户的id</span><br>    Long id=(Long)request.getSession().getAttribute(<span class="hljs-string">&quot;employee&quot;</span>);<br>    <span class="hljs-comment">//将这个id存储到ThreadLocal中</span><br>    BaseContext.setCurrentId(id);<br><br>    registry.addInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LoginInterceptor</span>())<br>            .addPathPatterns(<span class="hljs-string">&quot;/**&quot;</span>)  <span class="hljs-comment">//所有请求都被拦截包括静态资源</span><br>            .excludePathPatterns(<span class="hljs-string">&quot;/employee/login&quot;</span>,<span class="hljs-string">&quot;/backend/**&quot;</span>,<span class="hljs-string">&quot;/front/**&quot;</span>); <span class="hljs-comment">//放行的请求</span><br>&#125;<br></code></pre></td></tr></table></figure>



<p>并且我经过测试，Springboot先加载自动配置的Bean然后再加载Mvc配置类中的拦截器等等</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202211271511029.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221127151131040"></p>
<p>3.元数据处理对象<strong>（错误）</strong></p>
<p>在当中用ThreadLocal获取存储的id</p>
<p>​    Long currentId &#x3D; BaseContext.getCurrentId();不能够把它作为属性，然后在方法中使用，正确的用法是在方法中调用这个方法来获取id，原因大概是因为这是一个配置类，<strong>加载这个currentId的属性的时候还不是当前请求的这个线程</strong>，导致currentId的值是空，再调用insertFill或者updateFill的时候，currentId就是空的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.common;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.handlers.MetaObjectHandler;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.apache.ibatis.reflection.MetaObject;<br><span class="hljs-keyword">import</span> org.apache.tomcat.jni.Local;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-keyword">import</span> java.time.LocalDateTime;<br><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyMetaObjectHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MetaObjectHandler</span> &#123;<br><br>    <span class="hljs-comment">//获取当前登录的用户的id</span><br>    <span class="hljs-type">Long</span> <span class="hljs-variable">currentId</span> <span class="hljs-operator">=</span> BaseContext.getCurrentId();<br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    插入操作的时候自动填充</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-comment">//这个方法执行insert的时候会执行</span><br>    <span class="hljs-comment">//metaObject中存储了被修改的这个员工的所有信息，也就是元数据</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertFill</span><span class="hljs-params">(MetaObject metaObject)</span> &#123;<br><br>        log.info(<span class="hljs-string">&quot;公共字段自动填充[insert]...&quot;</span>);<br>        log.info(metaObject.toString());<br>        metaObject.setValue(<span class="hljs-string">&quot;createTime&quot;</span>, LocalDateTime.now());<br>        metaObject.setValue(<span class="hljs-string">&quot;updateTime&quot;</span>,LocalDateTime.now());<br><br>        metaObject.setValue(<span class="hljs-string">&quot;createUser&quot;</span>,currentId);<br>        metaObject.setValue(<span class="hljs-string">&quot;updateUser&quot;</span>, currentId);<br><br><br>    &#125;<br><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    更新操作的时候自动填充</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-comment">//这个方法在update的时候会执行</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateFill</span><span class="hljs-params">(MetaObject metaObject)</span> &#123;<br>log.info(<span class="hljs-string">&quot;公共字段自动填充[update]&quot;</span>);<br>log.info(metaObject.toString());<br>        metaObject.setValue(<span class="hljs-string">&quot;updateTime&quot;</span>,LocalDateTime.now());<br>        metaObject.setValue(<span class="hljs-string">&quot;updateUser&quot;</span>, currentId);<br>    &#125;<br><br><br>&#125;<br></code></pre></td></tr></table></figure>





<p>上面是自己想的错误演示</p>
<p>我的问题在于把配置拦截器的WebMvcConfig中的配置拦截器的方法，当作拦截器了</p>
<p>其实真正的拦截器是LoginInterceptor，应该在那里面配置</p>
<p>正确的：</p>
<p>1.封装的ThreadLocal工具类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.common;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">基于ThreadLocal封装工具类，用户保存和获取当前登录用户id</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseContext</span> &#123;<br>    <span class="hljs-comment">//因为要用它存储id，id是long型所以这个泛型是Long</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ThreadLocal&lt;Long&gt; threadLocal=<span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;();<br>    <span class="hljs-comment">//保存id为线程局部变量</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setCurrentId</span><span class="hljs-params">(Long id)</span>&#123;<br>        threadLocal.set(id);<br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Long <span class="hljs-title function_">getCurrentId</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> threadLocal.get();<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>2.拦截器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//获取session中employee</span><br>       <span class="hljs-type">Long</span> <span class="hljs-variable">employee</span> <span class="hljs-operator">=</span> (Long) session.getAttribute(<span class="hljs-string">&quot;employee&quot;</span>);<br>       <span class="hljs-comment">//把id放到ThreadLocal中</span><br>       BaseContext.setCurrentId(employee);<br><br><br></code></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.config;<br><br><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;<br><span class="hljs-keyword">import</span> com.fasterxml.jackson.databind.ser.Serializers;<br><span class="hljs-keyword">import</span> com.itheima.reggie.common.BaseContext;<br><span class="hljs-keyword">import</span> com.itheima.reggie.common.R;<br><span class="hljs-keyword">import</span> javafx.beans.binding.LongExpression;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;<br><br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpSession;<br><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        String requestURI=request.getRequestURI();<br>        log.info(<span class="hljs-string">&quot;请求已经拦截&#123;&#125;&quot;</span>,requestURI);<br>        <span class="hljs-comment">//获取session</span><br>        <span class="hljs-type">HttpSession</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> request.getSession();<br>        <span class="hljs-comment">//获取session中employee</span><br>        <span class="hljs-type">Long</span> <span class="hljs-variable">employee</span> <span class="hljs-operator">=</span> (Long) session.getAttribute(<span class="hljs-string">&quot;employee&quot;</span>);<br>        <span class="hljs-comment">//把id放到ThreadLocal中</span><br>        BaseContext.setCurrentId(employee);<br>        <br>        <span class="hljs-comment">//employee不为空就是登陆了放行</span><br>        <span class="hljs-keyword">if</span>(employee!=<span class="hljs-literal">null</span>)&#123;<br>            <span class="hljs-comment">//放行</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>        <span class="hljs-comment">//如果未登录返回未登录结果，通过输出流方式向客户端页面响应数据</span><br>        response.getWriter().write(JSON.toJSONString(R.error(<span class="hljs-string">&quot;NOTLOGIN&quot;</span>)));<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>3.元数据对象处理类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.common;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.handlers.MetaObjectHandler;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.apache.ibatis.reflection.MetaObject;<br><span class="hljs-keyword">import</span> org.apache.tomcat.jni.Local;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-keyword">import</span> java.time.LocalDateTime;<br><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyMetaObjectHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MetaObjectHandler</span> &#123;<br><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    插入操作的时候自动填充</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-comment">//这个方法执行insert的时候会执行</span><br>    <span class="hljs-comment">//metaObject中存储了被修改的这个员工的所有信息，也就是元数据</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertFill</span><span class="hljs-params">(MetaObject metaObject)</span> &#123;<br><br>        log.info(<span class="hljs-string">&quot;公共字段自动填充[insert]...&quot;</span>);<br>        log.info(metaObject.toString());<br>        metaObject.setValue(<span class="hljs-string">&quot;createTime&quot;</span>, LocalDateTime.now());<br>        metaObject.setValue(<span class="hljs-string">&quot;updateTime&quot;</span>,LocalDateTime.now());<br><br>        <span class="hljs-comment">//注意这个BaseContext不能在类中当作属性获取，就是写在外面然后方法里用，是不可以的</span><br>        metaObject.setValue(<span class="hljs-string">&quot;createUser&quot;</span>,BaseContext.getCurrentId());<br>        metaObject.setValue(<span class="hljs-string">&quot;updateUser&quot;</span>, BaseContext.getCurrentId());<br><br>    &#125;<br><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    更新操作的时候自动填充</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-comment">//这个方法在update的时候会执行</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateFill</span><span class="hljs-params">(MetaObject metaObject)</span> &#123;<br>log.info(<span class="hljs-string">&quot;公共字段自动填充[update]&quot;</span>);<br>log.info(metaObject.toString());<br>        metaObject.setValue(<span class="hljs-string">&quot;updateTime&quot;</span>,LocalDateTime.now());<br>        metaObject.setValue(<span class="hljs-string">&quot;updateUser&quot;</span>, BaseContext.getCurrentId());<br>    &#125;<br><br><br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="新增分类"><a href="#新增分类" class="headerlink" title="新增分类"></a>新增分类</h2><p>这个主要是开发分类管理</p>
<p>分类管理分为套餐分类和菜品分类</p>
<p>一个套餐分类（超值午餐）中对应好几种具体的套餐</p>
<p>一个菜品分类(湘菜)中对应好几种具体的菜品</p>
<p>分类管理对应的页面是backend下的page下的catgory下的list.html</p>
<p><img src="D:\img\202211271606538.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221127160618533"></p>
<p>分类对应的是数据库中的category表，name字段有唯一约束</p>
<p>从资料中拷贝Category</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202211271623744.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221127162315864"></p>
<p>CategoryMapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.mapper;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;<br><span class="hljs-keyword">import</span> com.itheima.reggie.entity.Category;<br><br><span class="hljs-meta">@Mapper</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">CategoryMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseMapper</span>&lt;Category&gt; &#123;<br><br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>CategoryServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.service.impl;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;<br><span class="hljs-keyword">import</span> com.itheima.reggie.entity.Category;<br><span class="hljs-keyword">import</span> com.itheima.reggie.entity.Employee;<br><span class="hljs-keyword">import</span> com.itheima.reggie.mapper.CategoryMapper;<br><span class="hljs-keyword">import</span> com.itheima.reggie.mapper.EmployeeMapper;<br><span class="hljs-keyword">import</span> com.itheima.reggie.service.CategoryService;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CategoryServiceImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ServiceImpl</span>&lt;CategoryMapper, Category&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">CategoryService</span> &#123;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>CategoryService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.service;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;<br><span class="hljs-keyword">import</span> com.itheima.reggie.entity.Category;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">CategoryService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">IService</span>&lt;Category&gt; &#123;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>CategoryController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">package</span> com.itheima.reggie.controller;<br><br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-comment">//这里面请求都是这个开头的</span><br><span class="hljs-meta">@RequestMapping(&quot;/category&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CategoryController</span> &#123;<br><br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>Category</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.entity;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.FieldFill;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.IdType;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.TableField;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.TableId;<br><span class="hljs-keyword">import</span> lombok.Data;<br><span class="hljs-keyword">import</span> lombok.Getter;<br><span class="hljs-keyword">import</span> lombok.Setter;<br><span class="hljs-keyword">import</span> java.io.Serializable;<br><span class="hljs-keyword">import</span> java.time.LocalDateTime;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 分类</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Category</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">1L</span>;<br><br>    <span class="hljs-keyword">private</span> Long id;<br><br><br>    <span class="hljs-comment">//类型 1 菜品分类 2 套餐分类</span><br>    <span class="hljs-keyword">private</span> Integer type;<br><br><br>    <span class="hljs-comment">//分类名称</span><br>    <span class="hljs-keyword">private</span> String name;<br><br><br>    <span class="hljs-comment">//顺序</span><br>    <span class="hljs-keyword">private</span> Integer sort;<br><br><br>    <span class="hljs-comment">//创建时间</span><br>    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT)</span><br>    <span class="hljs-keyword">private</span> LocalDateTime createTime;<br><br><br>    <span class="hljs-comment">//更新时间</span><br>    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span><br>    <span class="hljs-keyword">private</span> LocalDateTime updateTime;<br><br><br>    <span class="hljs-comment">//创建人</span><br>    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT)</span><br>    <span class="hljs-keyword">private</span> Long createUser;<br><br><br>    <span class="hljs-comment">//修改人</span><br>    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span><br>    <span class="hljs-keyword">private</span> Long updateUser;<br><br><br>    <span class="hljs-comment">//是否删除</span><br>    <span class="hljs-keyword">private</span> Integer isDeleted;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>修改这些之后无法启动项目，可以点击maven中的那个小刷新号，可以重新打包一下</p>
<p><img src="D:\img\202211271630492.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221127163045676"></p>
<p>clean是清除之前的包，package是重新打包</p>
<p>点击新增菜品分类之后，填完后点击确定，会发起下面的请求，以及携带的参数</p>
<p>name和sort都是表单中自己填写提交的，type是自带的，用来区分是新增菜品还是套餐</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202211271632358.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221127163243434"></p>
<p><img src="D:\img\202211271632188.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221127163255171"></p>
<p>点击新增套餐分类之后，填完点击确定，发的和上面的请求一样，只不过type是2</p>
<p>看看前端代码；</p>
<p>backend下的page下的catgory下的list.html</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;el-button<br>    type=<span class="hljs-string">&quot;primary&quot;</span><br>    <span class="hljs-keyword">class</span>=<span class="hljs-string">&quot;continue&quot;</span><br>    @click=<span class="hljs-string">&quot;addClass(&#x27;class&#x27;)&quot;</span><br>  &gt;<br>    + 新增菜品分类<br>  &lt;/el-button&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">el-button</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;primary&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;addClass(&#x27;meal&#x27;)&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">  &gt;</span></span><br><span class="language-xml">    + 新增套餐分类</span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span></span><br>&lt;/div&gt;<br></code></pre></td></tr></table></figure>

<p>addClass方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js"> <span class="hljs-comment">// 添加</span><br><span class="hljs-title function_">addClass</span>(<span class="hljs-params">st</span>) &#123;<br>  <span class="hljs-keyword">if</span> (st == <span class="hljs-string">&#x27;class&#x27;</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">classData</span>.<span class="hljs-property">title</span> = <span class="hljs-string">&#x27;新增菜品分类&#x27;</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">type</span> = <span class="hljs-string">&#x27;1&#x27;</span><br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">classData</span>.<span class="hljs-property">title</span> = <span class="hljs-string">&#x27;新增套餐分类&#x27;</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">type</span> = <span class="hljs-string">&#x27;2&#x27;</span><br>  &#125;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">action</span> = <span class="hljs-string">&#x27;add&#x27;</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">classData</span>.<span class="hljs-property">name</span> = <span class="hljs-string">&#x27;&#x27;</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">classData</span>.<span class="hljs-property">sort</span> = <span class="hljs-string">&#x27;&#x27;</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">classData</span>.<span class="hljs-property">dialogVisible</span> = <span class="hljs-literal">true</span><br>&#125;,<br></code></pre></td></tr></table></figure>

<p>list.html</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;!---这里是显示页面内容的代码--&gt;<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span></span></span><br><span class="hljs-tag"><span class="language-xml">  <span class="hljs-attr">prop</span>=<span class="hljs-string">&quot;type&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">  <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;分类类型&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">slot-scope</span>=<span class="hljs-string">&quot;scope&quot;</span>&gt;</span></span><br><span class="language-xml">           <span class="hljs-comment">&lt;!--这里就是因为数据库中type是1或者2但是页面显示要是菜品分类或者套餐分类--&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>&#123;&#123; scope.row.type == &#x27;1&#x27; ? &#x27;菜品分类&#x27;: &#x27;套餐分类&#x27; &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">el-table-column</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span></span></span><br><span class="hljs-tag"><span class="language-xml">  <span class="hljs-attr">prop</span>=<span class="hljs-string">&quot;updateTime&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">  <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;操作时间&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">slot-scope</span>=<span class="hljs-string">&quot;scope&quot;</span>&gt;</span></span><br><span class="language-xml"> &#123;&#123;scope.row.updateTime&#125;&#125;</span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">el-table-column</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span></span></span><br><span class="hljs-tag"><span class="language-xml">  <span class="hljs-attr">prop</span>=<span class="hljs-string">&quot;sort&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">  <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;排序&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">/&gt;</span></span>&lt;/el-table-column&gt;<br>&lt;el-table-column<br>  label=&quot;操作&quot;<br>  width=&quot;160&quot;<br>  align=&quot;center&quot;<br>&gt;<br>  &lt;template slot-scope=&quot;scope&quot;&gt;<br>    &lt;el-button<br>      type=&quot;text&quot;<br>      size=&quot;small&quot;<br>      class=&quot;blueBug&quot;<br>      @click=&quot;editHandle(scope.row)&quot;<br>    &gt;<br>      修改<br>    &lt;/el-button&gt;<br>    &lt;el-button<br>      type=&quot;text&quot;<br>      size=&quot;small&quot;<br>      class=&quot;delBut non&quot;<br>      @click=&quot;deleteHandle(scope.row.id)&quot;<br>    &gt;<br>      删除<br>    &lt;/el-button&gt;<br></code></pre></td></tr></table></figure>

<p>则一块是点击新增菜单分类或者新增套餐分类之后的弹框</p>
<p>点击确定后调用submitForm()方法</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-form</span></span><br><span class="hljs-tag">  <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;demo-form-inline&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">label-width</span>=<span class="hljs-string">&quot;100px&quot;</span></span><br><span class="hljs-tag">&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;分类名称：&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">el-input</span></span><br><span class="hljs-tag">      <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;classData.name&quot;</span></span><br><span class="hljs-tag">      <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;请输入分类名称&quot;</span></span><br><span class="hljs-tag">      <span class="hljs-attr">maxlength</span>=<span class="hljs-string">&quot;14&quot;</span></span><br><span class="hljs-tag">    /&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;排序：&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">el-input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;classData.sort&quot;</span>  <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;number&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;请输入排序&quot;</span> /&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">el-form</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">span</span></span><br><span class="hljs-tag">  <span class="hljs-attr">slot</span>=<span class="hljs-string">&quot;footer&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;dialog-footer&quot;</span></span><br><span class="hljs-tag">&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span></span><br><span class="hljs-tag">    <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;medium&quot;</span></span><br><span class="hljs-tag">    @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;classData.dialogVisible = false&quot;</span></span><br><span class="hljs-tag">  &gt;</span>取 消<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span></span><br><span class="hljs-tag">    <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;primary&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;medium&quot;</span></span><br><span class="hljs-tag">    @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;submitForm()&quot;</span></span><br><span class="hljs-tag">  &gt;</span>确 定<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span></span><br><span class="hljs-tag">    <span class="hljs-attr">v-if</span>=<span class="hljs-string">&quot;action != &#x27;edit&#x27;&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;primary&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;medium&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;continue&quot;</span></span><br><span class="hljs-tag">    @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;submitForm(&#x27;go&#x27;)&quot;</span></span><br><span class="hljs-tag">  &gt;</span> 保存并继续添加 <span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>submitForm()</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//数据提交</span><br><span class="hljs-title function_">submitForm</span>(<span class="hljs-params">st</span>) &#123;<br>    <span class="hljs-keyword">const</span> classData = <span class="hljs-variable language_">this</span>.<span class="hljs-property">classData</span><br>    <span class="hljs-keyword">const</span> valid = (classData.<span class="hljs-property">name</span> === <span class="hljs-number">0</span> ||classData.<span class="hljs-property">name</span>)  &amp;&amp; (classData.<span class="hljs-property">sort</span> === <span class="hljs-number">0</span> || classData.<span class="hljs-property">sort</span>)<br>    <span class="hljs-comment">//添加的时候action是add,addClass方法决定的</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">action</span> === <span class="hljs-string">&#x27;add&#x27;</span>) &#123;<br>      <span class="hljs-keyword">if</span> (valid) &#123;<br>        <span class="hljs-keyword">const</span> reg = <span class="hljs-regexp">/^\d+$/</span><br>        <span class="hljs-keyword">if</span> (reg.<span class="hljs-title function_">test</span>(classData.<span class="hljs-property">sort</span>)) &#123;<br>          <span class="hljs-title function_">addCategory</span>(&#123;<span class="hljs-string">&#x27;name&#x27;</span>: classData.<span class="hljs-property">name</span>,<span class="hljs-string">&#x27;type&#x27;</span>:<span class="hljs-variable language_">this</span>.<span class="hljs-property">type</span>, <span class="hljs-attr">sort</span>: classData.<span class="hljs-property">sort</span>&#125;).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res)<br>            <span class="hljs-keyword">if</span> (res.<span class="hljs-property">code</span> === <span class="hljs-number">1</span>) &#123;<br>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">success</span>(<span class="hljs-string">&#x27;分类添加成功！&#x27;</span>)<br>              <span class="hljs-keyword">if</span> (!st) &#123;<br>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">classData</span>.<span class="hljs-property">dialogVisible</span> = <span class="hljs-literal">false</span><br>              &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">classData</span>.<span class="hljs-property">name</span> = <span class="hljs-string">&#x27;&#x27;</span><br>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">classData</span>.<span class="hljs-property">sort</span> = <span class="hljs-string">&#x27;&#x27;</span><br>              &#125;<br>              <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleQuery</span>()<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(res.<span class="hljs-property">msg</span> || <span class="hljs-string">&#x27;操作失败&#x27;</span>)<br>            &#125;<br>          &#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;<br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;请求出错了：&#x27;</span> + err)<br>          &#125;)<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;排序只能输入数字类型&#x27;</span>)<br>        &#125;<br>        <br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;请输入分类名称或排序&#x27;</span>)<br>    &#125;<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (valid) &#123;<br>    <span class="hljs-keyword">const</span> reg = <span class="hljs-regexp">/^\d+$/</span><br>    <span class="hljs-keyword">if</span> (reg.<span class="hljs-title function_">test</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">classData</span>.<span class="hljs-property">sort</span>)) &#123;<br>      <span class="hljs-title function_">editCategory</span>(&#123;<span class="hljs-string">&#x27;id&#x27;</span>:<span class="hljs-variable language_">this</span>.<span class="hljs-property">classData</span>.<span class="hljs-property">id</span>,<span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">classData</span>.<span class="hljs-property">name</span>, <span class="hljs-attr">sort</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">classData</span>.<span class="hljs-property">sort</span>&#125;).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;<br>        <span class="hljs-keyword">if</span> (res.<span class="hljs-property">code</span> === <span class="hljs-number">1</span>) &#123;<br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">success</span>(<span class="hljs-string">&#x27;分类修改成功！&#x27;</span>)<br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">classData</span>.<span class="hljs-property">dialogVisible</span> = <span class="hljs-literal">false</span><br>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleQuery</span>()<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(res.<span class="hljs-property">msg</span> || <span class="hljs-string">&#x27;操作失败&#x27;</span>)<br>        &#125;<br>      &#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;请求出错了：&#x27;</span> + err)<br>      &#125;)<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;排序只能输入数字类型&#x27;</span>)<br>    &#125;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;请输入分类名称或排序&#x27;</span>)<br>  &#125;<br>&#125;,<br></code></pre></td></tr></table></figure>

<p>发起ajax请求的方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 新增接口</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">addCategory</span> = (<span class="hljs-params">params</span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> $axios(&#123;<br>    <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/category&#x27;</span>,<br>    <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;post&#x27;</span>,<br>    <span class="hljs-attr">data</span>: &#123; ...params &#125;<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure>

<p>CategoryController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.controller;<br><br><span class="hljs-keyword">import</span> com.itheima.reggie.common.R;<br><span class="hljs-keyword">import</span> com.itheima.reggie.entity.Category;<br><span class="hljs-keyword">import</span> com.itheima.reggie.service.impl.CategoryServiceImpl;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PostMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestBody;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-comment">//这里面请求都是这个开头的</span><br><span class="hljs-meta">@RequestMapping(&quot;/category&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CategoryController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    CategoryServiceImpl categoryService;<br>    <span class="hljs-meta">@PostMapping</span><br>      <span class="hljs-keyword">public</span> R&lt;String&gt; <span class="hljs-title function_">insert</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Category category)</span>&#123;<br>          log.info(<span class="hljs-string">&quot;category&#123;&#125;&quot;</span>,category);<br>        categoryService.save(category);<br>        <span class="hljs-keyword">return</span> R.success(<span class="hljs-string">&quot;新增分类成功&quot;</span>);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="分页查询分类"><a href="#分页查询分类" class="headerlink" title="分页查询分类"></a>分页查询分类</h2><p>前端代码：</p>
<p>这个vue对象是在点击分类管理，加载这个页面的时候创建的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//created代码是在vue刚创建的时候调用的</span><br>       <span class="hljs-comment">//这个vue对象是在点击分类管理，加载这个页面的时候创建的</span><br>       <span class="hljs-comment">//然后去调用init()</span><br>       <span class="hljs-title function_">created</span>(<span class="hljs-params"></span>) &#123;<br>         <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">init</span>()<br>       &#125;,<br>       <span class="hljs-title function_">mounted</span>(<span class="hljs-params"></span>) &#123;<br>       &#125;,<br>       <span class="hljs-comment">//这段代码是在vue刚建立时调用的</span><br>       <span class="hljs-attr">methods</span>: &#123;<br>         <span class="hljs-keyword">async</span> init () &#123;<br>           <span class="hljs-comment">//这个地方是发起ajax请求的，带着page和pageSize参数</span><br>       <span class="hljs-comment">//then里面是回调函数，只要把page对象赋值到R.data返回就行了,这里和之前员工的查询都是一样的</span><br>           <span class="hljs-keyword">await</span> <span class="hljs-title function_">getCategoryPage</span>(&#123;<span class="hljs-string">&#x27;page&#x27;</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">page</span>, <span class="hljs-string">&#x27;pageSize&#x27;</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageSize</span>&#125;).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;<br>             <span class="hljs-keyword">if</span> (<span class="hljs-title class_">String</span>(res.<span class="hljs-property">code</span>) === <span class="hljs-string">&#x27;1&#x27;</span>) &#123;<br>               <span class="hljs-variable language_">this</span>.<span class="hljs-property">tableData</span> = res.<span class="hljs-property">data</span>.<span class="hljs-property">records</span><br>               <span class="hljs-variable language_">this</span>.<span class="hljs-property">counts</span> = <span class="hljs-title class_">Number</span>(res.<span class="hljs-property">data</span>.<span class="hljs-property">total</span>)<br>             &#125; <span class="hljs-keyword">else</span> &#123;<br>                 <span class="hljs-comment">//这里大概就是如果res.msg不为空这里输出res.msg如果为空输出操作失败</span><br>               <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(res.<span class="hljs-property">msg</span> || <span class="hljs-string">&#x27;操作失败&#x27;</span>)<br>             &#125;<br>           &#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;<br>               <span class="hljs-comment">//这里是捕捉错误信息</span><br>             <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;请求出错了：&#x27;</span> + err)<br>           &#125;)<br>         &#125;,<br></code></pre></td></tr></table></figure>

<p>total和records都是page对象的属性</p>
<p>getCategoryPage</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 查询列表接口</span><br><span class="hljs-comment">//这个是发起ajax请求的</span><br><span class="hljs-type">const</span> <span class="hljs-variable">getCategoryPage</span> <span class="hljs-operator">=</span> (params) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> $axios(&#123;<br>    url: <span class="hljs-string">&#x27;/category/page&#x27;</span>,<br>    method: <span class="hljs-string">&#x27;get&#x27;</span>,<br>    params<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202211271717526.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221127171748655"></p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202211271718044.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221127171800171"></p>
<p>这是点击分类管理页面之后会发送的请求</p>
<p>CategoryContorller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/page&quot;)</span><br><span class="hljs-keyword">public</span> R&lt;Page&gt; <span class="hljs-title function_">select</span><span class="hljs-params">(<span class="hljs-type">int</span> page,<span class="hljs-type">int</span> pageSize)</span>&#123;<br>    Page&lt;Category&gt; pageInfo=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>&lt;&gt;(page,pageSize);<br><br>    <span class="hljs-comment">//条件构造器</span><br>    LambdaQueryWrapper&lt;Category&gt; lambdaQueryWrapper=<span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>    lambdaQueryWrapper.orderByAsc(Category::getSort);<br>    <span class="hljs-comment">//这个方法发起sql语句的时候是根据这个Category类中的属性来执行sql语句的</span><br>    categoryService.page(pageInfo,lambdaQueryWrapper);<br>    log.info(pageInfo.toString());<br>    <span class="hljs-keyword">return</span> R.success(pageInfo);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>分类类型存的是1，2在数据库中，但页面上是菜品分类和套餐分类</p>
<p>是因为前端做了处理</p>
<h2 id="删除分类"><a href="#删除分类" class="headerlink" title="删除分类"></a>删除分类</h2><p>在分类管理页面，可以对某个分类进行删除操作，需要注意的是当分类关联了菜品或者套餐时，此分类不允许删除</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202211271837330.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221127183718457"></p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202211271837525.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221127183728744"></p>
<p>这是点了删除以后，点击确认之后发起的请求</p>
<p>list.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">el-button</span></span><br><span class="hljs-tag">  <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;small&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;delBut non&quot;</span></span><br><span class="hljs-tag">  @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;deleteHandle(scope.row.id)&quot;</span></span><br><span class="hljs-tag">&gt;</span><br>  删除<br><span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span><br></code></pre></td></tr></table></figure>



<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs js">    <span class="hljs-comment">//删除</span><br><span class="hljs-comment">//当点击删除的时候调用的方法</span><br>    <span class="hljs-title function_">deleteHandle</span>(<span class="hljs-params">id</span>) &#123;<br>      <span class="hljs-variable language_">this</span>.$confirm(<span class="hljs-string">&#x27;此操作将永久删除该文件, 是否继续?&#x27;</span>, <span class="hljs-string">&#x27;提示&#x27;</span>, &#123;<br>        <span class="hljs-string">&#x27;confirmButtonText&#x27;</span>: <span class="hljs-string">&#x27;确定&#x27;</span>,<br>        <span class="hljs-string">&#x27;cancelButtonText&#x27;</span>: <span class="hljs-string">&#x27;取消&#x27;</span>,<br>        <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;warning&#x27;</span><br>      &#125;).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>        <span class="hljs-comment">//点击确定后的回调函数</span><br>        <span class="hljs-title function_">deleCategory</span>(id).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;<br>          <span class="hljs-keyword">if</span> (res.<span class="hljs-property">code</span> === <span class="hljs-number">1</span>) &#123;<br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">success</span>(<span class="hljs-string">&#x27;删除成功！&#x27;</span>)<br>    <span class="hljs-comment">//这个是指回到分类查询的第一页</span><br>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleQuery</span>()<br>          &#125; <span class="hljs-keyword">else</span> &#123;<br>              <span class="hljs-comment">//这里是如果后端返回R.error(msg)就会输出msg的内容</span><br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(res.<span class="hljs-property">msg</span> || <span class="hljs-string">&#x27;操作失败&#x27;</span>)<br>          &#125;<br>        &#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;<br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;请求出错了：&#x27;</span> + err)<br>        &#125;)<br>      &#125;)<br>    &#125;,<br></code></pre></td></tr></table></figure>



<p>Controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@DeleteMapping</span><br><span class="hljs-comment">//id已经变为String类型的了</span><br><span class="hljs-keyword">public</span> R&lt;String&gt; <span class="hljs-title function_">delete</span><span class="hljs-params">( String ids)</span>&#123;<br>    log.info(<span class="hljs-string">&quot;id:&#123;&#125;&quot;</span>,ids);<br> categoryService.removeById(ids);<br> <span class="hljs-keyword">return</span> R.success(<span class="hljs-string">&quot;删除成功了&quot;</span>);<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>功能完善：</strong><br>前面实现了通过id删除分类的功能，但是并没有检查删除的分类是否关联了菜品或套餐，所以我们需要进行功能完善</p>
<p><strong>逻辑就是用ids查询有没有菜品或者套餐是这个分类的，如果有就抛出异常，如果没有就正常删除，抛出异常之后，由异常处理器统一处理，然后再把错误信息返回给前端</strong></p>
<p>先把Dish和Setmeal两个实体类加进来</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.entity;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.FieldFill;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.IdType;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.TableField;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.TableId;<br><span class="hljs-keyword">import</span> lombok.Data;<br><span class="hljs-keyword">import</span> java.io.Serializable;<br><span class="hljs-keyword">import</span> java.math.BigDecimal;<br><span class="hljs-keyword">import</span> java.time.LocalDateTime;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> 菜品</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Dish</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">1L</span>;<br><br>    <span class="hljs-keyword">private</span> Long id;<br><br><br>    <span class="hljs-comment">//菜品名称</span><br>    <span class="hljs-keyword">private</span> String name;<br><br><br>    <span class="hljs-comment">//菜品分类id</span><br>    <span class="hljs-keyword">private</span> Long categoryId;<br><br><br>    <span class="hljs-comment">//菜品价格</span><br>    <span class="hljs-keyword">private</span> BigDecimal price;<br><br><br>    <span class="hljs-comment">//商品码</span><br>    <span class="hljs-keyword">private</span> String code;<br><br><br>    <span class="hljs-comment">//图片</span><br>    <span class="hljs-keyword">private</span> String image;<br><br><br>    <span class="hljs-comment">//描述信息</span><br>    <span class="hljs-keyword">private</span> String description;<br><br><br>    <span class="hljs-comment">//0 停售 1 起售</span><br>    <span class="hljs-keyword">private</span> Integer status;<br><br><br>    <span class="hljs-comment">//顺序</span><br>    <span class="hljs-keyword">private</span> Integer sort;<br><br><br>    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT)</span><br>    <span class="hljs-keyword">private</span> LocalDateTime createTime;<br><br><br>    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span><br>    <span class="hljs-keyword">private</span> LocalDateTime updateTime;<br><br><br>    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT)</span><br>    <span class="hljs-keyword">private</span> Long createUser;<br><br><br>    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span><br>    <span class="hljs-keyword">private</span> Long updateUser;<br><br><br>    <span class="hljs-comment">//是否删除</span><br>    <span class="hljs-keyword">private</span> Integer isDeleted;<br><br>&#125;<br></code></pre></td></tr></table></figure>



<p>Setmeal</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.entity;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.FieldFill;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.IdType;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.TableField;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.TableId;<br><span class="hljs-keyword">import</span> lombok.Data;<br><span class="hljs-keyword">import</span> java.io.Serializable;<br><span class="hljs-keyword">import</span> java.math.BigDecimal;<br><span class="hljs-keyword">import</span> java.time.LocalDateTime;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 套餐</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Setmeal</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">1L</span>;<br><br>    <span class="hljs-keyword">private</span> Long id;<br><br><br>    <span class="hljs-comment">//分类id</span><br>    <span class="hljs-keyword">private</span> Long categoryId;<br><br><br>    <span class="hljs-comment">//套餐名称</span><br>    <span class="hljs-keyword">private</span> String name;<br><br><br>    <span class="hljs-comment">//套餐价格</span><br>    <span class="hljs-keyword">private</span> BigDecimal price;<br><br><br>    <span class="hljs-comment">//状态 0:停用 1:启用</span><br>    <span class="hljs-keyword">private</span> Integer status;<br><br><br>    <span class="hljs-comment">//编码</span><br>    <span class="hljs-keyword">private</span> String code;<br><br><br>    <span class="hljs-comment">//描述信息</span><br>    <span class="hljs-keyword">private</span> String description;<br><br><br>    <span class="hljs-comment">//图片</span><br>    <span class="hljs-keyword">private</span> String image;<br><br><br>    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT)</span><br>    <span class="hljs-keyword">private</span> LocalDateTime createTime;<br><br><br>    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span><br>    <span class="hljs-keyword">private</span> LocalDateTime updateTime;<br><br><br>    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT)</span><br>    <span class="hljs-keyword">private</span> Long createUser;<br><br><br>    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span><br>    <span class="hljs-keyword">private</span> Long updateUser;<br><br><br>    <span class="hljs-comment">//是否删除</span><br>    <span class="hljs-keyword">private</span> Integer isDeleted;<br>&#125;<br></code></pre></td></tr></table></figure>



<p>CategoryController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@DeleteMapping</span><br><span class="hljs-comment">//id已经变为String类型的了</span><br><span class="hljs-keyword">public</span> R&lt;String&gt; <span class="hljs-title function_">delete</span><span class="hljs-params">( Long ids)</span>&#123;<br>    log.info(<span class="hljs-string">&quot;id:&#123;&#125;&quot;</span>,ids);<br><span class="hljs-comment">//这个remove方法是自定义的</span><br> categoryService.remove(ids);<br> <span class="hljs-keyword">return</span> R.success(<span class="hljs-string">&quot;删除成功了&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>Service中增加的自定义的remove方法</p>
<p>逻辑就是用ids查询有没有菜品或者套餐是这个分类的，如果有就抛出异常，如果没有就正常删除</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.service.impl;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;<br><span class="hljs-keyword">import</span> com.itheima.reggie.common.CustomerException;<br><span class="hljs-keyword">import</span> com.itheima.reggie.entity.Category;<br><span class="hljs-keyword">import</span> com.itheima.reggie.entity.Dish;<br><span class="hljs-keyword">import</span> com.itheima.reggie.entity.Setmeal;<br><span class="hljs-keyword">import</span> com.itheima.reggie.mapper.CategoryMapper;<br><span class="hljs-keyword">import</span> com.itheima.reggie.service.CategoryService;<br><span class="hljs-keyword">import</span> com.itheima.reggie.service.SetmealService;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CategoryServiceImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ServiceImpl</span>&lt;CategoryMapper, Category&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">CategoryService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    DishServiceImpl dishService;<br>    <span class="hljs-meta">@Autowired</span><br>    SetmealService setmealService;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">remove</span><span class="hljs-params">(Long ids)</span> &#123;<br>        <span class="hljs-comment">//查出这个ids有套餐与之关联抛出异常</span><br><br>        <span class="hljs-comment">//条件构造器</span><br>        LambdaQueryWrapper&lt;Dish&gt; lambdaQueryWrapper=<span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>         lambdaQueryWrapper.eq(Dish::getCategoryId, ids);<br>       <span class="hljs-comment">//SELECT COUNT( * ) FROM dish WHERE (category_id = ?)</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> dishService.count(lambdaQueryWrapper);<br><br>        <span class="hljs-keyword">if</span>(count&gt;<span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-comment">//抛出异常</span><br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomerException</span>(<span class="hljs-string">&quot;这个分类有菜品与之关联&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-comment">//查出这个ids有套餐与之关联抛出异常</span><br>        LambdaQueryWrapper&lt;Setmeal&gt; lambdaQueryWrapper1=<span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>        lambdaQueryWrapper1.eq(Setmeal::getCategoryId, ids);<br>        <span class="hljs-type">int</span> <span class="hljs-variable">count1</span> <span class="hljs-operator">=</span> setmealService.count(lambdaQueryWrapper1);<br><br>        <span class="hljs-keyword">if</span>(count1&gt;<span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-comment">//抛出异常</span><br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomerException</span>(<span class="hljs-string">&quot;这个分类有套餐与之关联&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-comment">//正常删除</span><br>        <span class="hljs-built_in">super</span>.removeById(ids);<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>CategoryService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.service;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;<br><span class="hljs-keyword">import</span> com.itheima.reggie.entity.Category;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">CategoryService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">IService</span>&lt;Category&gt; &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">remove</span><span class="hljs-params">(Long ids)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>自定义异常</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.common;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomerException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RuntimeException</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">CustomerException</span><span class="hljs-params">()</span>&#123;<br><br>    &#125;<br>    <span class="hljs-comment">//这个参数就是异常信息</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">CustomerException</span><span class="hljs-params">(String msg)</span>&#123;<br>        <span class="hljs-built_in">super</span>(msg);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>



<p>common中的GlobalExceptionHandler中的方法处理CustomerException异常的方法</p>
<p><strong>这里就是把自定义的异常信息返回给前端</strong></p>
<p>抛出异常</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ExceptionHandler(&#123;CustomerException.class&#125;)</span><br><span class="hljs-keyword">public</span> R&lt;String&gt; <span class="hljs-title function_">exceptionHandler1</span><span class="hljs-params">(CustomerException ex)</span>&#123;<br>    <span class="hljs-comment">//ex.getMessage()获取的就是自己传递的报错信息，就是那个异常类构造器参数</span><br>    <span class="hljs-keyword">return</span> R.error(ex.getMessage());<br>&#125;<br></code></pre></td></tr></table></figure>



<p>前端实现回显</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs js">    <span class="hljs-comment">//删除</span><br><span class="hljs-comment">//当点击删除的时候调用的方法</span><br>    <span class="hljs-title function_">deleteHandle</span>(<span class="hljs-params">id</span>) &#123;<br>      <span class="hljs-variable language_">this</span>.$confirm(<span class="hljs-string">&#x27;此操作将永久删除该文件, 是否继续?&#x27;</span>, <span class="hljs-string">&#x27;提示&#x27;</span>, &#123;<br>        <span class="hljs-string">&#x27;confirmButtonText&#x27;</span>: <span class="hljs-string">&#x27;确定&#x27;</span>,<br>        <span class="hljs-string">&#x27;cancelButtonText&#x27;</span>: <span class="hljs-string">&#x27;取消&#x27;</span>,<br>        <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;warning&#x27;</span><br>      &#125;).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>        <span class="hljs-comment">//点击确定后的回调函数</span><br>        <span class="hljs-title function_">deleCategory</span>(id).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;<br>          <span class="hljs-keyword">if</span> (res.<span class="hljs-property">code</span> === <span class="hljs-number">1</span>) &#123;<br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">success</span>(<span class="hljs-string">&#x27;删除成功！&#x27;</span>)<br>    <span class="hljs-comment">//这个是指回到分类查询的第一页</span><br>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleQuery</span>()<br>          &#125; <span class="hljs-keyword">else</span> &#123;<br>              <span class="hljs-comment">//这里是如果后端返回R.error(msg)就会输出msg的内容</span><br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(res.<span class="hljs-property">msg</span> || <span class="hljs-string">&#x27;操作失败&#x27;</span>)<br>          &#125;<br>        &#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;<br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;请求出错了：&#x27;</span> + err)<br>        &#125;)<br>      &#125;)<br>    &#125;,<br></code></pre></td></tr></table></figure>

<h2 id="修改分类"><a href="#修改分类" class="headerlink" title="修改分类"></a>修改分类</h2><p>list.html</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs js">    <span class="hljs-comment">//数据提交</span><br><span class="hljs-comment">//数据提交的时候是通过this.action是否为add来分别的，如果是action是add就是新增，action  edit就是修改</span><br>    <span class="hljs-title function_">submitForm</span>(<span class="hljs-params">st</span>) &#123;<br>        <span class="hljs-keyword">const</span> classData = <span class="hljs-variable language_">this</span>.<span class="hljs-property">classData</span><br>        <span class="hljs-keyword">const</span> valid = (classData.<span class="hljs-property">name</span> === <span class="hljs-number">0</span> ||classData.<span class="hljs-property">name</span>)  &amp;&amp; (classData.<span class="hljs-property">sort</span> === <span class="hljs-number">0</span> || classData.<span class="hljs-property">sort</span>)<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">action</span> === <span class="hljs-string">&#x27;add&#x27;</span>) &#123;<br>          <span class="hljs-keyword">if</span> (valid) &#123;<br>            <span class="hljs-keyword">const</span> reg = <span class="hljs-regexp">/^\d+$/</span><br>            <span class="hljs-keyword">if</span> (reg.<span class="hljs-title function_">test</span>(classData.<span class="hljs-property">sort</span>)) &#123;<br>              <span class="hljs-comment">//addCategory发起请求成功返回后就会执行这个方法，返回值是res</span><br>              <span class="hljs-title function_">addCategory</span>(&#123;<span class="hljs-string">&#x27;name&#x27;</span>: classData.<span class="hljs-property">name</span>,<span class="hljs-string">&#x27;type&#x27;</span>:<span class="hljs-variable language_">this</span>.<span class="hljs-property">type</span>, <span class="hljs-attr">sort</span>: classData.<span class="hljs-property">sort</span>&#125;).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;<br>                <span class="hljs-comment">//这个是它的回调函数，</span><br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res)<br>                <span class="hljs-keyword">if</span> (res.<span class="hljs-property">code</span> === <span class="hljs-number">1</span>) &#123;<br>                  <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">success</span>(<span class="hljs-string">&#x27;分类添加成功！&#x27;</span>)<br>                  <span class="hljs-keyword">if</span> (!st) &#123;<br>                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">classData</span>.<span class="hljs-property">dialogVisible</span> = <span class="hljs-literal">false</span><br>                  &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">classData</span>.<span class="hljs-property">name</span> = <span class="hljs-string">&#x27;&#x27;</span><br>                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">classData</span>.<span class="hljs-property">sort</span> = <span class="hljs-string">&#x27;&#x27;</span><br>                  &#125;<br>            <span class="hljs-comment">//这个是指重新回到分类查询的第一页</span><br>                  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleQuery</span>()<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                  <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(res.<span class="hljs-property">msg</span> || <span class="hljs-string">&#x27;操作失败&#x27;</span>)<br>                &#125;<br>              &#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;<br>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;请求出错了：&#x27;</span> + err)<br>              &#125;)<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;排序只能输入数字类型&#x27;</span>)<br>            &#125;<br>            <br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;请输入分类名称或排序&#x27;</span>)<br>        &#125;<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (valid) &#123;<br>        <span class="hljs-keyword">const</span> reg = <span class="hljs-regexp">/^\d+$/</span><br>        <span class="hljs-keyword">if</span> (reg.<span class="hljs-title function_">test</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">classData</span>.<span class="hljs-property">sort</span>)) &#123;<br>          <span class="hljs-comment">//这里是发起修改的ajax请求的地方</span><br>            <span class="hljs-comment">//返回成功之后执行then的回调函数</span><br>          <span class="hljs-title function_">editCategory</span>(&#123;<span class="hljs-string">&#x27;id&#x27;</span>:<span class="hljs-variable language_">this</span>.<span class="hljs-property">classData</span>.<span class="hljs-property">id</span>,<span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">classData</span>.<span class="hljs-property">name</span>, <span class="hljs-attr">sort</span>:<br>                        <span class="hljs-variable language_">this</span>.<span class="hljs-property">classData</span>.<span class="hljs-property">sort</span>&#125;).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;<br>            <span class="hljs-keyword">if</span> (res.<span class="hljs-property">code</span> === <span class="hljs-number">1</span>) &#123;<br>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">success</span>(<span class="hljs-string">&#x27;分类修改成功！&#x27;</span>)<br>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">classData</span>.<span class="hljs-property">dialogVisible</span> = <span class="hljs-literal">false</span><br>            <span class="hljs-comment">//这个是指重新回到分类查询的第一页</span><br>              <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleQuery</span>()<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(res.<span class="hljs-property">msg</span> || <span class="hljs-string">&#x27;操作失败&#x27;</span>)<br>            &#125;<br>          &#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;<br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;请求出错了：&#x27;</span> + err)<br>          &#125;)<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;排序只能输入数字类型&#x27;</span>)<br>        &#125;<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;请输入分类名称或排序&#x27;</span>)<br>      &#125;<br>    &#125;,<br></code></pre></td></tr></table></figure>

<p>list.html</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 修改接口</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">editCategory</span> = (<span class="hljs-params">params</span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> $axios(&#123;<br>    <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/category&#x27;</span>,<br>    <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;put&#x27;</span>,<br>    <span class="hljs-attr">data</span>: &#123; ...params &#125;<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure>



<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202211272050555.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221127205028563"></p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202211272050406.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221127205033328"></p>
<p>点击确定之后发起的请求</p>
<p>Controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@PutMapping</span><br><span class="hljs-keyword">public</span> R&lt;String&gt; <span class="hljs-title function_">update</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span>  Category category)</span>&#123;<br>    categoryService.updateById(category);<br>    <span class="hljs-keyword">return</span> R.success(<span class="hljs-string">&quot;修改完成&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<h1 id="Day4"><a href="#Day4" class="headerlink" title="Day4"></a>Day4</h1><p>菜品的展示</p>
<h2 id="文件的上传下载"><a href="#文件的上传下载" class="headerlink" title="文件的上传下载"></a>文件的上传下载</h2><p><strong>文件上传要springmvc，瑞吉外卖和springboot中三个一起看</strong></p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202211281420278.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221128142026032"></p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202211281423262.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221128142310861"></p>
<p>把文件上传的页面拷贝到page的demo目录下，上传文件之后会发起的请求</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202211281452785.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221128145200516"></p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202211281452168.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221128145207000"></p>
<p>上传文件的标签在源码中不显示是因为elementui的封装，但现在可以在元素看到name&#x3D;file</p>
<p>文件上传的Controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.controller;<br><br><span class="hljs-keyword">import</span> com.itheima.reggie.common.R;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PostMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestParam;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><span class="hljs-keyword">import</span> org.springframework.web.multipart.MultipartFile;<br><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/common&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CommonController</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 文件上传</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> file</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@PostMapping(&quot;/upload&quot;)</span><br><br><span class="hljs-keyword">public</span> R&lt;String&gt; <span class="hljs-title function_">upload</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;file&quot;)</span> MultipartFile file)</span>&#123;<br>        <span class="hljs-comment">//file是一个临时文件，需要转存到指定位置，否则本次请求完成后临时文件会删除</span><br>    log.info(file.toString());<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>完善：把图片转存到指定位置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">try</span> &#123;<br>           <span class="hljs-comment">//调用这个方法的时候除了文件可以不存在，路径上的文件夹都一定要存在</span><br>           <span class="hljs-comment">//这个方法是把file文件转存到指定路径</span><br>           file.transferTo(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(basePath+filename));<br>       &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>           e.printStackTrace();<br>       &#125;<br></code></pre></td></tr></table></figure>

<p>特点：把文件存储的路径，放到yml文件中管理方便修改</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.controller;<br><br><span class="hljs-keyword">import</span> com.itheima.reggie.common.R;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Value;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PostMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestParam;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><span class="hljs-keyword">import</span> org.springframework.web.multipart.MultipartFile;<br><br><span class="hljs-keyword">import</span> java.io.File;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.util.UUID;<br><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/common&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CommonController</span> &#123;<br><br>    <span class="hljs-meta">@Value(&quot;$&#123;reggie.basePath&#125;&quot;)</span><br>    <span class="hljs-comment">//从application.yml文件中获取这个路径</span><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    reggie:</span><br><span class="hljs-comment">      basePath: D:\img1\</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String basePath;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 文件上传</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> file</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@PostMapping(&quot;/upload&quot;)</span><br><br><span class="hljs-keyword">public</span> R&lt;String&gt; <span class="hljs-title function_">upload</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;file&quot;)</span> MultipartFile file)</span>&#123;<br>        <span class="hljs-comment">//file是一个临时文件，需要转存到指定位置，否则本次请求完成后临时文件会删除</span><br>    log.info(file.toString());<br><br>    <span class="hljs-comment">//原始文件名</span><br>    String originalFilename=file.getOriginalFilename();<br>    <span class="hljs-comment">//获取文件的后缀名</span><br>    String suffix=originalFilename.substring(originalFilename.lastIndexOf(<span class="hljs-string">&quot;.&quot;</span>));<br><br>    <span class="hljs-comment">//使用UUID重新生成文件名，防止文件名称重复造成文件覆盖</span><br>        <span class="hljs-comment">//uuid是一个随机生成不重复文件名的工具</span><br>        String filename= UUID.randomUUID().toString()+suffix;<br><br>        <span class="hljs-comment">//创建一个目录对象</span><br>        File dir=<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(basePath);<br>        <span class="hljs-comment">//判断当前目录是否存在，如果不存在就创建这个目录</span><br>        <br>        <span class="hljs-keyword">if</span>(!dir.exists())&#123;<br>            <span class="hljs-comment">//mkdirs是用来创建文件夹的不能创建文件</span><br>           dir.mkdirs();<br>        &#125;<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//调用这个方法的时候除了文件可以不存在，路径上的文件夹都一定要存在</span><br>            <span class="hljs-comment">//这个方法是把file文件转存到指定路径</span><br>            file.transferTo(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(basePath+filename));<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> R.success(filename);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>application.yml设置basePath路径</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">reggie:</span><br>  <span class="hljs-attr">basePath:</span> <span class="hljs-string">D:\img1\</span><br></code></pre></td></tr></table></figure>

<p>application.yml设置上传文件的大小</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">servlet:</span><br>    <span class="hljs-attr">multipart:</span><br><span class="hljs-comment">#一个文件的最大的内存</span><br>      <span class="hljs-attr">max-file-size:</span> <span class="hljs-string">10MB</span><br><span class="hljs-comment">#多文件上传的上传的所有文件的总共最大的内存</span><br>      <span class="hljs-attr">max-request-size:</span> <span class="hljs-string">100MB</span><br></code></pre></td></tr></table></figure>



<p><strong>文件的下载</strong></p>
<p><strong>通过文件的下载，可以实现上传的文件在浏览器页面上显示的效果</strong></p>
<p>文件上传成功后，前端会自动发起文件下载在浏览器上显示的请求</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202211281619088.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221128161904001"></p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202211281614438.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221128161456409"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java">    <span class="hljs-meta">@GetMapping(&quot;/download&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">download</span><span class="hljs-params">(String name , HttpServletResponse response)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br><span class="hljs-comment">//输入流，通过输入流读取文件内容</span><br>            <span class="hljs-type">FileInputStream</span> <span class="hljs-variable">fileInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(basePath + name));<br><br>            <span class="hljs-comment">//输出流，通过输出流将文件写回浏览器，在浏览器展示图片了</span><br>            <span class="hljs-type">ServletOutputStream</span> <span class="hljs-variable">outputStream</span> <span class="hljs-operator">=</span> response.getOutputStream();<br><br>            <span class="hljs-comment">//设置响应回去的文件时图片类型</span><br>            response.setContentType(<span class="hljs-string">&quot;image/jpeg&quot;</span>);<br><br>            <span class="hljs-type">byte</span>[] bytes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">1024</span>];<br>            <span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>            <span class="hljs-comment">//把文件通过输入流输入到byte数组</span><br>            <span class="hljs-comment">//两个流之间进行配合，输入流把文件输入到内存中，然后输出流再把文件协会到浏览器</span><br>            <span class="hljs-keyword">while</span> ((len = fileInputStream.read(bytes)) != -<span class="hljs-number">1</span>) &#123;<br>                outputStream.write(bytes, <span class="hljs-number">0</span>, len);<br>            &#125;<br><br>            <span class="hljs-comment">//关闭资源</span><br>            outputStream.close();<br>            fileInputStream.close();<br><br>        &#125;<br>        <span class="hljs-keyword">catch</span>(Exception e)&#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure>

<p>文件上传页面的前端代码</p>
<p>上传成功后调用handleAvatarSuccess方法，会发起文件下载（在浏览器页面上显示）请求，请求带着文件的名称</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;!<span class="hljs-variable constant_">DOCTYPE</span> html&gt;<br>&lt;html lang=&quot;en&quot;&gt;<br>&lt;head&gt;<br>  &lt;meta charset=&quot;UTF-8&quot;&gt;<br>  &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;<br>  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;<br>  &lt;title&gt;文件上传&lt;/title&gt;<br>  &lt;!-- 引入样式 --&gt;<br>  &lt;link rel=&quot;stylesheet&quot; href=&quot;../../plugins/element-ui/index.css&quot; /&gt;<br>  &lt;link rel=&quot;stylesheet&quot; href=&quot;../../styles/common.css&quot; /&gt;<br>  &lt;link rel=&quot;stylesheet&quot; href=&quot;../../styles/page.css&quot; /&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>   &lt;div class=&quot;addBrand-container&quot; id=&quot;food-add-app&quot;&gt;<br>    &lt;div class=&quot;container&quot;&gt;<br>        &lt;!--action就是上传文件请求的地址--&gt;<br>        &lt;!--on-success是上传成功之后要调用的方法--&gt;<br>        &lt;el-upload class=&quot;avatar-uploader&quot;<br>                action=&quot;/common/upload&quot;<br>                :show-file-list=&quot;false&quot;<br>                :on-success=&quot;handleAvatarSuccess&quot;<br>                :before-upload=&quot;beforeUpload&quot;<br>                ref=&quot;upload&quot;&gt;<br>            &lt;img v-if=&quot;imageUrl&quot; :src=&quot;imageUrl&quot; class=&quot;avatar&quot;&gt;&lt;/img&gt;<br>            &lt;i v-else class=&quot;el-icon-plus avatar-uploader-icon&quot;&gt;&lt;/i&gt;<br>        &lt;/el-upload&gt;<br>    &lt;/div&gt;<br>  &lt;/div&gt;<br>    &lt;!-- 开发环境版本，包含了有帮助的命令行警告 --&gt;<br>    &lt;script src=&quot;../../plugins/vue/vue.js&quot;&gt;&lt;/script&gt;<br>    &lt;!-- 引入组件库 --&gt;<br>    &lt;script src=&quot;../../plugins/element-ui/index.js&quot;&gt;&lt;/script&gt;<br>    &lt;!-- 引入axios --&gt;<br>    &lt;script src=&quot;../../plugins/axios/axios.min.js&quot;&gt;&lt;/script&gt;<br>    &lt;script src=&quot;../../js/index.js&quot;&gt;&lt;/script&gt;<br>    &lt;script&gt;<br>      new Vue(&#123;<br>        el: &#x27;#food-add-app&#x27;,<br>        data() &#123;<br>          return &#123;<br>            imageUrl: &#x27;&#x27;<br>          &#125;<br>        &#125;,<br>        methods: &#123;<br>            //这里就是上传文件成功之后，又重新发起下载文件在浏览器上显示的请求<br>            //response.data会<br>          handleAvatarSuccess (response, file, fileList) &#123;<br>              this.imageUrl = `/common/download?name=$&#123;response.data&#125;`<br>          &#125;,<br>          beforeUpload (file) &#123;<br>            if(file)&#123;<br>              const suffix = file.name.split(&#x27;.&#x27;)[1]<br>              const size = file.size / 1024 / 1024 &lt; 2<br>              if([&#x27;png&#x27;,&#x27;jpeg&#x27;,&#x27;jpg&#x27;].indexOf(suffix) &lt; 0)&#123;<br>                this.$message.error(&#x27;上传图片只支持 png、jpeg、jpg 格式！&#x27;)<br>                this.$refs.upload.clearFiles()<br>                return false<br>              &#125;<br>              if(!size)&#123;<br>                this.$message.error(&#x27;上传文件大小不能超过 2MB!&#x27;)<br>                return false<br>              &#125;<br>              return file<br>            &#125;<br>          &#125;<br>        &#125;<br>      &#125;)<br>    &lt;/script&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure>

<h2 id="新增菜品"><a href="#新增菜品" class="headerlink" title="新增菜品"></a>新增菜品</h2><p>这是新增菜品页面<a target="_blank" rel="noopener" href="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212011417771.png">https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212011417771.png</a></p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212011354860.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221201135414783"></p>
<p>前面这个是dish_flavour表中的name字段，后面这个是dish_flavour表中的value字段</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212011355675.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221201135507646"></p>
<p>这个用category_id来表示</p>
<p>点击新建菜品之后的跳转</p>
<p><a target="_blank" rel="noopener" href="http://localhost:8080/backend/page/food/add">http://localhost:8080/backend/page/food/add</a></p>
<p>然后浏览器会发出一个请求，请求服务端获取菜品分类数据展示到下拉框中</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212011410439.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221201141025576"></p>
<p>代码开发</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212011417771.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221201141700474"></p>
<p>1.获取菜品分类数据到下拉框</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212011423344.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221201142328479"></p>
<p>CategoryController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">新增菜品的时候，点击新增菜品，查询菜品分类在下拉框里</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@GetMapping(&quot;/list&quot;)</span><br><span class="hljs-keyword">public</span> R&lt;List&lt;Category&gt;&gt; <span class="hljs-title function_">list</span><span class="hljs-params">(Category category)</span>&#123;<br>    <span class="hljs-comment">//创建条件构造器</span><br>    LambdaQueryWrapper&lt;Category&gt; lambdaQueryWrapper=<span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>    <span class="hljs-comment">//添加条件</span><br>    lambdaQueryWrapper.eq(category.getType()!=<span class="hljs-literal">null</span>,Category::getType,category.getType());<br>    <span class="hljs-comment">//添加排序条件</span><br>    lambdaQueryWrapper.orderByAsc(Category::getSort).orderByDesc(Category::getUpdateTime);<br>    <br>    <span class="hljs-comment">//把搜索出来的放在list集合中</span><br>    List&lt;Category&gt; list=categoryService.list(lambdaQueryWrapper);<br>    <br>    <br>    <span class="hljs-keyword">return</span> R.success(list);<br>&#125;<br></code></pre></td></tr></table></figure>



<p>接受页面提交的数据</p>
<p>点击保存之后发起的请求和负载</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212011451753.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221201145106743"></p>
<p><img src="D:\img\image-20221201145114441.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221201145114441"></p>
<p>除了flavors之外其他都是Dish类的属性，flavors是一个数组，前端选择了几个口味数组中就有几个元素，每个元素中的那些值都是对应DishFlavor类中的属性，在后端可以用List来接受flavors</p>
<p>所以不能用Dish或者DishFlavor的任何一个对象来接受所有的参数，所以要创建一个新的类来能够接受所有的参数</p>
<p>所以导入DishDto，用于封装页面提交的数据，在资料里面直接拿就可以了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.dto;<br><br><span class="hljs-keyword">import</span> com.itheima.reggie.entity.Dish;<br><span class="hljs-keyword">import</span> com.itheima.reggie.entity.DishFlavor;<br><span class="hljs-keyword">import</span> lombok.Data;<br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-comment">//继承了Dish之后就可以接受Dish中属性的参数</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DishDto</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Dish</span> &#123;<br><br>    <span class="hljs-keyword">private</span> List&lt;DishFlavor&gt; flavors = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br><br>    <span class="hljs-keyword">private</span> String categoryName;<br><br>    <span class="hljs-keyword">private</span> Integer copies;<br>&#125;<br></code></pre></td></tr></table></figure>



<p>提交的数据是json数据，所以方法接受参数的时候要加一个@RequestBody</p>
<p>DishController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.controller;<br><br><span class="hljs-keyword">import</span> com.itheima.reggie.common.R;<br><span class="hljs-keyword">import</span> com.itheima.reggie.dto.DishDto;<br><span class="hljs-keyword">import</span> com.itheima.reggie.service.DishFlavorService;<br><span class="hljs-keyword">import</span> com.itheima.reggie.service.DishService;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PostMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestBody;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/dish&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DishController</span> &#123;<br><br>    <span class="hljs-comment">//菜品</span><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> DishService dishService;<br><br>    <span class="hljs-comment">//口味</span><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> DishFlavorService dishFlavorService;<br><br>    <span class="hljs-meta">@PostMapping</span><br>    <span class="hljs-keyword">public</span> R&lt;String&gt; <span class="hljs-title function_">save</span><span class="hljs-params">( <span class="hljs-meta">@RequestBody</span> DishDto dishDto)</span>&#123;<br>        <span class="hljs-comment">//这个save里除了是Dish类是Dish类的子类也是可以的</span><br>        <span class="hljs-comment">//dishService.save(dishDto);</span><br>         dishService.saveWithDishFlavor(dishDto);<br>         <span class="hljs-keyword">return</span> R.success(<span class="hljs-string">&quot;保存成功&quot;</span>);<br><br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>这里的saveWithDishFlavor方法是自己设计的</p>
<p>DishService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.service;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;<br><span class="hljs-keyword">import</span> com.itheima.reggie.dto.DishDto;<br><span class="hljs-keyword">import</span> com.itheima.reggie.entity.Dish;<br><span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Mapper;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">DishService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">IService</span>&lt;Dish&gt; &#123;<br>    <span class="hljs-comment">//保存到dish中同时保存到flavor表中</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveWithDishFlavor</span><span class="hljs-params">(DishDto dishDto)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>



<p>DishServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.service.impl;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;<br><span class="hljs-keyword">import</span> com.itheima.reggie.dto.DishDto;<br><span class="hljs-keyword">import</span> com.itheima.reggie.entity.Dish;<br><span class="hljs-keyword">import</span> com.itheima.reggie.entity.DishFlavor;<br><span class="hljs-keyword">import</span> com.itheima.reggie.mapper.DishMapper;<br><span class="hljs-keyword">import</span> com.itheima.reggie.service.DishFlavorService;<br><span class="hljs-keyword">import</span> com.itheima.reggie.service.DishService;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><span class="hljs-keyword">import</span> org.springframework.transaction.annotation.Transactional;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DishServiceImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ServiceImpl</span>&lt;DishMapper, Dish&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">DishService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> DishFlavorService dishFlavorService;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-comment">//这里涉及到多个事务，所以用注解开启事务管理</span><br>    <span class="hljs-comment">//这里是遇到所有的异常都回滚的意思</span><br>    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveWithDishFlavor</span><span class="hljs-params">(DishDto dishDto)</span> &#123;<br><br>        <span class="hljs-comment">//保存dish的属性</span><br>        <span class="hljs-built_in">this</span>.save(dishDto);<br><br>        List&lt;DishFlavor&gt; flavors = dishDto.getFlavors();<br>        <span class="hljs-comment">//获取菜品所属的类的id</span><br>        <span class="hljs-type">Long</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> dishDto.getId();<br>        <span class="hljs-comment">//给每一个flavor复制</span><br>        <span class="hljs-keyword">for</span> (DishFlavor flavor : flavors) &#123;<br>            flavor.setDishId(id);<br>        &#125;<br>        <span class="hljs-comment">//批量引入</span><br>        dishFlavorService.saveBatch(flavors);<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="菜品信息的分页查询"><a href="#菜品信息的分页查询" class="headerlink" title="菜品信息的分页查询"></a>菜品信息的分页查询</h2><p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212011649490.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221201164958242"></p>
<p>1.页面发送ajax请求</p>
<p>难点：在页面的时候展示的是菜品的分类名称，但是在菜品表中只有菜品的分类的id所以要进行两表联查</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212011648664.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221201164819866"></p>
<p>这个请求是一进入菜品管理这个页面就会发起的请求，当然一进入发起的没有name参数，当搜索菜品名称的时候就有name参数了</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212011649624.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221201164927763"></p>
<p>DishController</p>
<p>第二个方法是分页查询的显示</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.controller;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;<br><span class="hljs-keyword">import</span> com.itheima.reggie.common.R;<br><span class="hljs-keyword">import</span> com.itheima.reggie.dto.DishDto;<br><span class="hljs-keyword">import</span> com.itheima.reggie.entity.Category;<br><span class="hljs-keyword">import</span> com.itheima.reggie.entity.Dish;<br><span class="hljs-keyword">import</span> com.itheima.reggie.service.CategoryService;<br><span class="hljs-keyword">import</span> com.itheima.reggie.service.DishFlavorService;<br><span class="hljs-keyword">import</span> com.itheima.reggie.service.DishService;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.beans.BeanUtils;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;<br><br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/dish&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DishController</span> &#123;<br><br>    <span class="hljs-comment">//菜品</span><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> DishService dishService;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> CategoryService categoryService;<br><br>    <span class="hljs-comment">//口味</span><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> DishFlavorService dishFlavorService;<br><br>    <span class="hljs-meta">@PostMapping</span><br>    <span class="hljs-keyword">public</span> R&lt;String&gt; <span class="hljs-title function_">save</span><span class="hljs-params">( <span class="hljs-meta">@RequestBody</span> DishDto dishDto)</span>&#123;<br>        <span class="hljs-comment">//这个save里除了是Dish类是Dish类的子类也是可以的</span><br>        <span class="hljs-comment">//dishService.save(dishDto);</span><br>         dishService.saveWithDishFlavor(dishDto);<br>         <span class="hljs-keyword">return</span> R.success(<span class="hljs-string">&quot;保存成功&quot;</span>);<br><br><br>    &#125;<br><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    查询方法</span><br><span class="hljs-comment">     */</span><br>    <br>    <span class="hljs-comment">//因为Dish对象中的菜品类型是以id存储的，页面需要显示的是名称，所以要把page对象中的records换一下</span><br>    <span class="hljs-comment">//要新建一个分页对象，其他属性和Dish那个分页对象一样，只有records要进行修改，把里面内容换为DishDto对象的内容</span><br>    <span class="hljs-comment">//主要是因为DishDto没有自己的Service，像这种查询的dishService必须要求这个条件构造器是Dish泛型的，所以就得向上面这样分布搞</span><br>    <span class="hljs-meta">@GetMapping(&quot;/page&quot;)</span><br>    <span class="hljs-keyword">public</span> R&lt;Page&gt; <span class="hljs-title function_">page</span><span class="hljs-params">(<span class="hljs-type">int</span> page,<span class="hljs-type">int</span> pageSize,String name)</span>&#123;<br>        Page&lt;Dish&gt; pageInfo=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>&lt;&gt;(page,pageSize);<br>        Page&lt;DishDto&gt; dishDto=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>&lt;&gt;(page,pageSize);<br>        <span class="hljs-comment">//条件构造器</span><br>        LambdaQueryWrapper&lt;Dish&gt; lambdaQueryWrapper=<span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;Dish&gt;();<br>         lambdaQueryWrapper.like(name != <span class="hljs-literal">null</span>, Dish::getName, name);<br>        dishService.page(pageInfo,lambdaQueryWrapper);<br><br>        <span class="hljs-comment">//把pageInfo对象中除了records属性都拷贝一份到dishDto对象中</span><br>        BeanUtils.copyProperties(pageInfo,dishDto,<span class="hljs-string">&quot;records&quot;</span>);<br>        List&lt;Dish&gt; records = pageInfo.getRecords();<br>        List&lt;DishDto&gt; records2=<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <span class="hljs-keyword">for</span> (Dish record : records) &#123;<br>            <span class="hljs-type">Long</span> <span class="hljs-variable">categoryId</span> <span class="hljs-operator">=</span> record.getCategoryId();<br>            <span class="hljs-type">Category</span> <span class="hljs-variable">category</span> <span class="hljs-operator">=</span> categoryService.getById(categoryId);<br>            <span class="hljs-type">String</span> <span class="hljs-variable">categoryName</span> <span class="hljs-operator">=</span> category.getName();<br>            DishDto dishDto1=<span class="hljs-keyword">new</span> <span class="hljs-title class_">DishDto</span>();<br>            BeanUtils.copyProperties(record,dishDto1);<br>            dishDto1.setCategoryName(categoryName);<br>            records2.add(dishDto1);<br>        &#125;<br><br>        dishDto.setRecords(records2);<br>        <span class="hljs-keyword">return</span> R.success(dishDto);<br><br>    &#125;<br><br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>这里没图片正常因为，数据库导入的只是一些数字罢了，没有真的上传图片这个操作</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212011840260.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221201184001198"></p>
<h2 id="修改菜品信息"><a href="#修改菜品信息" class="headerlink" title="修改菜品信息"></a>修改菜品信息</h2><p>点击修改之后，发送这个请求带着的是菜品的id</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212011943993.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221201194316506"></p>
<p>1.再修改页面获取要修改的菜品的信息</p>
<p>DishController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">再修改页面上获取原本的菜品信息</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span><br><span class="hljs-keyword">public</span> R&lt;DishDto&gt; <span class="hljs-title function_">edit</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> <span class="hljs-type">long</span> id)</span>&#123;<br>    <span class="hljs-type">DishDto</span> <span class="hljs-variable">dishDto</span> <span class="hljs-operator">=</span> dishService.get(id);<br><br>    <span class="hljs-keyword">return</span> R.success(dishDto);<br><br>&#125;<br></code></pre></td></tr></table></figure>



<p>DishServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">   获取要修改的菜品的信息</span><br><span class="hljs-comment">    */</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> DishDto <span class="hljs-title function_">get</span><span class="hljs-params">(Long id)</span> &#123;<br>    <span class="hljs-comment">//获取菜品对象</span><br>    <span class="hljs-type">Dish</span> <span class="hljs-variable">dish</span> <span class="hljs-operator">=</span> dishService.getById(id);<br><br>    <span class="hljs-comment">//获取菜品对应的类型id</span><br>    <span class="hljs-type">Long</span> <span class="hljs-variable">categoryId</span> <span class="hljs-operator">=</span> dish.getCategoryId();<br><br>    <span class="hljs-comment">//获取菜品类型</span><br>    <span class="hljs-type">Category</span> <span class="hljs-variable">category</span> <span class="hljs-operator">=</span> categoryService.getById(categoryId);<br><br>    <span class="hljs-comment">//获取类型的名称</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> category.getName();<br><br>    <span class="hljs-comment">//把dish中的属性都赋值到dishDto中</span><br>    DishDto dishDto=<span class="hljs-keyword">new</span> <span class="hljs-title class_">DishDto</span>();<br>    dishDto.setCategoryName(name);<br>    BeanUtils.copyProperties(dish,dishDto);<br><br>    <span class="hljs-comment">//条件构造器</span><br>    LambdaQueryWrapper&lt;DishFlavor&gt; lambdaQueryWrapper=<span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;DishFlavor&gt;();<br>    lambdaQueryWrapper.eq(DishFlavor::getDishId,id);<br><br>    <span class="hljs-comment">//获取dishDto中的flavors属性的值</span><br>    List&lt;DishFlavor&gt; list = dishFlavorService.list(lambdaQueryWrapper);<br><br>    dishDto.setFlavors(list);<br>    <span class="hljs-keyword">return</span> dishDto;<br>&#125;<br></code></pre></td></tr></table></figure>



<p>2.修改页面点击保存发起的请求</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212012019470.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221201201924743"></p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212012020003.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221201202044142"></p>
<p>DishServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.service.impl;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.conditions.update.LambdaUpdateWrapper;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;<br><span class="hljs-keyword">import</span> com.itheima.reggie.dto.DishDto;<br><span class="hljs-keyword">import</span> com.itheima.reggie.entity.Category;<br><span class="hljs-keyword">import</span> com.itheima.reggie.entity.Dish;<br><span class="hljs-keyword">import</span> com.itheima.reggie.entity.DishFlavor;<br><span class="hljs-keyword">import</span> com.itheima.reggie.mapper.DishMapper;<br><span class="hljs-keyword">import</span> com.itheima.reggie.service.CategoryService;<br><span class="hljs-keyword">import</span> com.itheima.reggie.service.DishFlavorService;<br><span class="hljs-keyword">import</span> com.itheima.reggie.service.DishService;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.beans.BeanUtils;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><span class="hljs-keyword">import</span> org.springframework.transaction.annotation.Transactional;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestBody;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DishServiceImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ServiceImpl</span>&lt;DishMapper, Dish&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">DishService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> DishFlavorService dishFlavorService;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> DishService dishService;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> CategoryService categoryService;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-comment">//这里涉及到多个事务，所以用注解开启事务管理</span><br>    <span class="hljs-comment">//这里是遇到所有的异常都回滚的意思</span><br>    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveWithDishFlavor</span><span class="hljs-params">(DishDto dishDto)</span> &#123;<br><br>        <span class="hljs-comment">//保存dish的属性</span><br>        <span class="hljs-built_in">this</span>.save(dishDto);<br><br>        List&lt;DishFlavor&gt; flavors = dishDto.getFlavors();<br>        <span class="hljs-comment">//获取菜品所属的类的id</span><br>        <span class="hljs-type">Long</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> dishDto.getId();<br>        <span class="hljs-comment">//给每一个flavor复制</span><br>        <span class="hljs-keyword">for</span> (DishFlavor flavor : flavors) &#123;<br>            flavor.setDishId(id);<br>        &#125;<br>        <span class="hljs-comment">//批量引入</span><br>        dishFlavorService.saveBatch(flavors);<br><br>    &#125;<br><br><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    获取要修改的菜品的信息</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> DishDto <span class="hljs-title function_">get</span><span class="hljs-params">(Long id)</span> &#123;<br>        <span class="hljs-comment">//获取菜品对象</span><br>        <span class="hljs-type">Dish</span> <span class="hljs-variable">dish</span> <span class="hljs-operator">=</span> dishService.getById(id);<br><br>        <span class="hljs-comment">//获取菜品对应的类型id</span><br>        <span class="hljs-type">Long</span> <span class="hljs-variable">categoryId</span> <span class="hljs-operator">=</span> dish.getCategoryId();<br><br>        <span class="hljs-comment">//获取菜品类型</span><br>        <span class="hljs-type">Category</span> <span class="hljs-variable">category</span> <span class="hljs-operator">=</span> categoryService.getById(categoryId);<br><br>        <span class="hljs-comment">//获取类型的名称</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> category.getName();<br><br>        <span class="hljs-comment">//把dish中的属性都赋值到dishDto中</span><br>        DishDto dishDto=<span class="hljs-keyword">new</span> <span class="hljs-title class_">DishDto</span>();<br>        dishDto.setCategoryName(name);<br>        BeanUtils.copyProperties(dish,dishDto);<br><br>        <span class="hljs-comment">//条件构造器</span><br>        LambdaQueryWrapper&lt;DishFlavor&gt; lambdaQueryWrapper=<span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;DishFlavor&gt;();<br>        lambdaQueryWrapper.eq(DishFlavor::getDishId,id);<br><br>        <span class="hljs-comment">//获取dishDto中的flavors属性的值</span><br>        List&lt;DishFlavor&gt; list = dishFlavorService.list(lambdaQueryWrapper);<br><br>        dishDto.setFlavors(list);<br>        <span class="hljs-keyword">return</span> dishDto;<br>    &#125;<br><br><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    修改菜品的方法</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-comment">//既要对dish表进行修改，也要对dishFlavor表进行修改</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateWithDishFlavor</span><span class="hljs-params">(  DishDto dishDto)</span>&#123;<br><br>       <span class="hljs-comment">//把dish表先修改了</span><br>        <span class="hljs-comment">//dishDto是Dish的子类的对象，也可以进行修改</span><br>        <span class="hljs-comment">//这个update是根据id修改</span><br>        <span class="hljs-built_in">this</span>.updateById(dishDto);<br><br>        <span class="hljs-comment">//删除原本口味表中的记录</span><br>        LambdaQueryWrapper&lt;DishFlavor&gt; lambdaQueryWrapper=<span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;DishFlavor&gt;();<br>        lambdaQueryWrapper.eq(DishFlavor::getDishId,dishDto.getId());<br>        dishFlavorService.remove(lambdaQueryWrapper);<br><br>       Long Dishid=dishDto.getId();<br>        <span class="hljs-comment">//这个flavors中的DishFlavor中的dishid都没有被赋值</span><br>        List&lt;DishFlavor&gt; flavors = dishDto.getFlavors();<br>        <span class="hljs-keyword">for</span> (DishFlavor flavor : flavors) &#123;<br>            flavor.setDishId(Dishid);<br>        &#125;<br><br>        <span class="hljs-comment">//批量对flavor表中进行插入</span><br>        dishFlavorService.saveBatch(flavors);<br><br>    &#125;<br><br><br>&#125;<br></code></pre></td></tr></table></figure>



<p>DishService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.service;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;<br><span class="hljs-keyword">import</span> com.itheima.reggie.dto.DishDto;<br><span class="hljs-keyword">import</span> com.itheima.reggie.entity.Dish;<br><span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Mapper;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">DishService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">IService</span>&lt;Dish&gt; &#123;<br>    <span class="hljs-comment">//保存到dish中同时保存到flavor表中</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveWithDishFlavor</span><span class="hljs-params">(DishDto dishDto)</span>;<br><br>    <span class="hljs-comment">//修改dish表的同时修改flavor表</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateWithDishFlavor</span><span class="hljs-params">(DishDto dishDto)</span>;<br><br>    <span class="hljs-comment">//查找要修改的记录的数据显示到修改页面上</span><br>    <span class="hljs-keyword">public</span> DishDto <span class="hljs-title function_">get</span><span class="hljs-params">(Long id)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="删除菜品信息"><a href="#删除菜品信息" class="headerlink" title="删除菜品信息"></a>删除菜品信息</h2><p>点击删除之后服务器发起的请求</p>
<p><img src="D:\img\image-20221202185513877.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221202185513877"></p>
<p>Controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">删除对应的信息</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@DeleteMapping</span><br><span class="hljs-keyword">public</span> R&lt;String&gt; <span class="hljs-title function_">delete</span><span class="hljs-params">( <span class="hljs-type">long</span> ids)</span>&#123;<br><br>    <span class="hljs-comment">//删除dish表中数据</span><br>    dishService.removeById(ids);<br><br>    <span class="hljs-comment">//删除dishflavor表中的数据</span><br>    LambdaQueryWrapper&lt;DishFlavor&gt; lambdaQueryWrapper=<span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>    lambdaQueryWrapper.eq(DishFlavor::getDishId,ids);<br>    dishFlavorService.remove(lambdaQueryWrapper);<br>    <br>    <span class="hljs-keyword">return</span> R.success(<span class="hljs-string">&quot;删除成功了&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="停售功能"><a href="#停售功能" class="headerlink" title="停售功能"></a>停售功能</h2><p>dish表中的status字段为1则是起售，为0则是停售</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212021910659.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221202191017310"></p>
<p>DishController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">改变商品功能的信息</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@PostMapping(&quot;/status/&#123;status&#125;&quot;)</span><br><span class="hljs-keyword">public</span> R&lt;String&gt; <span class="hljs-title function_">editStatus</span><span class="hljs-params">(Long ids,<span class="hljs-meta">@PathVariable</span> <span class="hljs-type">int</span> status)</span>&#123;<br><br><br>    <span class="hljs-comment">//创建一个菜品对象,并把获得的id赋值给这个对象</span><br>    Dish dish=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Dish</span>();<br>    dish.setId(ids);<br><br>    <span class="hljs-comment">//将获取的id存放在dish对象中，并且设置status为传递的参数</span><br>    dish.setStatus(status);<br><br>    <span class="hljs-comment">//对status进行修改，创建时间和创建人什么的只写都是写过自动的</span><br>    dishService.updateById(dish);<br><br>    <span class="hljs-keyword">return</span> R.success(<span class="hljs-string">&quot;修改成功&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="批量删除功能"><a href="#批量删除功能" class="headerlink" title="批量删除功能"></a>批量删除功能</h2><p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212021927423.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221202192713121"></p>
<p>要把原来的删除方法改一下，可以用数组来接受这种ids多值传参的情况</p>
<p>DishServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//删除记录</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">delete</span><span class="hljs-params">(Long[] ids)</span> &#123;<br>    <span class="hljs-comment">//查询套餐状态，确定是否真的要删除</span><br>    <span class="hljs-comment">//条件构造器中的条件是指套餐id在这些参数里面，套餐的状态还是可用状态的</span><br>    <span class="hljs-comment">//就是可用状态的套餐是不能够随便删除的</span><br>    LambdaQueryWrapper&lt;Dish&gt; lambdaQueryWrapper1=<span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>    lambdaQueryWrapper1.in(Dish::getId,ids);<br>    lambdaQueryWrapper1.eq(Dish::getStatus,<span class="hljs-number">1</span>);<br><br>    <span class="hljs-comment">//返回符合这个条件构造器的记录的个数</span><br>    <span class="hljs-type">int</span> count=<span class="hljs-built_in">this</span>.count(lambdaQueryWrapper1);<br>    <span class="hljs-keyword">if</span>(count&gt;<span class="hljs-number">0</span>)&#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomerException</span>(<span class="hljs-string">&quot;套餐正在售卖中，不能删除&quot;</span>);<br>    &#125;<br><br><br><br>    <span class="hljs-comment">//删除dish表中数据</span><br>    <span class="hljs-comment">//这里removeByIds只能用集合来删除，但接收参数只能用数组</span><br>    List&lt;Long&gt; list = Arrays.asList(ids);<br>    dishService.removeByIds(list);<br><br>    <span class="hljs-comment">//删除dishflavor表中的数据</span><br>    <span class="hljs-keyword">for</span> (Long id : ids) &#123;<br>        LambdaQueryWrapper&lt;DishFlavor&gt; lambdaQueryWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>        lambdaQueryWrapper.eq(DishFlavor::getDishId,id);<br>        dishFlavorService.remove(lambdaQueryWrapper);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>DishService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//删除记录</span><br><span class="hljs-keyword">public</span>  <span class="hljs-keyword">void</span> <span class="hljs-title function_">delete</span><span class="hljs-params">(Long ids[])</span>;<br></code></pre></td></tr></table></figure>

<p>DishController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">删除对应的信息</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@DeleteMapping</span><br><span class="hljs-meta">@Transactional</span><br><span class="hljs-keyword">public</span> R&lt;String&gt; <span class="hljs-title function_">delete</span><span class="hljs-params">( Long ids[])</span>&#123;<br><br>  dishService.delete(ids);<br>    <span class="hljs-keyword">return</span> R.success(<span class="hljs-string">&quot;删除成功了&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>







<h2 id="批量停售和批量起售"><a href="#批量停售和批量起售" class="headerlink" title="批量停售和批量起售"></a>批量停售和批量起售</h2><p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212021948989.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221202194810381"></p>
<p>在原本的起售和停售的功能上进行修改</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">改变商品功能的信息</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@PostMapping(&quot;/status/&#123;status&#125;&quot;)</span><br><span class="hljs-keyword">public</span> R&lt;String&gt; <span class="hljs-title function_">editStatus</span><span class="hljs-params">(Long ids[],<span class="hljs-meta">@PathVariable</span> <span class="hljs-type">int</span> status)</span>&#123;<br><br>    <span class="hljs-keyword">for</span> (Long id : ids) &#123;<br>        <span class="hljs-comment">//创建一个菜品对象,并把获得的id赋值给这个对象</span><br>        <span class="hljs-type">Dish</span> <span class="hljs-variable">dish</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dish</span>();<br>        dish.setId(id);<br><br>        <span class="hljs-comment">//将获取的id存放在dish对象中，并且设置status为传递的参数</span><br>        dish.setStatus(status);<br><br>        <span class="hljs-comment">//对status进行修改，创建时间和创建人什么的只写都是写过自动的</span><br>        dishService.updateById(dish);<br><br>    &#125;<br>    <span class="hljs-keyword">return</span> R.success(<span class="hljs-string">&quot;修改成功&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<h1 id="Day5"><a href="#Day5" class="headerlink" title="Day5"></a>Day5</h1><h2 id="新增套餐"><a href="#新增套餐" class="headerlink" title="新增套餐"></a>新增套餐</h2><p>setdish表是套餐表，setmeal_dish是套餐和菜品的关系的表</p>
<p>导入DTO SetmealDto     ，从资料中导入，这个是用来接受前端传来的参数，以及往前端传参数时用到的类</p>
<p>同时把SetmealDish实体类导入进来，SetDish类之前导入过了</p>
<p>SetmealDto</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.dto;<br><br><span class="hljs-keyword">import</span> com.itheima.reggie.entity.Setmeal;<br><span class="hljs-keyword">import</span> com.itheima.reggie.entity.SetmealDish;<br><span class="hljs-keyword">import</span> lombok.Data;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SetmealDto</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Setmeal</span> &#123;<br><br>    <span class="hljs-keyword">private</span> List&lt;SetmealDish&gt; setmealDishes;<br><br>    <span class="hljs-keyword">private</span> String categoryName;<br>&#125;<br></code></pre></td></tr></table></figure>



<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212031504288.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221203150427076"></p>
<p>这个请求是，查询到套餐分类在下拉栏里显示，之前写过</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212031504771.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221203150436695"></p>
<p>这个请求是查询比如湘菜中都有哪些菜品的请求，也是放在显示栏里，就是点击添加菜品的时候出现的那个</p>
<p>在导航栏中可以任意切换菜品的种类，比如湘菜，川菜，饮品等等，每个发起的请求都不一样</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212031505113.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221203150507579"></p>
<p>DishController</p>
<p>显示每一个菜品大类下的具体的菜品的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">这个功能是在套餐管理添加的页面中，查询每一种菜品类型所对应的全部具体的菜品</span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">//用dish来接受catogoryId</span><br><span class="hljs-meta">@GetMapping(&quot;/list&quot;)</span><br><span class="hljs-keyword">public</span> R&lt;List&lt;Dish&gt;&gt; <span class="hljs-title function_">list</span><span class="hljs-params">(Dish dish)</span>&#123;<br><br>    LambdaQueryWrapper&lt;Dish&gt; lambdaQueryWrapper=<span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>    lambdaQueryWrapper.eq(dish.getCategoryId()!=<span class="hljs-literal">null</span>,Dish::getCategoryId,dish.getCategoryId());<br><br>    <span class="hljs-comment">//添加排序条件</span><br>    lambdaQueryWrapper.orderByAsc(Dish::getSort).orderByDesc(Dish::getUpdateTime);<br>    List&lt;Dish&gt; list = dishService.list(lambdaQueryWrapper);<br>    <span class="hljs-comment">// sql语句：  SELECT id,name,category_id,price,code,image,description,status,sort,create_time,update_time,create_user,update_user,is_deleted FROM dish WHERE (category_id = ? AND status = ?) ORDER BY sort ASC,update_time DESC </span><br><br>    <span class="hljs-keyword">return</span> R.success(list);<br>&#125;<br></code></pre></td></tr></table></figure>



<p>2.点击保存之后发起的请求</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212031552818.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221203155211731"></p>
<p>参数</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212031552079.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload></p>
<p>保存到数据库这种有逻辑以及实现的代码最好是封装在Service中，然后Controller中直接调用</p>
<p>SetmealController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.controller;<br><br><span class="hljs-keyword">import</span> com.itheima.reggie.common.R;<br><span class="hljs-keyword">import</span> com.itheima.reggie.dto.SetmealDto;<br><span class="hljs-keyword">import</span> com.itheima.reggie.entity.SetmealDish;<br><span class="hljs-keyword">import</span> com.itheima.reggie.service.CategoryService;<br><span class="hljs-keyword">import</span> com.itheima.reggie.service.SetmealDishService;<br><span class="hljs-keyword">import</span> com.itheima.reggie.service.SetmealService;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.transaction.annotation.Transactional;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PostMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestBody;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">套餐管理</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@RequestMapping(&quot;/setmeal&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SetmealController</span> &#123;<br><br><span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> SetmealService setmealService;<br><br><span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> SetmealDishService setmealDishService;<br><br><br><span class="hljs-meta">@PostMapping</span><br><span class="hljs-meta">@Transactional</span><br><span class="hljs-comment">//多个事务要进行事务管理</span><br><span class="hljs-keyword">public</span> R&lt;String&gt; <span class="hljs-title function_">insert</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> SetmealDto setmealDto)</span>&#123;<br><br>  setmealService.saveWithDish(setmealDto);<br>    <span class="hljs-keyword">return</span> R.success(<span class="hljs-string">&quot;保存成功&quot;</span>);<br>&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>



<p>SetmealService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.service;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;<br><span class="hljs-keyword">import</span> com.itheima.reggie.dto.DishDto;<br><span class="hljs-keyword">import</span> com.itheima.reggie.dto.SetmealDto;<br><span class="hljs-keyword">import</span> com.itheima.reggie.entity.Setmeal;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SetmealService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">IService</span>&lt;Setmeal&gt;  &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span>  <span class="hljs-title function_">saveWithDish</span><span class="hljs-params">(SetmealDto setmealDto)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>



<p>SetmealServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.service.impl;<br><br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;<br><span class="hljs-keyword">import</span> com.itheima.reggie.dto.DishDto;<br><span class="hljs-keyword">import</span> com.itheima.reggie.dto.SetmealDto;<br><span class="hljs-keyword">import</span> com.itheima.reggie.entity.Setmeal;<br><span class="hljs-keyword">import</span> com.itheima.reggie.entity.SetmealDish;<br><span class="hljs-keyword">import</span> com.itheima.reggie.mapper.SetmealMapper;<br><span class="hljs-keyword">import</span> com.itheima.reggie.service.SetmealDishService;<br><span class="hljs-keyword">import</span> com.itheima.reggie.service.SetmealService;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SetmealServiceImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ServiceImpl</span>&lt;SetmealMapper, Setmeal&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SetmealService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> SetmealService setmealService;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> SetmealDishService setmealDishService;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveWithDish</span><span class="hljs-params">(SetmealDto setmealDto)</span> &#123;<br>        <span class="hljs-comment">//先保存到setmeal表</span><br>        setmealService.save(setmealDto);<br>        <span class="hljs-comment">//保存之后的setmealDto对象就会自动有id，就是具体套餐的id</span><br>        <span class="hljs-type">Long</span> <span class="hljs-variable">setmealid</span> <span class="hljs-operator">=</span> setmealDto.getId();<br>        List&lt;SetmealDish&gt; setmealDishes = setmealDto.getSetmealDishes();<br>        <span class="hljs-comment">//这里的SetmealDish没有接收到SetmealId</span><br>        <span class="hljs-keyword">for</span> (SetmealDish setmealDish : setmealDishes) &#123;<br>            setmealDish.setSetmealId(setmealid);<br>        &#125;<br><br>        <span class="hljs-comment">//对setmealdish表进行保存</span><br>        setmealDishService.saveBatch(setmealDishes);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="套餐信息分页查询"><a href="#套餐信息分页查询" class="headerlink" title="套餐信息分页查询"></a>套餐信息分页查询</h2><p>页面发起的分页请求</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212031628421.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221203162854602"></p>
<p>这里往前端返回的时候，返回的Page对象的泛型应该返回setmealdto，因为setmeal没有categoryname，但是页面上需要显示categoryname，所以用继承了setmeal的setmealdto，因为他不仅有setmeal有的属性还有setmeal没有的categoryName</p>
<p>SetmealController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//分页查询功能的实现</span><br>    <span class="hljs-comment">//这个和之前那个菜品类型管理的分页查询功能类似</span><br><span class="hljs-meta">@GetMapping(&quot;/page&quot;)</span><br>    <span class="hljs-keyword">public</span> R&lt;Page&gt; <span class="hljs-title function_">page</span><span class="hljs-params">(<span class="hljs-type">int</span> page,<span class="hljs-type">int</span> pageSize,String name)</span>&#123;<br><br>    Page&lt;Setmeal&gt; setmealPage=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>&lt;Setmeal&gt; (page,pageSize);<br>    Page&lt;SetmealDto&gt; setmealDtoPage=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>&lt;&gt;();<br>    LambdaQueryWrapper&lt;Setmeal&gt; lambdaQueryWrapper=<span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br><br>    <span class="hljs-comment">//添加排序条件，根据更新时间进行like模糊查询</span><br>    lambdaQueryWrapper.orderByDesc(Setmeal::getCreateTime);<br>    <span class="hljs-comment">//添加查询条件，根据立刻进行模糊查询</span><br>    lambdaQueryWrapper.like(name!=<span class="hljs-literal">null</span>,Setmeal::getName,name);<br>    setmealService.page(setmealPage,lambdaQueryWrapper);<br><br>    <span class="hljs-comment">//把setmealPage中除了records属性都赋值给setmealDtoPage</span><br>    BeanUtils.copyProperties(setmealPage,setmealDtoPage,<span class="hljs-string">&quot;records&quot;</span>);<br><br>    <span class="hljs-comment">//下面这些是因为Setmeal对象中没有SermealDto所需要的categoryName，下面是在获取categoryName</span><br>    List&lt;Setmeal&gt; records = setmealPage.getRecords();<br>    List&lt;SetmealDto&gt; records2=<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    <span class="hljs-keyword">for</span> (Setmeal record : records) &#123;<br>        SetmealDto setmealDto=<span class="hljs-keyword">new</span> <span class="hljs-title class_">SetmealDto</span>();<br>        BeanUtils.copyProperties(record,setmealDto);<br><br>        <span class="hljs-comment">//这个是这个具体的套餐对应的套餐类型的id</span><br>        <span class="hljs-type">Long</span> <span class="hljs-variable">categoryId</span> <span class="hljs-operator">=</span> record.getCategoryId();<br>        <span class="hljs-type">Category</span> <span class="hljs-variable">category</span> <span class="hljs-operator">=</span> categoryService.getById(categoryId);<br>        <span class="hljs-keyword">if</span>(category!=<span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">categoryName</span> <span class="hljs-operator">=</span> category.getName();<br>            setmealDto.setCategoryName(categoryName);<br>        &#125;<br>        records2.add(setmealDto);<br>    &#125;<br> setmealDtoPage.setRecords(records2);<br><br>    <span class="hljs-keyword">return</span> R.success(setmealDtoPage);<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="删除和批量删除功能的实现"><a href="#删除和批量删除功能的实现" class="headerlink" title="删除和批量删除功能的实现"></a>删除和批量删除功能的实现</h2><p>点击删除的时候发起的请求</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212031700723.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221203170031804"></p>
<p>SetmealService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.service;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;<br><span class="hljs-keyword">import</span> com.itheima.reggie.dto.DishDto;<br><span class="hljs-keyword">import</span> com.itheima.reggie.dto.SetmealDto;<br><span class="hljs-keyword">import</span> com.itheima.reggie.entity.Setmeal;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SetmealService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">IService</span>&lt;Setmeal&gt;  &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span>  <span class="hljs-title function_">saveWithDish</span><span class="hljs-params">(SetmealDto setmealDto)</span>;<br><br>   <span class="hljs-comment">//删除功能</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteWithDish</span><span class="hljs-params">(Long ids[])</span>;<br>&#125;<br></code></pre></td></tr></table></figure>



<p>SetmealServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteWithDish</span><span class="hljs-params">(Long ids[])</span> &#123;<br><br>    <span class="hljs-comment">//查询套餐状态，确定是否真的要删除</span><br>    <span class="hljs-comment">//条件构造器中的条件是指套餐id在这些参数里面，套餐的状态还是可用状态的</span><br>    <span class="hljs-comment">//就是可用状态的套餐是不能够随便删除的</span><br>    LambdaQueryWrapper&lt;Setmeal&gt; lambdaQueryWrapper=<span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>    lambdaQueryWrapper.in(Setmeal::getId,ids);<br>    lambdaQueryWrapper.eq(Setmeal::getStatus,<span class="hljs-number">1</span>);<br><br>    <span class="hljs-comment">//返回符合这个条件构造器的记录的个数</span><br>    <span class="hljs-type">int</span> count=<span class="hljs-built_in">this</span>.count(lambdaQueryWrapper);<br>    <span class="hljs-keyword">if</span>(count&gt;<span class="hljs-number">0</span>)&#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomerException</span>(<span class="hljs-string">&quot;套餐正在售卖中，不能删除&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">//将long类型的数组转换为集合</span><br>    List&lt;Long&gt; list =  Arrays.asList(ids);<br><br>    <span class="hljs-comment">//从setmeal表中删除记录</span><br>    setmealService.removeByIds(list);<br><br>    <span class="hljs-comment">//从setmealdish表示删除数据</span><br>   <span class="hljs-comment">/* LambdaQueryWrapper&lt;SetmealDish&gt; lambdaQueryWrapper2=new LambdaQueryWrapper&lt;&gt;();</span><br><span class="hljs-comment">    lambdaQueryWrapper2.eq(SetmealDish::getDishId,ids);</span><br><span class="hljs-comment">    setmealDishService.remove(lambdaQueryWrapper2);*/</span><br><br>   LambdaQueryWrapper&lt;SetmealDish&gt; lambdaQueryWrapper1=<span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>   lambdaQueryWrapper1.in(SetmealDish::getDishId,ids);<br>   <span class="hljs-comment">//删除关系表中的数据----setmeal_dish</span><br>    <span class="hljs-comment">//删除所有dishid在ids中的以及setmeal_dish表中的记录</span><br>    setmealDishService.remove(lambdaQueryWrapper1);<br><br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>SetmealController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@DeleteMapping</span><br><span class="hljs-meta">@Transactional</span><br>    <span class="hljs-keyword">public</span> R&lt;String&gt; <span class="hljs-title function_">delete</span><span class="hljs-params">(Long ids[])</span>&#123;<br><br>    <span class="hljs-comment">//删除操作</span><br>   setmealService.deleteWithDish(ids);<br><br>    <span class="hljs-keyword">return</span> R.success(<span class="hljs-string">&quot;删除成功&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="停售和批量停售"><a href="#停售和批量停售" class="headerlink" title="停售和批量停售"></a>停售和批量停售</h2><p>点击批量停售之后发起的请求</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212031757972.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221203175730219"></p>
<p>SetmealController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@PostMapping(&quot;/status/&#123;status&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> R&lt;String&gt; <span class="hljs-title function_">editStatus</span><span class="hljs-params">(Long ids[],<span class="hljs-meta">@PathVariable</span> <span class="hljs-type">int</span> status)</span>&#123;<br><br>    <span class="hljs-keyword">for</span> (Long id : ids) &#123;<br>        LambdaUpdateWrapper&lt;Setmeal&gt; lambdaUpdateWrapper=<span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaUpdateWrapper</span>&lt;&gt;();<br>        lambdaUpdateWrapper.eq(Setmeal::getId,id);<br>        lambdaUpdateWrapper.set(Setmeal::getStatus,status);<br>        setmealService.update(lambdaUpdateWrapper);<br>    &#125;<br>    <span class="hljs-keyword">return</span> R.success(<span class="hljs-string">&quot;修改成功&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="修改套餐信息的功能"><a href="#修改套餐信息的功能" class="headerlink" title="修改套餐信息的功能"></a>修改套餐信息的功能</h2><h1 id="Day6"><a href="#Day6" class="headerlink" title="Day6"></a>Day6</h1><h2 id="阿里云短信服务"><a href="#阿里云短信服务" class="headerlink" title="阿里云短信服务"></a>阿里云短信服务</h2><p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212031853221.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload></p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212061825376.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221206182537452"></p>
<p>申请短信服务要添加模板，添加签名，申请了签名之后，它会自动赠送模板</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212061827526.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221206182659089"></p>
<p>模板内容，也就是短信中的内容</p>
<p>再设置AccessKey，也就是一对用户名密码，进行认证健全，也就是当你要用阿里云某个服务的时候，你需要这个AccessKey</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212061830959.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221206183047946"></p>
<p><strong>点击继续使用AccessKey创建的AccessKey用户名密码一旦泄露，用户可以用这个用户名密码访问我们我们阿里云服务的所有服务，但如果点击开始使用子用户AccessKey，用这个AccessKey能访问的服务就有限，就更安全</strong></p>
<p>点击AccessKey之后要创建一个新用户，名称随便，</p>
<p>第一个选项控制台访问是这个用户可以用账号密码访问阿里云控制台</p>
<p>第二个选项OpenAPI调用访问，启用AccessKeyID和AccessKey Secret，支持通过API和其他开发工具访问</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212061835836.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221206183533781"></p>
<p>生成AccessKey  ID和AccessKey Secret</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212061839837.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221206183908218"></p>
<p>AccessKey  Secret</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">oeb<span class="hljs-number">0</span>As<span class="hljs-number">1</span>PbClkyH<span class="hljs-number">4</span>SkUq<span class="hljs-symbol">NUIBp6</span>ZTPu<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure>

<p>对新增用户授权，点击用户，点击权限管理，点击新增授权，在下面指定权限范围</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212061841409.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221206184131071"></p>
<p>如果AccessKey和AccessID被泄露，可以禁用或者删除</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212061845791.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221206184540893"></p>
<h2 id="短信发送"><a href="#短信发送" class="headerlink" title="短信发送"></a>短信发送</h2><p>引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml">   <span class="hljs-comment">&lt;!--阿里云短信服务--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.aliyun<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>aliyun-java-sdk-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.5.16<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.aliyun<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>aliyun-java-sdk-dysmsapi<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.1.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure>



<p>阿里云短信服务帮助文档链接</p>
<p><a target="_blank" rel="noopener" href="https://help.aliyun.com/product/44282.html?spm=5176.12212976.0.0.333f1cbedG3hwe">短信服务 (aliyun.com)</a></p>
<p>其中有一个SDK参考，其中一个叫做JAVASDK参考，可以参考他用java代码发送短信</p>
<p>SDK就是辅助开发的一个工具包，辅助开发某一类软件的相关文档、范例和工具的集合都可以叫做SDK，其实Jdk就是java sdk的缩写</p>
<p>API概念：说得更加通俗易懂一些，别人写好的代码，或者编译好的程序，提供给你使用，就叫做API。你使用了别人代码（或者程序）中的某个函数、类、对象，就叫做使用了某个API。</p>
<p>这个是java发送短信的API</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.common;<br><br><span class="hljs-keyword">import</span> com.aliyuncs.DefaultAcsClient;<br><span class="hljs-keyword">import</span> com.aliyuncs.IAcsClient;<br><span class="hljs-keyword">import</span> com.aliyuncs.dysmsapi.model.v20170525.SendSmsRequest;<br><span class="hljs-keyword">import</span> com.aliyuncs.dysmsapi.model.v20170525.SendSmsResponse;<br><span class="hljs-keyword">import</span> com.aliyuncs.exceptions.ClientException;<br><span class="hljs-keyword">import</span> com.aliyuncs.profile.DefaultProfile;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 短信发送工具类</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SMSUtils</span> &#123;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * 发送短信</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> signName 签名，签名就是之前申请的签名</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> templateCode 模板，申请的模板有一个属性就是模板Code</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> phoneNumbers 手机号,要发送短信的手机号</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> param 参数，是用来把模板内容中的$&#123;code&#125;换为这个param</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendMessage</span><span class="hljs-params">(String signName, String templateCode,String phoneNumbers,String param)</span>&#123;<br>		<span class="hljs-comment">//后面两个参数分别是AccessID合AccessSecret</span><br>        <span class="hljs-type">DefaultProfile</span> <span class="hljs-variable">profile</span> <span class="hljs-operator">=</span> DefaultProfile.getProfile(<span class="hljs-string">&quot;cn-hangzhou&quot;</span>, <span class="hljs-string">&quot;LTAI5tC1JHJ7AWcoZqCjGbws&quot;</span>, <span class="hljs-string">&quot;oeb0As1PbClkyH4SkUqNUIBp6ZTPu0&quot;</span>);<br>		<span class="hljs-type">IAcsClient</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultAcsClient</span>(profile);<br><br>		<span class="hljs-type">SendSmsRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SendSmsRequest</span>();<br>		request.setSysRegionId(<span class="hljs-string">&quot;cn-hangzhou&quot;</span>);<br>		request.setPhoneNumbers(phoneNumbers);<br>		request.setSignName(signName);<br>		request.setTemplateCode(templateCode);<br>		request.setTemplateParam(<span class="hljs-string">&quot;&#123;\&quot;code\&quot;:\&quot;&quot;</span>+param+<span class="hljs-string">&quot;\&quot;&#125;&quot;</span>);<br>		<span class="hljs-keyword">try</span> &#123;<br>			<span class="hljs-type">SendSmsResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> client.getAcsResponse(request);<br>			System.out.println(<span class="hljs-string">&quot;短信发送成功&quot;</span>);<br>		&#125;<span class="hljs-keyword">catch</span> (ClientException e) &#123;<br>			e.printStackTrace();<br>		&#125;<br>	&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="验证码登陆的开发"><a href="#验证码登陆的开发" class="headerlink" title="验证码登陆的开发"></a>验证码登陆的开发</h2><p>为了方便用户登录，移动端通常提供手机验证码登陆的功能</p>
<p>把SMSUtils和ValidateCodeUtils导入到utils包下</p>
<p>在拦截器中放行&#x2F;user&#x2F;sendMsg和&#x2F;user&#x2F;login两个请求</p>
<p><strong>&#x2F;user&#x2F;sendMsg  是点击发送验证码的请求，带着参数是phone也就是输入的号码</strong></p>
<p><strong>&#x2F;user&#x2F;login  是点击发送验证码之后又跳转回登陆页面的请求</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//配置拦截器</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addInterceptors</span><span class="hljs-params">(InterceptorRegistry registry)</span> &#123;<br>    log.info(<span class="hljs-string">&quot;拦截器加载成功&quot;</span>);<br>    registry.addInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LoginInterceptor</span>())<br>            .addPathPatterns(<span class="hljs-string">&quot;/**&quot;</span>)  <span class="hljs-comment">//所有请求都被拦截包括静态资源</span><br>            .excludePathPatterns(<span class="hljs-string">&quot;/employee/login&quot;</span>,<span class="hljs-string">&quot;/backend/**&quot;</span>,<span class="hljs-string">&quot;/front/**&quot;</span>,<span class="hljs-string">&quot;/user/sendMsg&quot;</span>,<span class="hljs-string">&quot;/user/login&quot;</span>); <span class="hljs-comment">//放行的请求</span><br>&#125;<br></code></pre></td></tr></table></figure>



<p>访问&#x2F;front&#x2F;page&#x2F;login.html这个页面是html5开发的，自适应手机页面，但是用浏览器查看的话</p>
<p>点击f12，然后点击第一行第二个，这个时候就是手机的适应</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212062010058.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221206201023306"></p>
<p>拦截器的类进行了修改</p>
<p>就是只要是用户或者客户登录都可以放行</p>
<p>从session中获取的东西都是Object类型的，可以进行cast</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-comment">//验证用户是否登录</span><br><span class="hljs-type">String</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> (String)session.getAttribute(<span class="hljs-string">&quot;user&quot;</span>);<br><span class="hljs-keyword">if</span>(user!=<span class="hljs-literal">null</span>)&#123;<br>    <span class="hljs-comment">//放行</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br></code></pre></td></tr></table></figure>





<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.config;<br><br><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;<br><span class="hljs-keyword">import</span> com.fasterxml.jackson.databind.ser.Serializers;<br><span class="hljs-keyword">import</span> com.itheima.reggie.common.BaseContext;<br><span class="hljs-keyword">import</span> com.itheima.reggie.common.R;<br><span class="hljs-keyword">import</span> javafx.beans.binding.LongExpression;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;<br><br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpSession;<br><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        String requestURI=request.getRequestURI();<br>        log.info(<span class="hljs-string">&quot;请求已经拦截&#123;&#125;&quot;</span>,requestURI);<br>        <span class="hljs-comment">//获取session</span><br>        <span class="hljs-type">HttpSession</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> request.getSession();<br>        <span class="hljs-comment">//获取session中employee</span><br>        <span class="hljs-type">Long</span> <span class="hljs-variable">employee</span> <span class="hljs-operator">=</span> (Long) session.getAttribute(<span class="hljs-string">&quot;employee&quot;</span>);<br>        <span class="hljs-comment">//把id放到ThreadLocal中</span><br>        BaseContext.setCurrentId(employee);<br><br>        <span class="hljs-comment">//employee不为空就是登陆了放行</span><br>        <span class="hljs-keyword">if</span>(employee!=<span class="hljs-literal">null</span>)&#123;<br>            <span class="hljs-comment">//放行</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br><br>        <span class="hljs-comment">//验证用户是否登录</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> (String)session.getAttribute(<span class="hljs-string">&quot;user&quot;</span>);<br>        <span class="hljs-keyword">if</span>(user!=<span class="hljs-literal">null</span>)&#123;<br>            <span class="hljs-comment">//放行</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br><br><br>        <span class="hljs-comment">//如果未登录返回未登录结果，通过输出流方式向客户端页面响应数据</span><br>        response.getWriter().write(JSON.toJSONString(R.error(<span class="hljs-string">&quot;NOTLOGIN&quot;</span>)));<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br><br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>





<p>点击发送验证码之后调用的方法</p>
<p>UserContoller</p>
<p>请求是：&#x2F;user&#x2F;sendMsg</p>
<p><strong>正常这样就可以，但是现在这个请求不发起直接在前端就生成了验证码</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.controller;<br><br><span class="hljs-keyword">import</span> com.itheima.reggie.common.R;<br><span class="hljs-keyword">import</span> com.itheima.reggie.entity.User;<br><span class="hljs-keyword">import</span> com.itheima.reggie.service.UserService;<br><span class="hljs-keyword">import</span> com.itheima.reggie.utils.SMSUtils;<br><span class="hljs-keyword">import</span> com.itheima.reggie.utils.ValidateCodeUtils;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PostMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestBody;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><br><span class="hljs-keyword">import</span> javax.servlet.http.HttpSession;<br><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@RequestMapping(&quot;/user&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserService userService;<br><br>    <span class="hljs-meta">@PostMapping(&quot;/sendMsg&quot;)</span><br>    <span class="hljs-keyword">public</span> R&lt;String&gt; <span class="hljs-title function_">sendMsg</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> User user, HttpSession session)</span>&#123;<br>        <span class="hljs-comment">//获取手机号</span><br>        String phone=user.getPhone();<br>        <span class="hljs-keyword">if</span>(phone!=<span class="hljs-literal">null</span>)&#123;<br>            <span class="hljs-comment">//获取验证码</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">code</span> <span class="hljs-operator">=</span> ValidateCodeUtils.generateValidateCode4String(<span class="hljs-number">4</span>).toString();<br><br>            <span class="hljs-comment">//发送短信</span><br>            SMSUtils.sendMessage(<span class="hljs-string">&quot;rgwm&quot;</span>,<span class="hljs-string">&quot;SMS_262585563&quot;</span>,phone,code);<br><br>            <span class="hljs-comment">//将发送的验证码放到session域中，方便与用户输入的作比较</span><br>            session.setAttribute(<span class="hljs-string">&quot;code&quot;</span>,code);<br><br>            <span class="hljs-keyword">return</span> R.success(<span class="hljs-string">&quot;手机验证码短信发送成功&quot;</span>);<br>        &#125;<br><br><br>        <span class="hljs-keyword">return</span> R.error(<span class="hljs-string">&quot;手机验证码短信发送失败&quot;</span>);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>



<p>因为前端发起的登录请求中只有一个phone，而且很简陋这个版本，就是实现一个功能</p>
<p><strong>登录功能</strong></p>
<p>点击登陆之后发起的请求</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212070928361.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221207092829232"></p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212070929228.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221207092906791"></p>
<p>简化版，正常应该有验证码的比较</p>
<p>UserController点击登录发送的请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"> <span class="hljs-meta">@PostMapping(&quot;/login&quot;)</span><br><span class="hljs-keyword">public</span> R&lt;User&gt; <span class="hljs-title function_">login</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span>  User user, HttpServletRequest request)</span>&#123;<br><br>    <span class="hljs-type">HttpSession</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> request.getSession();<br>    LambdaQueryWrapper&lt;User&gt; lambdaQueryWrapper=<span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>    lambdaQueryWrapper.eq(User::getPhone,user.getPhone());<br>    <span class="hljs-type">User</span> <span class="hljs-variable">user1</span> <span class="hljs-operator">=</span> userService.getOne(lambdaQueryWrapper);<br>    <span class="hljs-comment">//如果是第一次登录的用户就保存用户信息到数据库</span><br>    <span class="hljs-keyword">if</span>(user1==<span class="hljs-literal">null</span>)&#123;<br>        User user2=<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br>        user2.setPhone(user.getPhone());<br>        userService.save(user2);<br>        session.setAttribute(<span class="hljs-string">&quot;user&quot;</span>,user2.getId());<br>    &#125;<br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">//这里是因为过滤器里面要求必须有user才能够放行</span><br>        session.setAttribute(<span class="hljs-string">&quot;user&quot;</span>, user1.getId());<br>    &#125;<br>    <span class="hljs-keyword">return</span> R.success(user1);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>对拦截器进行改造，让用户登录或者工作人员登录都能放行</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-keyword">package</span> com.itheima.reggie.config;<br><br><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;<br><span class="hljs-keyword">import</span> com.fasterxml.jackson.databind.ser.Serializers;<br><span class="hljs-keyword">import</span> com.itheima.reggie.common.BaseContext;<br><span class="hljs-keyword">import</span> com.itheima.reggie.common.R;<br><span class="hljs-keyword">import</span> javafx.beans.binding.LongExpression;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.omg.CORBA.UserException;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;<br><br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpSession;<br><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        String requestURI=request.getRequestURI();<br>        log.info(<span class="hljs-string">&quot;请求已经拦截&#123;&#125;&quot;</span>,requestURI);<br>        <span class="hljs-comment">//获取session</span><br>        <span class="hljs-type">HttpSession</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> request.getSession();<br>        <span class="hljs-comment">//获取session中employee</span><br>        <span class="hljs-type">Long</span> <span class="hljs-variable">employee</span> <span class="hljs-operator">=</span> (Long) session.getAttribute(<span class="hljs-string">&quot;employee&quot;</span>);<br><br>        Long user=(Long) session.getAttribute(<span class="hljs-string">&quot;user&quot;</span>);<br>        <span class="hljs-keyword">if</span>(employee!=<span class="hljs-literal">null</span>)&#123;<br>            <span class="hljs-comment">//把id放到ThreadLocal</span><br>            BaseContext.setCurrentId(employee);<br>            <span class="hljs-comment">//放行</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span>(user!=<span class="hljs-literal">null</span>)&#123;<br>            BaseContext.setCurrentId(user);<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br><br>        <span class="hljs-comment">//如果未登录返回未登录结果，通过输出流方式向客户端页面响应数据</span><br>        response.getWriter().write(JSON.toJSONString(R.error(<span class="hljs-string">&quot;NOTLOGIN&quot;</span>)));<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br><br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>





<h1 id="Day7"><a href="#Day7" class="headerlink" title="Day7"></a>Day7</h1><p>购物车的开发</p>
<p>地址簿，指的是移动端消费者用户的地址信息，用户登录成功后可以维护自己的地址信息，同一个用户可以有多个地址信息，但只能有一个默认地址</p>
<h2 id="菜品的展示"><a href="#菜品的展示" class="headerlink" title="菜品的展示"></a>菜品的展示</h2><p>查询所有的分类，显示在首页上，点击每一个分栏还可以查询到每一个分类中具体的菜品，这些请求之前都写过就是dish和setmeal的list方法</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212071510951.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221207151006982"></p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212071525327.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221207152546472"></p>
<p>问题：点击选择规格的时候需要展示这个菜品的口味，所以要改造dish和setmeal的list</p>
<p>DishController</p>
<p>把返回的dish的list变为dishdto的list这样就可以带着口味返回了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java">这个功能是在套餐管理添加的页面中，查询每一种菜品类型所对应的全部具体的菜品<br> */<br><span class="hljs-comment">//用dish来接受catogoryId</span><br><span class="hljs-meta">@GetMapping(&quot;/list&quot;)</span><br><span class="hljs-keyword">public</span> R&lt;List&lt;DishDto&gt;&gt; <span class="hljs-title function_">list</span><span class="hljs-params">(Dish dish)</span>&#123;<br><br>    LambdaQueryWrapper&lt;Dish&gt; lambdaQueryWrapper=<span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>    lambdaQueryWrapper.eq(dish.getCategoryId()!=<span class="hljs-literal">null</span>,Dish::getCategoryId,dish.getCategoryId());<br>     <span class="hljs-comment">//查询status为1的菜品，就是正在起售的菜品</span><br>    lambdaQueryWrapper.eq(Dish::getStatus,<span class="hljs-number">1</span>);<br><br>    <span class="hljs-comment">//添加排序条件</span><br>    lambdaQueryWrapper.orderByAsc(Dish::getSort).orderByDesc(Dish::getUpdateTime);<br>    List&lt;Dish&gt; list = dishService.list(lambdaQueryWrapper);<br>    List&lt;DishDto&gt; listDto=<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    <span class="hljs-keyword">for</span> (Dish dish1 : list) &#123;<br>        <span class="hljs-type">Long</span> <span class="hljs-variable">categoryId</span> <span class="hljs-operator">=</span> dish1.getCategoryId();<br>        <span class="hljs-type">Category</span> <span class="hljs-variable">category</span> <span class="hljs-operator">=</span> categoryService.getById(categoryId);<br>        DishDto dishDto1=<span class="hljs-keyword">new</span> <span class="hljs-title class_">DishDto</span>();<br>        <span class="hljs-keyword">if</span>(category!=<span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">categoryName</span> <span class="hljs-operator">=</span> category.getName();<br>            dishDto1.setCategoryName(categoryName);<br>        &#125;<br><br>        <span class="hljs-comment">//通过具体菜品的id，查出它的口味</span><br>        Long dishId=dish1.getId();<br>        LambdaQueryWrapper&lt;DishFlavor&gt; lambdaQueryWrapper1=<span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>        lambdaQueryWrapper1.eq(DishFlavor::getDishId,dishId);<br>        List&lt;DishFlavor&gt; dishFlavorList=dishFlavorService.list(lambdaQueryWrapper1);<br>        dishDto1.setFlavors(dishFlavorList);<br><br><br>        BeanUtils.copyProperties(dish1,dishDto1);<br>        listDto.add(dishDto1);<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> R.success(listDto);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>SetmealController</p>
<p>这个是它的list请求</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212071554558.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221207155412465"></p>
<p>SetmealController</p>
<p>显示套餐信息，他就不用选择口味，所以简单一些</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/list&quot;)</span><br><span class="hljs-keyword">public</span> R&lt;List&lt;Setmeal&gt;&gt; <span class="hljs-title function_">list</span> <span class="hljs-params">(Setmeal setmeal)</span> &#123;<br><br>    LambdaQueryWrapper&lt;Setmeal&gt; lambdaQueryWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>    lambdaQueryWrapper.eq(Setmeal::getCategoryId, setmeal.getCategoryId());<br>    lambdaQueryWrapper.eq(Setmeal::getStatus, <span class="hljs-number">1</span>);<br>    lambdaQueryWrapper.orderByAsc(Setmeal::getUpdateTime);<br>    <br>    List&lt;Setmeal&gt; list = setmealService.list(lambdaQueryWrapper);<br>    <span class="hljs-keyword">return</span> R.success(list);<br><br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="购物车业务功能的开发"><a href="#购物车业务功能的开发" class="headerlink" title="购物车业务功能的开发"></a>购物车业务功能的开发</h2><p>点击要把菜品或者套餐加入到购物车中，其实发起的请求都是一样的，但是带着的参数确是不同的</p>
<p>菜品是dishId，套餐是setmealId</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212071626625.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221207162649729"></p>
<p><img src="D:\img\image-20221207162719881.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221207162719881"></p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212071700868.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221207170026917"></p>
<p>点击上面菜品的那个加号也是，发起上面图片那个请求</p>
<p>ShoppingCartController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@PostMapping(&quot;/add&quot;)</span><br><span class="hljs-keyword">public</span> R&lt;ShoppingCart&gt; <span class="hljs-title function_">addShoppingCart</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> ShoppingCart shoppingCart)</span>&#123;<br><br>    <span class="hljs-comment">//获取当前在操作购物车的用户id</span><br>    <span class="hljs-type">Long</span> <span class="hljs-variable">currentId</span> <span class="hljs-operator">=</span> BaseContext.getCurrentId();<br>    shoppingCart.setUserId(currentId);<br><br>    <span class="hljs-comment">//获取当前要加入的套餐或者菜品中的dishId</span><br>    <span class="hljs-type">Long</span> <span class="hljs-variable">dishId</span> <span class="hljs-operator">=</span> shoppingCart.getDishId();<br><br>    <span class="hljs-comment">//创建条件构造器</span><br>    LambdaQueryWrapper&lt;ShoppingCart&gt; lambdaQueryWrapper=<span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>    lambdaQueryWrapper.eq(ShoppingCart::getUserId,currentId);<br><br>    <span class="hljs-keyword">if</span>(dishId!=<span class="hljs-literal">null</span>)&#123;<br>    lambdaQueryWrapper.eq(ShoppingCart::getDishId,dishId);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        lambdaQueryWrapper.eq(ShoppingCart::getSetmealId,shoppingCart.getSetmealId());<br>    &#125;<br><br>    <span class="hljs-comment">//如果购物车中有过这个套餐或菜品则数量加一，如果没有过则默认number为一</span><br>    <span class="hljs-type">ShoppingCart</span> <span class="hljs-variable">cart</span> <span class="hljs-operator">=</span> shoppingCartService.getOne(lambdaQueryWrapper);<br>    <span class="hljs-keyword">if</span>(cart!=<span class="hljs-literal">null</span>)&#123;<br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">number</span> <span class="hljs-operator">=</span> cart.getNumber();<br>        cart.setNumber(number+<span class="hljs-number">1</span>);<br>        shoppingCartService.updateById(cart);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br><br>        <span class="hljs-comment">//shoppingCart是一开始传进来的参数</span><br>        shoppingCart.setNumber(<span class="hljs-number">1</span>);<br>        <span class="hljs-comment">//设置创建的时间</span><br>        shoppingCart.setCreateTime(LocalDateTime.now());<br>        cart=shoppingCart;<br>        shoppingCartService.save(cart);<br>    &#125;<br>    <span class="hljs-keyword">return</span> R.success(cart);<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>关于amount现在先不用管，现在就是一个菜品或套餐的价格，等提交订单的时候让amount乘以number就是总的价钱了</p>
<p><strong>显示购物车的功能开发</strong></p>
<p>一进入那个主页，页面除了会对类型发起请求，还会对购物车发起请求</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212071802094.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221207180220221"></p>
<p>ShoppingCartController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"> <span class="hljs-meta">@GetMapping(&quot;/list&quot;)</span><br><span class="hljs-keyword">public</span> R&lt;List&lt;ShoppingCart&gt;&gt; <span class="hljs-title function_">list</span><span class="hljs-params">()</span>&#123;<br><br>     <span class="hljs-comment">//获取当前用户的id</span><br>     <span class="hljs-type">Long</span> <span class="hljs-variable">currentId</span> <span class="hljs-operator">=</span> BaseContext.getCurrentId();<br>    <br>     LambdaQueryWrapper&lt;ShoppingCart&gt; lambdaQueryWrapper=<span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>     lambdaQueryWrapper.eq(ShoppingCart::getUserId,currentId);<br>     lambdaQueryWrapper.orderByAsc(ShoppingCart::getCreateTime);<br>    <br>     List&lt;ShoppingCart&gt; list = shoppingCartService.list(lambdaQueryWrapper);<br>     <span class="hljs-keyword">return</span> R.success(list);<br><br> &#125;<br></code></pre></td></tr></table></figure>

<p>添加完之后，他还会查询一次，查询到这个最新的数据</p>
<p><strong>清空购物车</strong></p>
<p>点击清空购物车发起请求</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212071808422.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221207180839662"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@DeleteMapping(&quot;/clean&quot;)</span><br><span class="hljs-keyword">public</span> R&lt;String&gt; <span class="hljs-title function_">clean</span><span class="hljs-params">()</span>&#123;<br>   <span class="hljs-comment">//获取当前用户的id</span><br>    <span class="hljs-type">Long</span> <span class="hljs-variable">currentId</span> <span class="hljs-operator">=</span> BaseContext.getCurrentId();<br><br>    LambdaQueryWrapper&lt;ShoppingCart&gt; lambdaQueryWrapper=<span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>    lambdaQueryWrapper.eq(ShoppingCart::getUserId,currentId);<br><br>    shoppingCartService.remove(lambdaQueryWrapper);<br>    <span class="hljs-keyword">return</span> R.success(<span class="hljs-string">&quot;删除成功&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>减少菜品数量</strong></p>
<p>点击那个减号-发起请求</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212071813186.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221207181323052"></p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212071815968.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221207181511905"></p>
<p>ShoppingCartController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@PostMapping(&quot;/sub&quot;)</span><br><span class="hljs-keyword">public</span> R&lt;String&gt; <span class="hljs-title function_">sub</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> ShoppingCart shoppingCart)</span>&#123;<br>    <span class="hljs-type">Long</span> <span class="hljs-variable">dishId</span> <span class="hljs-operator">=</span> shoppingCart.getDishId();<br>    Long userId= BaseContext.getCurrentId();<br>    LambdaQueryWrapper&lt;ShoppingCart&gt; lambdaQueryWrapper=<span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>    lambdaQueryWrapper.eq(ShoppingCart::getUserId,userId);<br>    <span class="hljs-keyword">if</span>(dishId!=<span class="hljs-literal">null</span>)&#123;<br>        lambdaQueryWrapper.eq(ShoppingCart::getDishId,dishId);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        lambdaQueryWrapper.eq(ShoppingCart::getSetmealId,shoppingCart.getSetmealId());<br>    &#125;<br>    <span class="hljs-type">ShoppingCart</span> <span class="hljs-variable">cart</span> <span class="hljs-operator">=</span> shoppingCartService.getOne(lambdaQueryWrapper);<br>    <span class="hljs-type">Integer</span> <span class="hljs-variable">number</span> <span class="hljs-operator">=</span> cart.getNumber();<br>    cart.setNumber(number-<span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">if</span>(cart.getNumber()==<span class="hljs-number">0</span>)&#123;<br>        shoppingCartService.remove(lambdaQueryWrapper);<br>        <span class="hljs-keyword">return</span> R.success(<span class="hljs-string">&quot;删除成功&quot;</span>);<br>    &#125;<br>    shoppingCartService.updateById(cart);<br>    <span class="hljs-keyword">return</span> R.success(<span class="hljs-string">&quot;删除成功&quot;</span>);<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>这个也是减少之后会，重新list一下</p>
<h2 id="用户下单"><a href="#用户下单" class="headerlink" title="用户下单"></a>用户下单</h2><p>orders表中存储的是下单的用户的号码地址，地址的id等等，订单的面上的信息，但是没有这个订单中具体有什么套餐或者菜品</p>
<p>order_detail中存储的就是订单中的菜品或者套餐的信息</p>
<p>点击去支付之后发起请求</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212080839433.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221208083924924"></p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212080839864.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221208083931106"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.service.impl;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.toolkit.IdWorker;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;<br><span class="hljs-keyword">import</span> com.itheima.reggie.common.BaseContext;<br><span class="hljs-keyword">import</span> com.itheima.reggie.common.CustomerException;<br><span class="hljs-keyword">import</span> com.itheima.reggie.common.R;<br><span class="hljs-keyword">import</span> com.itheima.reggie.entity.*;<br><span class="hljs-keyword">import</span> com.itheima.reggie.mapper.OrderDetailMapper;<br><span class="hljs-keyword">import</span> com.itheima.reggie.mapper.OrderMapper;<br><span class="hljs-keyword">import</span> com.itheima.reggie.service.*;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><br><span class="hljs-keyword">import</span> java.math.BigDecimal;<br><span class="hljs-keyword">import</span> java.time.LocalDate;<br><span class="hljs-keyword">import</span> java.time.LocalDateTime;<br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.concurrent.atomic.AtomicInteger;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderServiceImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ServiceImpl</span>&lt;OrderMapper, Orders&gt;  <span class="hljs-keyword">implements</span> <span class="hljs-title class_">OrderService</span> &#123;<br><br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> ShoppingCartService shoppingCartService;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserService userService;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> AddressBookService addressBookService;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> OrderDetailService orderDetailService;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">submit</span><span class="hljs-params">(Orders orders)</span> &#123;<br>        <span class="hljs-comment">//获取当前用户id</span><br>        <span class="hljs-type">Long</span> <span class="hljs-variable">currentId</span> <span class="hljs-operator">=</span> BaseContext.getCurrentId();<br><br>        <span class="hljs-comment">//查询用户的购物车信息</span><br>        LambdaQueryWrapper&lt;ShoppingCart&gt; lambdaQueryWrapper=<span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>        lambdaQueryWrapper.eq(ShoppingCart::getUserId,currentId);<br>        List&lt;ShoppingCart&gt; list = shoppingCartService.list(lambdaQueryWrapper);<br>        <span class="hljs-keyword">if</span>(list==<span class="hljs-literal">null</span>||list.size()==<span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomerException</span>(<span class="hljs-string">&quot;当前购物车中无商品&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-comment">//查询用户的个人信息</span><br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userService.getById(currentId);<br><br>        <span class="hljs-comment">//查询地址信息</span><br>        <span class="hljs-type">Long</span> <span class="hljs-variable">addressBookId</span> <span class="hljs-operator">=</span> orders.getAddressBookId();<br>        <span class="hljs-type">AddressBook</span> <span class="hljs-variable">addressBook</span> <span class="hljs-operator">=</span> addressBookService.getById(addressBookId);<br><br>        <span class="hljs-comment">//向订单表中插入数据，一条数据</span><br>         <span class="hljs-comment">//插入之前对orders先赋值</span><br><br>        <span class="hljs-type">long</span> orderId= IdWorker.getId();<br>        orders.setId(orderId);<br>        orders.setOrderTime(LocalDateTime.now());<br>        orders.setCheckoutTime(LocalDateTime.now());<br>        orders.setStatus(<span class="hljs-number">2</span>);<br><br><br>        <span class="hljs-comment">//计算购物车中商品的总价值</span><br>        <span class="hljs-comment">//这个可以算最后商品总价格，这个可以保证多线程安全，int和long都无法保证多线程高并发的时候安全</span><br>        AtomicInteger amount=<span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>);<br>        List&lt;OrderDetail&gt; orderDetails=<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br><br><br>       <span class="hljs-comment">//同时获得ordetail的封装</span><br>        <span class="hljs-keyword">for</span> (ShoppingCart shoppingCart : list) &#123;<br>            <span class="hljs-type">OrderDetail</span> <span class="hljs-variable">orderDetail</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderDetail</span>();<br>            orderDetail.setOrderId(orderId);<br>            orderDetail.setNumber(shoppingCart.getNumber());<br>            orderDetail.setDishFlavor(shoppingCart.getDishFlavor());<br>            orderDetail.setSetmealId(shoppingCart.getSetmealId());<br>            orderDetail.setName(shoppingCart.getName());<br>            orderDetail.setImage(shoppingCart.getImage());<br>            orderDetail.setAmount(shoppingCart.getAmount());<br>            orderDetails.add(orderDetail);<br>            <span class="hljs-comment">//intValue是将其转换为整数，amount属性是Decimal类型的X</span><br>            amount.addAndGet(shoppingCart.getAmount().multiply(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(shoppingCart.getNumber())).intValue());<br>        &#125;<br><br><br><br><br>        orders.setAmount(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(amount.get()));<br><br><br>        orders.setUserId(currentId);<br>        orders.setNumber(String.valueOf(orderId));<br>        orders.setUserName(user.getName());<br>        orders.setConsignee(addressBook.getConsignee());<br>        orders.setPhone(addressBook.getPhone());<br>        orders.setAddress(addressBook.getProvinceName()==<span class="hljs-literal">null</span>?<span class="hljs-string">&quot;&quot;</span>:addressBook.getProvinceName()<br>        +(addressBook.getCityName()==<span class="hljs-literal">null</span>?<span class="hljs-string">&quot;&quot;</span>:addressBook.getCityName())<br>        +(addressBook.getDistrictName()==<span class="hljs-literal">null</span>?<span class="hljs-string">&quot;&quot;</span>:addressBook.getDistrictName())<br>         +(addressBook.getDetail()==<span class="hljs-literal">null</span>?<span class="hljs-string">&quot;&quot;</span>:addressBook.getDetail())<br>        );<br><br>        <span class="hljs-built_in">this</span>.save(orders);<br>        <span class="hljs-comment">//向订单明细表插入数据，多条数据</span><br>         orderDetailService.saveBatch(orderDetails);<br><br>        <span class="hljs-comment">//清空购物车数据</span><br>        shoppingCartService.remove(lambdaQueryWrapper);<br><br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p>OrderService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.service;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;<br><span class="hljs-keyword">import</span> com.itheima.reggie.common.R;<br><span class="hljs-keyword">import</span> com.itheima.reggie.entity.Orders;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">IService</span>&lt;Orders&gt; &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">submit</span><span class="hljs-params">(Orders orders)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>



<p>OrderController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.controller;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;<br><span class="hljs-keyword">import</span> com.itheima.reggie.common.BaseContext;<br><span class="hljs-keyword">import</span> com.itheima.reggie.common.CustomerException;<br><span class="hljs-keyword">import</span> com.itheima.reggie.common.R;<br><span class="hljs-keyword">import</span> com.itheima.reggie.entity.AddressBook;<br><span class="hljs-keyword">import</span> com.itheima.reggie.entity.Orders;<br><span class="hljs-keyword">import</span> com.itheima.reggie.entity.ShoppingCart;<br><span class="hljs-keyword">import</span> com.itheima.reggie.entity.User;<br><span class="hljs-keyword">import</span> com.itheima.reggie.service.AddressBookService;<br><span class="hljs-keyword">import</span> com.itheima.reggie.service.OrderService;<br><span class="hljs-keyword">import</span> com.itheima.reggie.service.ShoppingCartService;<br><span class="hljs-keyword">import</span> com.itheima.reggie.service.UserService;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PostMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestBody;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@RequestMapping(&quot;/order&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> OrderService orderService;<br><br><br>    <span class="hljs-meta">@PostMapping(&quot;/submit&quot;)</span><br>    <span class="hljs-keyword">public</span> R&lt;String&gt; <span class="hljs-title function_">submit</span><span class="hljs-params">(  <span class="hljs-meta">@RequestBody</span> Orders orders)</span>&#123;<br><br>orderService.submit(orders);<br>        <span class="hljs-keyword">return</span> R.success(<span class="hljs-string">&quot;下单成功&quot;</span>);<br>    &#125;<br><br><br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>点单页面的展示</strong></p>
<p>就是显示所有的订单的开发，而且是能让订单的内容具体展示</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212080937627.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221208093706743"></p>
<p>前端页面要求返回的属性要有orderDetails,用来显示商品数量，并且orderDetails是一个OrderDetail类的集合</p>
<p>所以引入一个Dto   OrderDto</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.dto;<br><br><span class="hljs-keyword">import</span> com.itheima.reggie.entity.OrderDetail;<br><span class="hljs-keyword">import</span> com.itheima.reggie.entity.Orders;<br><span class="hljs-keyword">import</span> lombok.Data;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderDto</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Orders</span> &#123;<br><br><br>    <span class="hljs-keyword">private</span> List&lt;OrderDetail&gt; orderDetails;<br><br><br>&#125;<br></code></pre></td></tr></table></figure>





<p>OrderController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/userPage&quot;)</span><br><span class="hljs-keyword">public</span> R&lt;Page&lt;OrderDto&gt;&gt; <span class="hljs-title function_">page</span><span class="hljs-params">(<span class="hljs-type">int</span> page, <span class="hljs-type">int</span> pageSize)</span>&#123;<br>    Page&lt;Orders&gt; pageInfo=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>&lt;&gt;(page,pageSize);<br>    Page&lt;OrderDto&gt; orderDtoPage=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>&lt;&gt;();<br>    <span class="hljs-type">Long</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> BaseContext.getCurrentId();<br>    LambdaQueryWrapper&lt;Orders&gt; lambdaQueryWrapper=<span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>    lambdaQueryWrapper.eq(Orders::getUserId,id);<br>    orderService.page(pageInfo,lambdaQueryWrapper);<br><br>    BeanUtils.copyProperties(pageInfo,orderDtoPage,<span class="hljs-string">&quot;records&quot;</span>);<br><br>    List&lt;Orders&gt; orders = pageInfo.getRecords();<br><br>    List&lt;OrderDto&gt; orderDtos=<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    <span class="hljs-keyword">for</span> (Orders order : orders) &#123;<br>        OrderDto orderDto=<span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderDto</span>();<br><br>        <span class="hljs-comment">//获得订单编号</span><br>        <span class="hljs-type">Long</span> <span class="hljs-variable">orderId</span> <span class="hljs-operator">=</span> order.getId();<br><br>        LambdaQueryWrapper&lt;OrderDetail&gt; lambdaQueryWrapper1=<span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>        lambdaQueryWrapper1.eq(OrderDetail::getOrderId,orderId);<br>        <span class="hljs-comment">//查询多个都是使用list</span><br>        List&lt;OrderDetail&gt; orderDetails = orderDetailService.list(lambdaQueryWrapper1);<br>        orderDto.setOrderDetails(orderDetails);<br><br>        BeanUtils.copyProperties(order,orderDto);<br>        orderDtos.add(orderDto);<br>    &#125;<br>    orderDtoPage.setRecords(orderDtos);<br>    <span class="hljs-keyword">return</span> R.success(orderDtoPage);<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h2><p>管理地址修改功能的开发，点击修改地址信息发起请求</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212081013131.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221208101349025"></p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212081014622.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221208101452752"></p>
<p>AddressBookController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@PutMapping</span><br><span class="hljs-keyword">public</span> R&lt;AddressBook&gt; <span class="hljs-title function_">edit</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> AddressBook addressBook)</span>&#123;<br>    addressBookService.updateById(addressBook);<br>    <span class="hljs-keyword">return</span> R.success(addressBook);<br>&#125;<br></code></pre></td></tr></table></figure>

<h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h1><p>Redis是一个基于内存的key-value结构数据库</p>
<p>基于内存存储，读写性能高，但是mysql是存在磁盘中，所以计算机肯定是对内存的读写性能高</p>
<p>但内存有限，所以适合存储热点数据（热点商品，咨询，新闻）</p>
<h2 id="Redis入门"><a href="#Redis入门" class="headerlink" title="Redis入门"></a>Redis入门</h2><p>redis简介</p>
<p><strong>API介绍:</strong></p>
<p>API接口就是我们所说的应用程序编程接口(就是软件系统不同组成部分衔接的约定)，API其实是接受你的指令传输给电脑再将电脑的反馈传递给你的一个信使，家里需要用电，墙上的插口就相当于是电力公司给我们开放的API接口，我们不需要了解怎么发电不需要知道电怎么运输到家，只需要把电器插到插座上就可以</p>
<p><strong>关系型数据库(SQL)：</strong></p>
<p>关系型数据库指的是使用关系模型（二维表格模型）来组织数据的数据库。</p>
<p> 关系模型可以简单理解为二维表格模型，而一个关系型数据库就是由二维表及其之间的关系组成的一个数据组织。</p>
<p>为了规范性，把数据分配成为最小的逻辑表来存储避免重复，获得精简的空间利用。. 但是多个表之间的关系限制，多表管理就有点复杂。. 当然精简的存储可以节约宝贵的数据存储，但是现在随着社会的发展，磁盘上付出的代价是微不足知道的。</p>
<p>常见关系型数据库管理系统(<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/ORDBMS/870762">ORDBMS</a>)：</p>
<ol>
<li>Oracle </li>
<li>MySql </li>
<li>Microsoft <a target="_blank" rel="noopener" href="https://cloud.tencent.com/product/sqlserver?from=10680">SQL Server</a> </li>
<li>SQLite </li>
<li><a target="_blank" rel="noopener" href="https://cloud.tencent.com/product/postgresql?from=10680">PostgreSQL</a> </li>
<li>IBM DB2</li>
</ol>
<p>优势在支持通用的sql语言，</p>
<p>丰富的完整性大大减少了数据冗余和数据不一致的问题。并且全部由表结构组成，文件格式一致；</p>
<p>可以用SQL句子多个表之间做非常繁杂的查询；</p>
<p>数据存储在磁盘中，安全可靠。</p>
<p>不足：</p>
<p> 高并发读写能力差：网站类用户的并发性访问非常高，而一台数据库的最大连接数有限，且硬盘 I&#x2F;O 有限，不能满足很多人同时连接。</p>
<p>量数据情况下读写效率低：对大数据量的表进行读写操作时，需要等待较长的时间等待响应。</p>
<p>数据模型灵活度低：关系型数据库的数据模型定义严格，无法快速容纳新的数据类型（需要提前知道需要存储什么样类型的数据）。</p>
<p><strong>非关系型数据库（NOSQL）:</strong></p>
<p>非关系型是平面数据集合中，数据经常可以重复，单个数据库很少被分开，而是存储成为一个整体，这种整块读取数据效率更高。.</p>
<p>非关系型数据库又被称为 NoSQL（Not Only SQL )，意为不仅仅是 SQL。通常指数据以对象的形式存储在数据库中，而对象之间的关系通过每个对象自身的属性来决定，常用于存储非结构化的数据。 </p>
<p>常见的NOSQL数据库：</p>
<ol>
<li>键值数据库：Redis、Memcached、Riak </li>
<li>列族数据库：Bigtable、HBase、Cassandra </li>
<li>文档数据库：MongoDB、CouchDB、MarkLogic </li>
<li>图形数据库：Neo4j、InfoGrid</li>
</ol>
<p>优势：</p>
<p>非关系型数据库存储数据的格式可以是 key-value 形式、文档形式、图片形式等。使用灵活，应用场景广泛，而关系型数据库则只支持基础类型。</p>
<p> 速度快，效率高。 NoSQL 可以使用硬盘或者随机存储器作为载体，而关系型数据库只能使用硬盘</p>
<p>海量数据的维护和处理非常轻松，成本低。</p>
<p>不足：非关系型数据库暂时不提供 SQL 支持，学习和使用成本较高。</p>
<p>非关系数据库没有事务处理，无法保证数据的完整性和安全性。适合处理海量数据，但是不一定安全。</p>
<p>功能没有关系型数据库完善。</p>
<p>复杂表关联查询不容易实现。</p>
<p><strong>KV数据库</strong></p>
<p>随着NoSQL的流行，越来越多的NoSQL数据库被采用。而作为NoSQL中的KV数据库，也是经常出现在架构师的手中，被灵活的使用。</p>
<p><strong>redis应用场景</strong></p>
<p>1.缓存       2.任务队列         3.消息队列      4.分布式锁</p>
<p>linux下载redis，我就是下载在&#x2F;usr&#x2F;local下</p>
<p>第五行进入redis的src目录，其实是进入redis-4.0.0的目录中的src目录</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212081430814.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221208143038967"></p>
<p>启动redis是在src目录下输入redis-server就可以执行了</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212081434971.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221208143407962"></p>
<p>用src中的redis-cli文件可以链接redis数据库</p>
<p>现在链接redis数据库是霸屏的，可以让redis在后台进行服务，修改redis.conf在redis-4.0.0目录下</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212081440829.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221208144038076"></p>
<p>把no改为yes</p>
<p>然后用在redis-4.0.0目录下用    redis-server .&#x2F;redis.conf     命令就可以在后台执行redis</p>
<p>修改redis.conf文件，增加链接redis数据库的密码</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212081450320.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221208145015584"></p>
<p>先输入   redis-cli连接数据库（默认就是链接本地6379端口的），然后输入auth zhao1129进行认证，就可以使用数据库了</p>
<p>链接数据库的前提是数据库已经启动</p>
<p>redis-cli -h localhost -p 6379 -a zhao1129           这个是直接认证链接数据库，-p是指定端口，-h是指定主机</p>
<p>把redis.conf文件中bind 127.0.0.1改为 bind 0.0.0.0</p>
<p>再重新启动redis，就可以允许远程连接</p>
<h2 id="Redis数据类型"><a href="#Redis数据类型" class="headerlink" title="Redis数据类型"></a>Redis数据类型</h2><p>value的类型可以是很多，int也行，应该是都行</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212081532777.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221208153238167"></p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212081534779.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221208153442913"></p>
<p><strong>字符串类型（String）操作命令</strong></p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212081542363.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221208154255487"></p>
<p>如果用SET key value   如果key相同，后面会把前面覆盖</p>
<p>Hash类型的操作命令</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212081604447.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221208160431864"></p>
<p>list类型的操作命令</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212081750943.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221208175012219"></p>
<p>第二个命令的这个start是从零开始的，而且stop如果是-1就是获取从start开始的全部</p>
<p>这个先插入的是在尾部</p>
<p>集合set常用的操作命令</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212081803238.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221208180353305"></p>
<p>sdiff  key1  key2是返回key1中有但是key2中没有的数据</p>
<p>有序集合sorted set操作命令</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212081812032.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221208181231008"></p>
<p>排序是根据score从小到大来排</p>
<p>第二个明林中withscores是指返回value的同时返回他们各自的分数</p>
<p><strong>Redis常用命令</strong></p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212081820831.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221208182008947"></p>
<p>第二个Type key  返回的是key所存储的value的类型hash或者set之类的</p>
<p>ttl key 如果返回的值是-1则说明是永久存活的</p>
<h2 id="JAVA中操作redis"><a href="#JAVA中操作redis" class="headerlink" title="JAVA中操作redis"></a>JAVA中操作redis</h2><p>redis 的java客户端很多，官方推荐的有三种</p>
<p>jedis，lettuce，Redisson</p>
<p>Spring对Redis客户端进行了整合，提供了Spring Data Redis，在Spring  Boot中还提供了Starter，即spring-boot-starter-data-redis</p>
<p>新建项目jedis_demo</p>
<p>导入依赖</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependencies&gt;<br>    &lt;dependency&gt;<br>        &lt;groupId&gt;junit&lt;/groupId&gt;<br>        &lt;artifactId&gt;junit&lt;/artifactId&gt;<br>        &lt;version&gt;<span class="hljs-number">4.12</span>&lt;/version&gt;<br>    &lt;/dependency&gt;<br>    &lt;dependency&gt;<br>        &lt;groupId&gt;redis.clients&lt;/groupId&gt;<br>        &lt;artifactId&gt;jedis&lt;/artifactId&gt;<br>        &lt;version&gt;<span class="hljs-number">2.8</span><span class="hljs-number">.0</span>&lt;/version&gt;<br>    &lt;/dependency&gt;<br>&lt;/dependencies&gt;<br></code></pre></td></tr></table></figure>

<p>Redis初体验</p>
<p><strong>Jedis操作Redis</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.junit.Test;<br><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;<br><br><span class="hljs-keyword">import</span> java.util.Set;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JedisTest</span> &#123;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testRedis</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-comment">//1.获取链接</span><br>        <span class="hljs-comment">//这里面第一个参数是你要用的redis在哪个主机上</span><br>        <span class="hljs-comment">//第二个参数是port</span><br>        Jedis jedis=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">&quot;localhost&quot;</span>,<span class="hljs-number">6379</span>);<br><br>        <span class="hljs-comment">//2.执行具体操作</span><br>        <span class="hljs-comment">//set就是存入，第一个参数是key，第二个参数是value</span><br>        jedis.set(<span class="hljs-string">&quot;username&quot;</span>,<span class="hljs-string">&quot;xiaoming&quot;</span>);<br><br>        <span class="hljs-comment">//get是获取参数为key对应的value</span><br>         String value=jedis.get(<span class="hljs-string">&quot;username&quot;</span>);<br>        System.out.println(value);<br><br>        <span class="hljs-comment">//删除username的key</span><br>        jedis.del(<span class="hljs-string">&quot;username&quot;</span>);<br><br>        <span class="hljs-comment">//存了一个hash结构的数据，addr是field，bj是value ，key是myhash</span><br>        jedis.hset(<span class="hljs-string">&quot;myhash&quot;</span>,<span class="hljs-string">&quot;addr&quot;</span>,<span class="hljs-string">&quot;bj&quot;</span>);<br><br>        <span class="hljs-comment">//获取hash中得值</span><br>        <span class="hljs-comment">//获得myhash这个hash中addr这个filed对应的value</span><br>        String hValue=jedis.hget(<span class="hljs-string">&quot;myhash&quot;</span>,<span class="hljs-string">&quot;addr&quot;</span>);<br><br>        System.out.println(hValue);<br>        <br>        <span class="hljs-comment">//获取所有的key</span><br>        Set&lt;String&gt; keys = jedis.keys(<span class="hljs-string">&quot;*&quot;</span>);<br>        keys.forEach(System.out::println);<br><br>        <br>        <span class="hljs-comment">//3.关闭连接</span><br>        jedis.close();<br><br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure>



<p><strong>Spring Data Redis</strong></p>
<p>在springboot项目中，可以使用Spring Data Redis来简化Redis操作，maven坐标</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;!--导入springdataredis来操作redis--&gt;<br>&lt;dependency&gt;<br>    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;<br>&lt;/dependency&gt;<br></code></pre></td></tr></table></figure>

<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212081910582.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221208191008618"></p>
<p>在yml文件中设置redis</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment">#tomacat端口号</span><br><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8081</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-comment">#应用的名称，不必须</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">reggie_take_out</span><br>    <span class="hljs-comment">#配置数据源为druid</span><br><br>  <span class="hljs-attr">redis:</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span><br>    <span class="hljs-comment">#password</span><br>    <span class="hljs-attr">database:</span> <span class="hljs-number">0</span> <span class="hljs-comment">#服务跑起来之后redis默认提供16个数据库，这里写0是指默认操作0号数据库</span><br>    <span class="hljs-attr">jedis:</span><br>      <span class="hljs-comment">#Redis连接池配置</span><br>      <span class="hljs-attr">pool:</span><br>        <span class="hljs-attr">max-active:</span> <span class="hljs-number">8</span> <span class="hljs-comment">#最大连接数</span><br>        <span class="hljs-attr">max-wait:</span> <span class="hljs-string">1ms</span> <span class="hljs-comment">#连接池中最大阻塞等待时间</span><br>        <span class="hljs-attr">max-idle:</span> <span class="hljs-number">4</span> <span class="hljs-comment"># 连接池中的最大空闲连接</span><br>        <span class="hljs-attr">min-idle:</span> <span class="hljs-number">0</span> <span class="hljs-comment">#连接池中的最小空闲连接</span><br><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">druid:</span><br>      <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br>      <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/reggle?serverTimezone=Asia/Shanghai&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=false&amp;allowPublicKeyRetrieval=true</span><br>      <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>      <span class="hljs-attr">password:</span> <span class="hljs-string">root</span><br>   <span class="hljs-comment">#设置文件上传时最大的单个文件大小，和最大的全部文件大小</span><br>  <span class="hljs-attr">servlet:</span><br>    <span class="hljs-attr">multipart:</span><br>      <span class="hljs-attr">max-file-size:</span> <span class="hljs-string">10MB</span><br>      <span class="hljs-attr">max-request-size:</span> <span class="hljs-string">100MB</span><br><br><br><span class="hljs-attr">mybatis-plus:</span><br>  <span class="hljs-attr">configuration:</span><br>    <span class="hljs-comment">#在映射实体或者属性时，将数据库中表名和字段名中的下划线去掉，按照驼峰命名法映射</span><br>    <span class="hljs-attr">map-underscore-to-camel-case:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">log-impl:</span> <span class="hljs-string">org.apache.ibatis.logging.stdout.StdOutImpl</span><br>  <span class="hljs-attr">global-config:</span><br>    <span class="hljs-attr">db-config:</span><br>      <span class="hljs-attr">id-type:</span> <span class="hljs-string">ASSIGN_ID</span><br><br><span class="hljs-attr">reggie:</span><br>  <span class="hljs-attr">basePath:</span> <span class="hljs-string">D:\img1\</span><br><br></code></pre></td></tr></table></figure>



<p>服务跑起来之后redis默认提供16个数据库，这里写0是指默认操作0号数据库</p>
<p>如果想要换到1号数据库就输入  select 1</p>
<p>如果想换到2号数据库就输入 select 2</p>
<p>redis.window.conf文件中可以修改默认的数据库数，就是  databases那一项</p>
<p>自己重新写这个redisTemplate，springboot自己装配的会对我们写的内容进行序列化，所以需要自己写一个bean来代替原本的</p>
<p>这样只能把key不进行序列化，但value还会序列化，但是没关系，我们在程序中获取value的时候，还会进行反序列化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.demo;<br><br><span class="hljs-keyword">import</span> org.springframework.cache.annotation.CachingConfigurerSupport;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.connection.RedisConnection;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.core.RedisTemplate;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">CachingConfigurerSupport</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> RedisTemplate&lt;Object,Object&gt; <span class="hljs-title function_">redisTemplate</span><span class="hljs-params">(RedisConnectionFactory connectionFactory)</span> &#123;<br>        RedisTemplate&lt;Object, Object&gt; redisTemplate = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedisTemplate</span>&lt;&gt;();<br><br>        <span class="hljs-comment">//默认的Key序列化器为：JdSerializationRedisSerializer</span><br>        <span class="hljs-comment">//这里就是对key的序列化器进行了转换</span><br>        redisTemplate.setKeySerializer(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRedisSerializer</span>());<br>        redisTemplate.setHashKeySerializer(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRedisSerializer</span>());<br><br>        redisTemplate.setConnectionFactory(connectionFactory);<br><br>        <span class="hljs-keyword">return</span> redisTemplate;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p>测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">package</span> com.example.demo;<br><br><span class="hljs-keyword">import</span> com.fasterxml.jackson.annotation.JacksonAnnotationsInside;<br><span class="hljs-keyword">import</span> org.junit.jupiter.api.Test;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.boot.test.context.SpringBootTest;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.core.RedisTemplate;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.core.ValueOperations;<br><br><span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;<br><br><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisbootdemoApplicationTests</span> &#123;<br><br><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> RedisTemplate redisTemplate;<br><br><br><span class="hljs-comment">//这个方法是来测试value为String类型的操作</span><br>    <span class="hljs-meta">@Test</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">//获取valueOperations对象</span><br>        <span class="hljs-type">ValueOperations</span> <span class="hljs-variable">valueOperations</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue();<br>        <span class="hljs-comment">//前面是key后面是value</span><br>        valueOperations.set(<span class="hljs-string">&quot;name&quot;</span>,<span class="hljs-string">&quot;xiaoming&quot;</span>);<br><br>        <span class="hljs-comment">//这样获取的全都是Object类型，所以要进行强制转换</span><br>        String name= (String) valueOperations.get(<span class="hljs-string">&quot;name&quot;</span>);<br><br>        <span class="hljs-comment">//第一个参数是key，第二个参数是value，第三个参数是过期时间，第四个参数是第三个参数的单位</span><br>        <span class="hljs-comment">//value的类型也可以用Integer</span><br>        valueOperations.set(<span class="hljs-string">&quot;age&quot;</span>,<span class="hljs-number">1000</span>,<span class="hljs-number">10l</span>, TimeUnit.SECONDS);<br><br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">age</span> <span class="hljs-operator">=</span> (Integer) valueOperations.get(<span class="hljs-string">&quot;age&quot;</span>);<br>        System.out.println(age);<br><br>        <span class="hljs-comment">//这个如果里面原本就有city是不会进行任何操作的，并且返回false</span><br>        <span class="hljs-type">Boolean</span> <span class="hljs-variable">aBoolean</span> <span class="hljs-operator">=</span> valueOperations.setIfAbsent(<span class="hljs-string">&quot;city&quot;</span>, <span class="hljs-string">&quot;nanjing1&quot;</span>);<br>        System.out.println(aBoolean);<br><br>        <span class="hljs-comment">//这个就是如果原本有city会被新加入的这个覆盖</span><br>        <span class="hljs-comment">//也是返回布尔，他只要操作陈成功就返回布尔，无所谓原本city的值和要改成的值是否相同</span><br>        <span class="hljs-type">Boolean</span> <span class="hljs-variable">aBoolean1</span> <span class="hljs-operator">=</span> valueOperations.setIfPresent(<span class="hljs-string">&quot;city&quot;</span>, <span class="hljs-string">&quot;nanjing1&quot;</span>);<br>        System.out.println(aBoolean1);<br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure>



<p>操作Hash类型的数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">操作Hash类型的数据</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testHash</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-comment">//获得操作hash类型数据的hashOperations对象</span><br>    <span class="hljs-type">HashOperations</span> <span class="hljs-variable">hashOperations</span> <span class="hljs-operator">=</span> redisTemplate.opsForHash();<br><br>    <span class="hljs-comment">//第一个参数是key，第二个参数是field，第三个参数是value</span><br>    hashOperations.put(<span class="hljs-string">&quot;002&quot;</span>,<span class="hljs-string">&quot;name&quot;</span>,<span class="hljs-string">&quot;xiaoming&quot;</span>);<br>    hashOperations.put(<span class="hljs-string">&quot;002&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>,<span class="hljs-string">&quot;20&quot;</span>);<br>    hashOperations.put(<span class="hljs-string">&quot;002&quot;</span>,<span class="hljs-string">&quot;address&quot;</span>,<span class="hljs-string">&quot;bj&quot;</span>);<br><br>    <span class="hljs-comment">//取出数据</span><br>    <span class="hljs-comment">//第一个参数是key，第二个参数是field</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> (String)hashOperations.get(<span class="hljs-string">&quot;002&quot;</span>, <span class="hljs-string">&quot;name&quot;</span>);<br>    System.out.println(name);<br><br>    <span class="hljs-comment">//获得hash结构中的所有字段,就是一个key中所有的field</span><br>    <span class="hljs-type">Set</span> <span class="hljs-variable">keys</span> <span class="hljs-operator">=</span> hashOperations.keys(<span class="hljs-string">&quot;002&quot;</span>);<br>    <span class="hljs-keyword">for</span> (Object key : keys) &#123;<br>        System.out.println(key);<br>    &#125;<br><br>    <span class="hljs-comment">//获取hash结构中所有的值</span><br>    <span class="hljs-type">List</span> <span class="hljs-variable">values</span> <span class="hljs-operator">=</span> hashOperations.values(<span class="hljs-string">&quot;002&quot;</span>);<br>    <span class="hljs-keyword">for</span> (Object value : values) &#123;<br>        System.out.println(value);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>



<p>操作List类型的数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java">        <span class="hljs-comment">/*</span><br><span class="hljs-comment">    操作List类型的数据</span><br><span class="hljs-comment">     */</span><br><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testList</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-comment">//得到操作list类型的数据</span><br>    <span class="hljs-type">ListOperations</span> <span class="hljs-variable">listOperations</span> <span class="hljs-operator">=</span> redisTemplate.opsForList();<br><br>    <span class="hljs-comment">//存储</span><br>    <span class="hljs-comment">//存储一个</span><br>    listOperations.leftPush(<span class="hljs-string">&quot;mylist&quot;</span>,<span class="hljs-string">&quot;a&quot;</span>);<br>    <span class="hljs-comment">//一次存储多个</span><br>    listOperations.leftPushAll(<span class="hljs-string">&quot;mylist&quot;</span>,<span class="hljs-string">&quot;b&quot;</span>,<span class="hljs-string">&quot;c&quot;</span>);<br><br>    <span class="hljs-comment">//取值</span><br>    <span class="hljs-comment">//第一个参数是key，第二个参数是开始的下标，最后是结束的下标</span><br>    <span class="hljs-comment">//这个是能让list中的类型为String的</span><br>    List&lt;String&gt; range = listOperations.range(<span class="hljs-string">&quot;mylist&quot;</span>,<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>);<br>    <span class="hljs-comment">//遍历也是从0坐标开始的，而取出是从最右开始的</span><br>    range.forEach(System.out::println);<br><br>    <span class="hljs-comment">//获取列表长度</span><br>    <span class="hljs-type">Long</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> listOperations.size(<span class="hljs-string">&quot;mylist&quot;</span>);<br>    <span class="hljs-type">int</span> <span class="hljs-variable">size1</span> <span class="hljs-operator">=</span> size.intValue();<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;size1;i++)&#123;<br>        <span class="hljs-comment">//出队列</span><br>        <span class="hljs-comment">//出的是最早添加的</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">mylist</span> <span class="hljs-operator">=</span> (String)listOperations.rightPop(<span class="hljs-string">&quot;mylist&quot;</span>);<br>        System.out.println(mylist);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p>操作set类型的数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">操作Set类型的数据</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSet</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-type">SetOperations</span> <span class="hljs-variable">setOperations</span> <span class="hljs-operator">=</span> redisTemplate.opsForSet();<br><br>    <span class="hljs-comment">//存储</span><br>    <span class="hljs-comment">//set是不能有重复元素的，无序序列</span><br>    setOperations.add(<span class="hljs-string">&quot;myset&quot;</span>,<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-string">&quot;b&quot;</span>,<span class="hljs-string">&quot;c&quot;</span>,<span class="hljs-string">&quot;a&quot;</span>);<br>    <span class="hljs-comment">//取值</span><br>    Set&lt;String&gt; myset = setOperations.members(<span class="hljs-string">&quot;myset&quot;</span>);<br>    <span class="hljs-keyword">for</span> (String s : myset) &#123;<br>        System.out.println(s);<br>    &#125;<br>    <span class="hljs-comment">//删除成员</span><br>    setOperations.remove(<span class="hljs-string">&quot;myset&quot;</span>,<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-string">&quot;b&quot;</span>);<br><br>    <span class="hljs-comment">//取值</span><br>    Set&lt;String&gt; myset1 = setOperations.members(<span class="hljs-string">&quot;myset&quot;</span>);<br>    <span class="hljs-keyword">for</span> (String s : myset1) &#123;<br>        System.out.println(s);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p>操作sortedSet类型的数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">操作sortedSet类型的数据</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testZset</span><span class="hljs-params">()</span>&#123;<br>    ZSetOperations zSetOperations=redisTemplate.opsForZSet();<br><br>    <span class="hljs-comment">//存值，它是通过每一个value绑定一个score，根据score大小来排序</span><br>    zSetOperations.add(<span class="hljs-string">&quot;myZset&quot;</span>,<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-number">10.0</span>);<br>    zSetOperations.add(<span class="hljs-string">&quot;myZset&quot;</span>,<span class="hljs-string">&quot;b&quot;</span>,<span class="hljs-number">11.0</span>);<br>    zSetOperations.add(<span class="hljs-string">&quot;myZset&quot;</span>,<span class="hljs-string">&quot;c&quot;</span>,<span class="hljs-number">12.0</span>);<br><br>    <span class="hljs-comment">//取值</span><br>    <span class="hljs-comment">//第一个参数是key，第二个参数是start，第三个参数是stop</span><br>    <span class="hljs-type">Set</span> <span class="hljs-variable">myZset</span> <span class="hljs-operator">=</span> zSetOperations.range(<span class="hljs-string">&quot;myZset&quot;</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">for</span> (Object o : myZset) &#123;<br>        System.out.println(o);<br>    &#125;<br>    <br>    <span class="hljs-comment">//修改分数</span><br>    <span class="hljs-comment">//第一个参数是key，第二个参数是这个key其中一个value的值，第三个参数是这个value对应的score要增大多少</span><br>    zSetOperations.incrementScore(<span class="hljs-string">&quot;myZset&quot;</span>,<span class="hljs-string">&quot;b&quot;</span>,<span class="hljs-number">20.0</span>);<br><br>    <span class="hljs-comment">//重新取值</span><br><br>    <span class="hljs-type">Set</span> <span class="hljs-variable">myZset1</span> <span class="hljs-operator">=</span> zSetOperations.range(<span class="hljs-string">&quot;myZset&quot;</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">for</span> (Object o : myZset1) &#123;<br>        System.out.println(o);<br>    &#125;<br><br>    <span class="hljs-comment">//删除成员</span><br>    zSetOperations.remove(<span class="hljs-string">&quot;myZset&quot;</span>,<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-string">&quot;b&quot;</span>);<br><br><br>    <span class="hljs-comment">//重新取直</span><br>    <span class="hljs-type">Set</span> <span class="hljs-variable">myZset2</span> <span class="hljs-operator">=</span> zSetOperations.range(<span class="hljs-string">&quot;myZset&quot;</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">for</span> (Object o : myZset2) &#123;<br>        System.out.println(o);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p>通用redis操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">redis中通用命令在java中的使用，就是针对不同数据类型都可以操作的</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testCommon</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-comment">//获取Redis中所有的key</span><br>    Set&lt;String&gt; keys = redisTemplate.keys(<span class="hljs-string">&quot;*&quot;</span>);<br>    <span class="hljs-keyword">for</span> (String key : keys) &#123;<br>        System.out.println(key);<br>    &#125;<br><br><br>    <span class="hljs-comment">//判断某个key是否存在,存在返回true，不存在返回false</span><br>    <span class="hljs-type">Boolean</span> <span class="hljs-variable">aBoolean</span> <span class="hljs-operator">=</span> redisTemplate.hasKey(<span class="hljs-string">&quot;name&quot;</span>);<br>    System.out.println(aBoolean);<br><br>    <span class="hljs-comment">//删除指定key,如果没有myZset，则无法删除返回false</span><br>    <span class="hljs-comment">//这个delete方法中可以是key的集合，但不能直接并列多个key</span><br>    <span class="hljs-type">Boolean</span> <span class="hljs-variable">myZset</span> <span class="hljs-operator">=</span> redisTemplate.delete(<span class="hljs-string">&quot;myZset&quot;</span>);<br>    System.out.println(myZset);<br><br>    <span class="hljs-comment">//获取指定key对应的value的数据类型</span><br>    <span class="hljs-type">DataType</span> <span class="hljs-variable">myset</span> <span class="hljs-operator">=</span> redisTemplate.type(<span class="hljs-string">&quot;myset&quot;</span>);<br>    System.out.println(myset);<br>&#125;<br></code></pre></td></tr></table></figure>

<h1 id="缓存优化"><a href="#缓存优化" class="headerlink" title="缓存优化"></a>缓存优化</h1><p>问题：用户数量多，系统访问量大，频繁访问数据库，系统性能下降，用户体验差</p>
<p>解决：就是使用缓存，如果用户发起的请求，在缓存里有，缓存是存储在内存中的，所以会比直接读取mysql数据库方便</p>
<p>git管理代码</p>
<p>把代码提交到远程库，创建一个新的分支，v1.0，并把v1.0分支也提交到远程库</p>
<p>接下来的操作在分支V1.0上操作，如果没有问题就可以合并到master主分支上</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212091112741.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221209111214813"></p>
<h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><p>引入redis依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--导入spring data redis的maven坐标--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>



<p>配置文件</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-comment">#应用的名称，不必须</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">reggie_take_out</span><br>    <span class="hljs-comment">#配置数据源为druid</span><br>   <span class="hljs-comment">#Redis配置</span><br>  <span class="hljs-attr">redis:</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span><br>    <span class="hljs-attr">password:</span><br>    <span class="hljs-attr">database:</span> <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure>



<p>自己配制的RedisTemplate实例放进ioc中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie.config;<br><br><span class="hljs-keyword">import</span> org.springframework.cache.annotation.CachingConfigurerSupport;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.core.RedisTemplate;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">CachingConfigurerSupport</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> RedisTemplate&lt;Object,Object&gt; <span class="hljs-title function_">redisTemplate</span><span class="hljs-params">(RedisConnectionFactory connectionFactory)</span> &#123;<br>        RedisTemplate&lt;Object, Object&gt; redisTemplate = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedisTemplate</span>&lt;&gt;();<br><br>        <span class="hljs-comment">//默认的Key序列化器为：JdSerializationRedisSerializer</span><br>        redisTemplate.setKeySerializer(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRedisSerializer</span>());<br>        redisTemplate.setHashKeySerializer(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRedisSerializer</span>());<br><br>        redisTemplate.setConnectionFactory(connectionFactory);<br><br>        <span class="hljs-keyword">return</span> redisTemplate;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="缓存菜品数据"><a href="#缓存菜品数据" class="headerlink" title="缓存菜品数据"></a>缓存菜品数据</h2><p>点击页面的菜品，每点击一次就会发起一个sql的请求，如果人多了高并发，效率就会很低</p>
<p>所以需要把菜品和套餐数据给缓存起来</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212091138102.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221209113843584"></p>
<p>改造update和save方法是mysql数据库中内容发生改变，也要及时清理掉缓存，如果不清理，则缓存和数据库中不同，这个就叫脏数据</p>
<p>给DishController的list方法加上缓存功能</p>
<p>缓存菜品数据是按照分类分别进行缓存，由key的构造中有dish_getCategoryId()就可以看出，key是根据分类动态生成的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs java"> <span class="hljs-comment">/*</span><br><span class="hljs-comment">   这个功能是在套餐管理添加的页面中，查询每一种菜品类型所对应的全部具体的菜品</span><br><span class="hljs-comment">*/</span><br>   <span class="hljs-comment">//用dish来接受catogoryId</span><br>   <span class="hljs-meta">@GetMapping(&quot;/list&quot;)</span><br>   <span class="hljs-keyword">public</span> R&lt;List&lt;DishDto&gt;&gt; <span class="hljs-title function_">list</span><span class="hljs-params">(Dish dish)</span>&#123;<br><br>       List&lt;DishDto&gt; listDto=<span class="hljs-literal">null</span>;<br><br>       <span class="hljs-comment">//每一个分类对应一个key</span><br>       <span class="hljs-comment">//动态的构造一个key</span><br>       String key=<span class="hljs-string">&quot;dish_&quot;</span>+dish.getCategoryId()+<span class="hljs-string">&quot;_&quot;</span>+dish.getStatus();<br><br>       <span class="hljs-comment">//查询redis</span><br>       listDto = (List&lt;DishDto&gt;) redisTemplate.opsForValue().get(key);<br><br><br>       <span class="hljs-comment">//如果存在则直接返回</span><br>       <span class="hljs-keyword">if</span>(listDto!=<span class="hljs-literal">null</span>)&#123;<br>           <span class="hljs-comment">//如果存在，直接返回，无需查询数据库</span><br>           <span class="hljs-keyword">return</span> R.success(listDto);<br>       &#125;<br><br><br><br><br>       LambdaQueryWrapper&lt;Dish&gt; lambdaQueryWrapper=<span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>       lambdaQueryWrapper.eq(dish.getCategoryId()!=<span class="hljs-literal">null</span>,Dish::getCategoryId,dish.getCategoryId());<br>       <span class="hljs-comment">//查询status为1的菜品，就是正在起售的菜品</span><br>       lambdaQueryWrapper.eq(Dish::getStatus,<span class="hljs-number">1</span>);<br><br>       <span class="hljs-comment">//添加排序条件</span><br>       lambdaQueryWrapper.orderByAsc(Dish::getSort).orderByDesc(Dish::getUpdateTime);<br>       List&lt;Dish&gt; list = dishService.list(lambdaQueryWrapper);<br>       listDto=<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>       <span class="hljs-keyword">for</span> (Dish dish1 : list) &#123;<br>           <span class="hljs-type">Long</span> <span class="hljs-variable">categoryId</span> <span class="hljs-operator">=</span> dish1.getCategoryId();<br>           <span class="hljs-type">Category</span> <span class="hljs-variable">category</span> <span class="hljs-operator">=</span> categoryService.getById(categoryId);<br>           DishDto dishDto1=<span class="hljs-keyword">new</span> <span class="hljs-title class_">DishDto</span>();<br>           <span class="hljs-keyword">if</span>(category!=<span class="hljs-literal">null</span>) &#123;<br>               <span class="hljs-type">String</span> <span class="hljs-variable">categoryName</span> <span class="hljs-operator">=</span> category.getName();<br>               dishDto1.setCategoryName(categoryName);<br>           &#125;<br><br>           <span class="hljs-comment">//通过具体菜品的id，查出它的口味</span><br>           Long dishId=dish1.getId();<br>           LambdaQueryWrapper&lt;DishFlavor&gt; lambdaQueryWrapper1=<span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>           lambdaQueryWrapper1.eq(DishFlavor::getDishId,dishId);<br>           List&lt;DishFlavor&gt; dishFlavorList=dishFlavorService.list(lambdaQueryWrapper1);<br>           dishDto1.setFlavors(dishFlavorList);<br><br><br>           BeanUtils.copyProperties(dish1,dishDto1);<br>           listDto.add(dishDto1);<br>       &#125;<br><br>       <span class="hljs-comment">//如果不存在则查询数据库，再把查询出来的加入缓存</span><br>       <span class="hljs-comment">//设置缓存的有效时间</span><br>       redisTemplate.opsForValue().set(key,listDto,<span class="hljs-number">60</span>, TimeUnit.MINUTES);<br><br>       <span class="hljs-keyword">return</span> R.success(listDto);<br>   &#125;<br></code></pre></td></tr></table></figure>



<p>save和edit时清理对应分类的缓存</p>
<p>下面两个都是DishController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@PostMapping</span><br><span class="hljs-keyword">public</span> R&lt;String&gt; <span class="hljs-title function_">save</span><span class="hljs-params">( <span class="hljs-meta">@RequestBody</span> DishDto dishDto)</span>&#123;<br>    <span class="hljs-comment">//这个save里除了是Dish类是Dish类的子类也是可以的</span><br>    <span class="hljs-comment">//dishService.save(dishDto);</span><br>    dishService.saveWithDishFlavor(dishDto);<br><br>    <span class="hljs-comment">//清理所有菜品的缓存数据</span><br>    <span class="hljs-comment">//Set keys=redisTemplate.keys(&quot;dish_*&quot;);</span><br>    <span class="hljs-comment">//redisTemplate.delete(keys);</span><br><br>    <span class="hljs-comment">//清理某个分类下面的菜品缓存数据</span><br>    <span class="hljs-comment">//菜品的status都是1所以这里写_1就可以</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span><span class="hljs-string">&quot;dish_&quot;</span>+dishDto.getCategoryId()+<span class="hljs-string">&quot;_1&quot;</span>;<br>    redisTemplate.delete(key);<br>    <br>     <span class="hljs-keyword">return</span> R.success(<span class="hljs-string">&quot;保存成功&quot;</span>);<br><br><br>&#125;<br></code></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">提交修改之后的数据</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@PutMapping</span><br><span class="hljs-keyword">public</span> R&lt;String&gt; <span class="hljs-title function_">editPlus</span><span class="hljs-params">( <span class="hljs-meta">@RequestBody</span> DishDto dishDto)</span>&#123;<br>    dishService.updateWithDishFlavor(dishDto);<br><br>    <span class="hljs-comment">//清理所有菜品的缓存数据</span><br>    <span class="hljs-comment">//Set keys=redisTemplate.keys(&quot;dish_*&quot;);</span><br>    <span class="hljs-comment">//redisTemplate.delete(keys);</span><br><br>    <span class="hljs-comment">//清理某个分类下面的菜品缓存数据</span><br>    <span class="hljs-comment">//菜品的status都是1所以这里写_1就可以</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span><span class="hljs-string">&quot;dish_&quot;</span>+dishDto.getCategoryId()+<span class="hljs-string">&quot;_1&quot;</span>;<br>    redisTemplate.delete(key);<br>    <span class="hljs-keyword">return</span> R.success(<span class="hljs-string">&quot;修改成功&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>



<p>修改完之后，提交到本地库并push到远程库，然后把master分支和v1.0分支合并，而且是在master分支区合并v1.0分支</p>
<h2 id="SpringCache"><a href="#SpringCache" class="headerlink" title="SpringCache"></a>SpringCache</h2><p>使用SpringCache也必须有web-starter那个依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>compile<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>





<p>也是一个缓存操作的框架,他可以简化我们的写缓存的代码</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212091417913.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221209141727111"></p>
<p>这里如果没有使用其他缓存技术，那么spring cache默认也有用map作为缓存技术</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212091419350.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221209141943100"></p>
<p>下面文字意思就是如果把Redis作为缓存技术，并同时要用Spring Cache技术，就把Redis缓存的依赖包导入即可</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--导入springdataredis来操作redis--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>



<p>但使用redis作为缓存技术，还要引入一个依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>



<p>然后在启动类上加上@EnableCaching注解启动缓存就可以</p>
<h3 id="不使用redis作为缓存技术"><a href="#不使用redis作为缓存技术" class="headerlink" title="不使用redis作为缓存技术"></a>不使用redis作为缓存技术</h3><p>不适用redis作为缓存技术，有了这个依赖就可以满足基本需要了</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--springboot--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>



<p>这里如果没有使用其他缓存技术，那么spring cache默认也有用map作为缓存技术</p>
<p>也就是使用CacheManager接口的实现类,当你自动装配的时候获得的就是ConcurrentMapCacheManager这个对象(像下面代码一样)</p>
<p>@Autowired</p>
<p>private CacheManager cacheManager</p>
<p>启动类上也要加上@EnableCaching注解</p>
<p>Controller类中要加上这个属性自动装配</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> CacheManager cacheManager;<br></code></pre></td></tr></table></figure>



<p><strong>CachePut</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * CachePut:将方法返回值放入缓存中</span><br><span class="hljs-comment"> * value:缓存的名称，每个缓存名称下面可以有多个key</span><br><span class="hljs-comment"> * key:缓存的key</span><br><span class="hljs-comment"> * 方法返回值就是key的value</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> user</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">//#result是指方法的返回值</span><br><span class="hljs-comment">//#root是指方法的内置对象，可以获得方法的一些信息</span><br><span class="hljs-meta">@CachePut(value = &quot;userCache&quot;,key=&quot;#result.id&quot;)</span><br><span class="hljs-meta">@PostMapping</span><br><span class="hljs-keyword">public</span> User <span class="hljs-title function_">save</span><span class="hljs-params">(User user)</span>&#123;<br>    userService.save(user);<br>    <span class="hljs-keyword">return</span> user;<br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>这个服务是基于内存的，如果重启服务之后，这个缓存的数据就没有了</strong></p>
<p><strong>CacheEvict</strong></p>
<p>删除或更新数据库数据的时候都需要删除缓存</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//CacheEvict：清理指定缓存，当数据库中删除内容的时候，缓存中也会删除指定内容</span><br><span class="hljs-comment">//value是指缓存的分类和CachePut的value属性是一个概念</span><br><span class="hljs-comment">//key是通过#参数名  来直接获取方法参数</span><br><span class="hljs-comment">//数据库中删除了id为参数的数据，缓存中也会删除id为参数的这个数据</span><br><span class="hljs-meta">@CacheEvict(value=&quot;userCache&quot;,key=&quot;#id&quot;)</span><br><span class="hljs-meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">delete</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span>&#123;<br>    userService.removeById(id);<br>&#125;<br><br><span class="hljs-comment">//@CacheEvict(value=&quot;userCache&quot;,key=&quot;#p0.id&quot;)</span><br><span class="hljs-comment">//@CacheEvict(value=&quot;userCache&quot;,key=&quot;#root.args[0].id&quot;)</span><br><span class="hljs-comment">//@CacheEvict(value=&quot;userCache&quot;,key=&quot;#result.id&quot;)</span><br><span class="hljs-comment">//这些注解都是一样的</span><br><span class="hljs-comment">//数据库中修改了id为参数的数据，缓存中会删除id为参数的这个数据</span><br><span class="hljs-meta">@CacheEvict(value=&quot;userCache&quot;,key=&quot;#user.id&quot;)</span><br><span class="hljs-meta">@PutMapping</span><br><span class="hljs-keyword">public</span> User <span class="hljs-title function_">update</span><span class="hljs-params">(User user)</span>&#123;<br>    userService.updateById(user);<br>    <span class="hljs-keyword">return</span> user;<br>&#125;<br></code></pre></td></tr></table></figure>



<p>Cacheable注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"> <span class="hljs-comment">//第一次请求这个查询的时候，会走这个方法，然后把返回值当作缓存存起来，下一次再请求，发现了有了注解中这个缓存就不会再走这个方法了，直接返回缓存中的内容</span><br> <span class="hljs-comment">//condition：满足条件时才缓存数据，#result!=null就是方法返回结果不为空</span><br> <span class="hljs-comment">//unless是如果unless中条件成立，则不缓存</span><br> <span class="hljs-comment">//#result不能在condition中用所以这里换成了#result，condition中只能用#root</span><br> <span class="hljs-meta">@Cacheable(value=&quot;userCache&quot;,key=&quot;#id&quot;,unless =&quot;#result==null&quot;)</span><br> <span class="hljs-meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span><br> <span class="hljs-keyword">public</span> User <span class="hljs-title function_">getById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span>&#123;<br>     <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userService.getById(id);<br>     <span class="hljs-keyword">return</span> user;<br> &#125;<br><br> <span class="hljs-comment">//第一次请求这个查询的时候，会走这个方法，然后把返回值当作缓存存起来，下一次再请求，发现了有了注解中这个缓存就不会再走这个方法了，直接返回缓存中的内容</span><br><span class="hljs-comment">//condition：满足条件时才缓存数据，#result!=null就是方法返回结果不为空</span><br> <span class="hljs-meta">@Cacheable(value=&quot;userCache&quot;,key=&quot;#user.id+&#x27;_&#x27;+#user.id&quot;,unless = &quot;#result==null&quot;)</span><br> <span class="hljs-meta">@GetMapping(&quot;/list&quot;)</span><br> <span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">list</span><span class="hljs-params">(User user)</span>&#123;<br>     LambdaQueryWrapper&lt;User&gt; queryWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>     queryWrapper.eq(user.getId() != <span class="hljs-literal">null</span>,User::getId,user.getId());<br>     queryWrapper.eq(user.getName() != <span class="hljs-literal">null</span>,User::getName,user.getName());<br>     List&lt;User&gt; list = userService.list(queryWrapper);<br>     <span class="hljs-keyword">return</span> list;<br> &#125;<br></code></pre></td></tr></table></figure>



<p>点击key condition  unless进入源码就能够看到他们能否用#result或者#root了</p>
<p>#result是指方法的返回值<br>#root是指方法的内置对象，可以获得方法的一些信息</p>
<h3 id="使用Redis作为缓存产品"><a href="#使用Redis作为缓存产品" class="headerlink" title="使用Redis作为缓存产品"></a>使用Redis作为缓存产品</h3><p>引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212091548110.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221209154824197"></p>
<p>图片中的application.yml配置的cache是和redis一个层级的</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-comment">#应用的名称，不必须</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">reggie_take_out</span><br>    <span class="hljs-comment">#配置数据源为druid</span><br>   <span class="hljs-comment">#Redis配置</span><br>  <span class="hljs-attr">redis:</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span><br>    <span class="hljs-attr">password:</span><br>    <span class="hljs-attr">database:</span> <span class="hljs-number">0</span><br>  <span class="hljs-attr">cache:</span><br>    <span class="hljs-attr">redis:</span><br>      <span class="hljs-attr">time-to-live:</span> <span class="hljs-number">180000</span> <span class="hljs-comment">#设置缓存过期时间</span><br></code></pre></td></tr></table></figure>



<p><strong>其余的注解的用法还是和上面的不使用redis作为缓存技术的用法一样</strong></p>
<h2 id="缓存套餐数据"><a href="#缓存套餐数据" class="headerlink" title="缓存套餐数据"></a>缓存套餐数据</h2><p>使用Spring Cache框架，基于redis缓存技术进行对套餐的缓存</p>
<p>先引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>



<p>配置缓存数据的过期时间</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-comment">#应用的名称，不必须</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">reggie_take_out</span><br>    <span class="hljs-comment">#配置数据源为druid</span><br>   <span class="hljs-comment">#Redis配置</span><br>  <span class="hljs-attr">redis:</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span><br>    <span class="hljs-attr">password:</span><br>    <span class="hljs-attr">database:</span> <span class="hljs-number">0</span><br>    <span class="hljs-comment">#设置缓存数据的过期时间</span><br>  <span class="hljs-attr">cache:</span><br>    <span class="hljs-attr">redis:</span><br>      <span class="hljs-attr">time-to-live:</span> <span class="hljs-number">180000</span> <span class="hljs-comment">#设置缓存过期时间</span><br></code></pre></td></tr></table></figure>

<p>application.yml整体</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment">#tomacat端口号</span><br><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-comment">#应用的名称，不必须</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">reggie_take_out</span><br>    <span class="hljs-comment">#配置数据源为druid</span><br>   <span class="hljs-comment">#Redis配置</span><br>  <span class="hljs-attr">redis:</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span><br>    <span class="hljs-attr">password:</span><br>    <span class="hljs-attr">database:</span> <span class="hljs-number">0</span><br>  <span class="hljs-attr">cache:</span><br>    <span class="hljs-attr">redis:</span><br>      <span class="hljs-attr">time-to-live:</span> <span class="hljs-number">180000</span> <span class="hljs-comment">#设置缓存过期时间</span><br><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">druid:</span><br>      <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br>      <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/reggle?serverTimezone=Asia/Shanghai&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=false&amp;allowPublicKeyRetrieval=true</span><br>      <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>      <span class="hljs-attr">password:</span> <span class="hljs-string">root</span><br>   <span class="hljs-comment">#设置文件上传时最大的单个文件大小，和最大的全部文件大小</span><br>  <span class="hljs-attr">servlet:</span><br>    <span class="hljs-attr">multipart:</span><br>      <span class="hljs-attr">max-file-size:</span> <span class="hljs-string">10MB</span><br>      <span class="hljs-attr">max-request-size:</span> <span class="hljs-string">100MB</span><br><br><br><span class="hljs-attr">mybatis-plus:</span><br>  <span class="hljs-attr">configuration:</span><br>    <span class="hljs-comment">#在映射实体或者属性时，将数据库中表名和字段名中的下划线去掉，按照驼峰命名法映射</span><br>    <span class="hljs-attr">map-underscore-to-camel-case:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">log-impl:</span> <span class="hljs-string">org.apache.ibatis.logging.stdout.StdOutImpl</span><br>  <span class="hljs-attr">global-config:</span><br>    <span class="hljs-attr">db-config:</span><br>      <span class="hljs-attr">id-type:</span> <span class="hljs-string">ASSIGN_ID</span><br><br><span class="hljs-attr">reggie:</span><br>  <span class="hljs-attr">basePath:</span> <span class="hljs-string">D:\img1\</span><br></code></pre></td></tr></table></figure>



<p>启动类上加入@EnableCache注解：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.reggie;<br><br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<br><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<br><span class="hljs-keyword">import</span> org.springframework.boot.web.servlet.ServletComponentScan;<br><span class="hljs-keyword">import</span> org.springframework.cache.annotation.EnableCaching;<br><span class="hljs-keyword">import</span> org.springframework.transaction.annotation.EnableTransactionManagement;<br><br><span class="hljs-comment">//加入日志功能</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-comment">//使原生组件生效</span><br><span class="hljs-meta">@ServletComponentScan</span><br><span class="hljs-meta">@EnableCaching</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReggieApplication</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(ReggieApplication.class,args);<br>        log.info(<span class="hljs-string">&quot;项目启动成功&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>SetmealController的list方法加入@Cacheable注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/list&quot;)</span><br><span class="hljs-comment">//#setmeal拿到方法中传递的参数,然后这个key也是用setmeal.categoryId来做的，根据套餐分类缓存</span><br><span class="hljs-meta">@Cacheable(value=&quot;setmealCache&quot;,key=&quot;#setmeal.categoryId+&#x27;_&#x27;+#setmeal.status&quot;)</span><br><span class="hljs-keyword">public</span> R&lt;List&lt;Setmeal&gt;&gt; <span class="hljs-title function_">list</span> <span class="hljs-params">(Setmeal setmeal)</span> &#123;<br></code></pre></td></tr></table></figure>

<p>list的方法返回结果是R对象，返回的结果要进行序列化，所以R类一定要实现序列化接口，实现可序列化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">R</span>&lt;T&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br></code></pre></td></tr></table></figure>

<p>这个时候就可以在redis数据库中看见缓存信息了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@DeleteMapping</span><br><span class="hljs-comment">//当一个套餐被删除之后，setmealCache中也就是所有套餐的缓存都会被删除</span><br><span class="hljs-meta">@CacheEvict(value=&quot;setmealCache&quot;,allEntries = true)</span><br><span class="hljs-meta">@Transactional</span><br><span class="hljs-keyword">public</span> R&lt;String&gt; <span class="hljs-title function_">delete</span><span class="hljs-params">(Long ids[])</span>&#123;<br></code></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">    <span class="hljs-meta">@PostMapping</span><br>    <span class="hljs-meta">@Transactional</span><br><span class="hljs-comment">//多个事务要进行事务管理</span><br>    <span class="hljs-comment">//如果新插入了一个套餐，那么之前的所有套餐缓存也就是所有setmealCache中的缓存都会被删除</span><br>    <span class="hljs-meta">@CacheEvict(value=&quot;setmealCache&quot;,allEntries = true)</span><br>    <span class="hljs-keyword">public</span> R&lt;String&gt; <span class="hljs-title function_">insert</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> SetmealDto setmealDto)</span>&#123;<br></code></pre></td></tr></table></figure>



<p>提交代码到本地库同时push到远程库，然后把master和v1.0合并起来</p>
<h1 id="读写分离优化"><a href="#读写分离优化" class="headerlink" title="读写分离优化"></a>读写分离优化</h1><p>问题：读和写所有压力都由一台数据库承担，压力大数据库服务器磁盘损坏则数据丢失，单点故障</p>
<p>用户浏览数据读的是从库，如果要修改数据则是写的主库，同时主库会把数据同步给从库，这个就叫做mysql的主从复制</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212091702400.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221209170225294"></p>
<h2 id="Mysql主从复制"><a href="#Mysql主从复制" class="headerlink" title="Mysql主从复制"></a>Mysql主从复制</h2><p>介绍：</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212091714030.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221209171430921"></p>
<p>从库可以有多个</p>
<p>在服务器上放一个数据库作为从库，在服务器上下载mysql</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212100935889.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221210093507612"></p>
<p>先删除 mariadb </p>
<p> rpm -e –nodeps mariadb-libs-5.5.65-1.el7.x86_64</p>
<p>将mysql安装包上传到linux并解压</p>
<p>把压缩包放到了根目录下的reggie目录下mysql目录下</p>
<p> tar -zxvf  mysql-5.7.25-1.el7.x86_64.rpm-bundle.tar.gz    用这个命令解压安装包</p>
<p>解压后进行安装，这个安装是有顺序的，按照下面顺序来，这些rpm软件安装包就是解压得到的</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212101006032.jpg" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="img"></p>
<p>rpm -ivh mysql-community-common-5.7.25-1.el7.x86_64.rpm</p>
<p>rpm -ivh mysql-community-libs-5.7.25-1.el7.x86_64.rpm</p>
<p>rpm -ivh mysql-community-devel-5.7.25-1.el7.x86_64.rpm</p>
<p>rpm -ivh mysql-community-libs-compat-5.7.25-1.el7.x86_64.rpm</p>
<p>rpm -ivh mysql-community-client-5.7.25-1.el7.x86_64.rpm</p>
<p>yum install net-tools</p>
<p>yum install libaio</p>
<p>rpm -ivh mysql-community-server-5.7.25-1.el7.x86_64.rpm</p>
<p>yum install libaio在yum install net-tools之后执行，然后再进行最后一个rpm安装</p>
<p><strong>完成mysql安装之后启动服务</strong></p>
<p>任意目录使用下面这两个命令</p>
<p>service mysqld start也能用来启动mysql服务</p>
<p>service mysqld stop 也能用来关闭mysql服务</p>
<p>上面这两种比图片中靠谱</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212101017136.jpg" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="img"></p>
<p>用cat &#x2F;var&#x2F;log&#x2F;mysqld.log | grep password  命令可以在mysqld.log文件中找到password</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212101026446.jpg" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="img"></p>
<p>我设置的linux的mysql密码为zhao1129</p>
<p>倒数第二行最后一个root换位zhao1129那是密码位置</p>
<p>最后两行命令是开启这个mysql的访问权限，所有的主机够可以访问这个mysql</p>
<p>设置密码后重新登陆 mysql -uroot -pzhao1129</p>
<p>用navicat连接阿里云上mysql也没问题</p>
<p><strong>实现主从复制，可以以后再接着看看，其实就是对主库和从库的配置文件修改，然后创建一个主库用户，通过这个用户能够让主库的操作给到从库</strong></p>
<p><strong>linux上创建数据库不指定字符编码，默认不是utf-8，windows上创建的数据库默认是utf-8，创建表的字符集不指定默认是和数据库一样，创建数据库字符集不指定默认和数据库服务器一样，所以以后创建数据库或者表都要确认字符集是不是utf-8</strong></p>
<h1 id="后端项目部署"><a href="#后端项目部署" class="headerlink" title="后端项目部署"></a>后端项目部署</h1><p>把打包好的jar包上传到linuxreggie</p>
<p>要在服务器上安装过jdk才能部署项目</p>
<p> java -jar reggie_take_out-1.0-SNAPSHOT.jar    有了java环境后，运行jar包</p>
<p><strong>centos虚拟机开放端口是可以通过防火墙命令的，但是阿里云服务器开放端口要到阿里云控制台的安全组来开放端口，安全组就是一个模拟防火墙</strong></p>
<p>同时要把安全组作用到这个实例</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212101925293.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221210192515843"></p>
<p>运行jar包之后，要停止jar包运行</p>
<p>netstat -nlp | grep  :8080          8080是jar占用的端口，这个命令能查询到jar的进程uid为一个值</p>
<p>然后kill -9 uid</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212101239163.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221210123937562"></p>
<p><strong>刚才这种运行方式，把屏幕关闭之后程序就结束了</strong></p>
<p><strong>让程序在后台运行，并且日志输出在一个文件里的方法</strong></p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212110906789.jpg" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="img"></p>
<p>nohup java -jar reggie_take_out-1.0-SNAPSHOT.jar &amp;&gt; reggieapp.log &amp;</p>
<p>后台运行程序，并把日志输出到reggieapp.log</p>
<h2 id="Shell脚本自动部署项目"><a href="#Shell脚本自动部署项目" class="headerlink" title="Shell脚本自动部署项目"></a>Shell脚本自动部署项目</h2><p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212111030890.jpg" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="img"></p>
<p>拉取代码是git，编译打包脚本是maven，启动是java -jar命令</p>
<p>1.linux中安装git</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212111038521.jpg" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="img"></p>
<p>git clone <a target="_blank" rel="noopener" href="https://github.com/zhaozihj/reggie_take_out.git">https://github.com/zhaozihj/reggie_take_out.git</a>      这个是克隆代码到本地 默认是克隆的master分支</p>
<p>这个步骤在执行reggieStart文件之前执行的，在reggieapp文件夹下执行这个命令</p>
<p>目录的结构是&#x2F;reggie&#x2F;reggieapp&#x2F;reggie_take_out</p>
<p>2.linux中安装maven</p>
<p>maven也装在&#x2F;usr&#x2F;local目录下</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212111053287.jpg" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="img"></p>
<p>source &#x2F;etc&#x2F;profile        重新加载配置文件</p>
<p>mvn -version           看看maven环境有没有装好</p>
<p>我设置的maven仓库为&#x2F;usr&#x2F;local&#x2F;repo</p>
<p>记得提供镜像资源</p>
<pre><code class="hljs"> &lt;mirror&gt;
    &lt;id&gt;nexus-aliyun&lt;/id&gt;
    &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;
    &lt;name&gt;Nexus aliyun&lt;/name&gt;
    &lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public&lt;/url&gt;
  &lt;/mirror&gt;
</code></pre>
<p>3.将资料中提供的shell脚本文件复制到linux  bootStart.sh</p>
<p>这个脚本被我放到&#x2F;reggie&#x2F;reggieapp目录下了</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212111108039.jpg" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="img"></p>
<p>4.为用户授权</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212111210535.jpg" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="img"></p>
<p>现在我用的是root用户（超级用户）是因为自己练习，以后进入一个公司一个服务器可能你就是普通用户权限，这个时候需要别人给你授权才能执行脚本</p>
<p>执行ll命令能查看文件状态</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212111214935.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221211121424766"></p>
<p>最前面一共是十位，后九位代表了文件所有者（root用户），同组的用户和其他用户对这个文件的操作权限</p>
<p>给一种用户的三位，第一位代表读权限，第二位代表写权限，第三位代表执行权限</p>
<p>像这个rw-  就是说文件所有者（root用户）既有读也有写但没有执行权限</p>
<p>​            r–       就是收同组用户有读权限没有写权限没有执行权限</p>
<p>​            r–     其他用户有读权限没有写权限没有执行权限</p>
<p><strong>用chmod为用户开放权限</strong></p>
<p>用数字来表示权限，然后3个数字就可以修改好三种用户对于这个文件的权限</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212111222478.jpg" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="img"></p>
<p> chmod 744 bootStart.sh   为root用户授予读写执行权限，其他用户只读</p>
<p>执行reggieStart.sh文件的命令            如果这个文件是在当前目录下直接   .&#x2F;reggieStart.sh就可以了但不能reggieStart.sh        如果在别的目录下，也可以用别的路径</p>
<h1 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h1><p>8080</p>
<p>nginx是一款轻量级的web服务器&#x2F;反向代理服务器及电子邮件代理服务器</p>
<p>在aliyun服务器上安装Nginx服务器</p>
<p>我给下载到&#x2F;usr&#x2F;local下面了</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212161541445.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221216154147120"></p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212161541597.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221216154137361"></p>
<h2 id="Nginx常用命令"><a href="#Nginx常用命令" class="headerlink" title="Nginx常用命令"></a>Nginx常用命令</h2><p>这些命令都是在sbin目录下执行的</p>
<p> location &#x2F;{<br>        root html&#x2F;dist;<br>       index index.html;</p>
<pre><code class="hljs">    &#125;

   location ^~ /api/ &#123;
      rewrite ^/api/(.*)$ /$1 break;
      proxy_pass http://39.105.5.187:8080;

      &#125;
</code></pre>
<p>查看版本号</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212161611022.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221216161155110"></p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212161612829.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221216161212974"></p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212161612279.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221216161224386"></p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212161612952.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221216161233951"></p>
<p>让这些命令不仅仅能够在sbin目录下执行</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212161625109.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221216162527276"></p>
<p>可以直接在任何目录下使用nginx -v命令，前面也不用加.&#x2F;了，其他命令也都是一样</p>
<h2 id="nginx配置文件的结构"><a href="#nginx配置文件的结构" class="headerlink" title="nginx配置文件的结构"></a>nginx配置文件的结构</h2><p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212161644948.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221216164436114"></p>
<h2 id="Nginx具体应用"><a href="#Nginx具体应用" class="headerlink" title="Nginx具体应用"></a>Nginx具体应用</h2><h3 id="部署静态资源"><a href="#部署静态资源" class="headerlink" title="部署静态资源"></a>部署静态资源</h3><p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212161655998.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221216165529376"></p>
<p>就是把静态资源放到html文件夹下，如果放进去一个hello.html则通过ip:port&#x2F;hello.html就可以访问到这个页面</p>
<h3 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h3><p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212161706998.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221216170605020"></p>
<p>1.反向代理，统一了请求的入口方便管理，要不就是访问那三个web服务器，不好管理</p>
<p>2.这三个web服务器一般是在公司内网中才能访问，反向代理服务器可以对外开放，同时反向代理服务器和三个web服务器组成了一个局域网，可以利用反向代理服务器来访问这三个web服务器</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212161705752.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221216170554806"></p>
<p>反向代理和正向代理的区别：正向代理是基于客户端的，用户知道有一个代理服务器去转发自己的请求，并且用户需要知道自己所访问的原始服务器，但是反向代理用户不需要知道原始服务器地址，只需要访问代理服务器就可以访问到原始服务器，所以用户并不知道这是代理服务器的地址。</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212161712280.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221216171201485"></p>
<h3 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h3><p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212161853442.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221216185300345"></p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212161853719.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221216185321758"></p>
<p>这样配置当你访问      localhost:8080的时候其实是轮流访问192.168.138.101:8080;和server 192.168.138.101:8081</p>
<p>默认的这种负载均衡的算法是轮询，但是也还是有别的负载均衡的算法的</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212161858242.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221216185821263"></p>
<p>加上了weight之后，一个为10另一个为5，当请求的次数足够多之后，请求两个服务器的次数可能会是2：1</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212161900576.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221216190010802"></p>
<h1 id="前后端分离开发"><a href="#前后端分离开发" class="headerlink" title="前后端分离开发"></a>前后端分离开发</h1><p>前后端在一起开发的困难</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212161907341.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221216190748150"></p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212161914527.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221216191448574"></p>
<p>前端和后端先一起制定好接口，就是要发起的请求的模式，以及参数等等</p>
<p>后端自测可以使用postman，swagger等等进行自测，前端就是返回mock数据，mock数据当然和后端规定好的要一样，只要能展示mock数据也就能展示后端传过来的数据</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212161917166.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221216191748043"></p>
<h2 id="apifox"><a href="#apifox" class="headerlink" title="apifox"></a>apifox</h2><p>接口文档中的内容就是定义一个请求和响应的规范，运行的时候具体设置请求参数的值，并且测试时响应必须和规范一样才不会报错</p>
<p>接口用例就是每个接口规范底下的一种特殊情况</p>
<h2 id="Swagger"><a href="#Swagger" class="headerlink" title="Swagger"></a>Swagger</h2><p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212162003542.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221216200303541"></p>
<p>1.引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.github.xiaoymin<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>knife4j-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.0.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<ol start="2">
<li></li>
</ol>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@EnableSwagger2</span><br><span class="hljs-variable">@EnableKnife4j</span><br><span class="hljs-variable">@Slf4j</span><br><span class="hljs-variable">@Configuration</span><br>public class WebMvcConfig implements WebMvcConfigurer &#123;<br></code></pre></td></tr></table></figure>

<p>在WebMvcConfig上面加上@EnableSwagger2，@EnableKnife4j两个注解</p>
<p>在WebMvcConfig中添加两个方法</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-keyword">@Bean</span><br>public Docket createRestApi()&#123;<br>    <span class="hljs-comment">//文档类型</span><br>    return new <span class="hljs-built_in">Docket</span>(DocumentationType.SWAGGER_2)<br>            <span class="hljs-selector-class">.apiInfo</span>(apiInfo())<br>            <span class="hljs-selector-class">.select</span>()<br>            <span class="hljs-comment">//对应controller一个包结构，生成接口会扫描这个包</span><br>            <span class="hljs-comment">//controller中每一个公共方法都会映射成一个接口</span><br>            <span class="hljs-selector-class">.apis</span>(RequestHandlerSelectors.basePackage(&quot;com.itheima.reggie.controller&quot;))<br>            <span class="hljs-selector-class">.paths</span>(PathSelectors.any())<br>            <span class="hljs-selector-class">.build</span>();<br>&#125;<br><span class="hljs-comment">//封装这个接口文档的标题版本描述之类的</span><br>private ApiInfo <span class="hljs-built_in">apiInfo</span>()&#123;<br>    return new <span class="hljs-built_in">ApiInfoBuilder</span>()<br>            <span class="hljs-selector-class">.title</span>(&quot;瑞吉外卖&quot;)<br>            <span class="hljs-selector-class">.version</span>(&quot;<span class="hljs-number">1.0</span>&quot;)<br>            <span class="hljs-selector-class">.description</span>(&quot;瑞吉外卖接口文档&quot;)<br>            <span class="hljs-selector-class">.build</span>();<br>&#125;<br><br><br></code></pre></td></tr></table></figure>

<p>3.设置静态资源映射</p>
<p>“&#x2F;doc.html”,”&#x2F;webjars&#x2F;**”,”&#x2F;swagger-resources”,”&#x2F;v2&#x2F;api-docs”  新增放行这四个请求，访问接口文档请求的是doc.html，这个是框架生成的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">    <span class="hljs-comment">//配置拦截器</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addInterceptors</span><span class="hljs-params">(InterceptorRegistry registry)</span> &#123;<br>        log.info(<span class="hljs-string">&quot;拦截器加载成功&quot;</span>);<br>        registry.addInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LoginInterceptor</span>())<br>                .addPathPatterns(<span class="hljs-string">&quot;/**&quot;</span>)  <span class="hljs-comment">//所有请求都被拦截包括静态资源</span><br>                .excludePathPatterns(<span class="hljs-string">&quot;/employee/login&quot;</span>,<span class="hljs-string">&quot;/backend/**&quot;</span>,<span class="hljs-string">&quot;/front/**&quot;</span>,<span class="hljs-string">&quot;/user/sendMsg&quot;</span>,<span class="hljs-string">&quot;/user/login&quot;</span>,<span class="hljs-string">&quot;/doc.html&quot;</span>,<span class="hljs-string">&quot;/webjars/**&quot;</span>,<span class="hljs-string">&quot;/swagger-resources&quot;</span>,<span class="hljs-string">&quot;/v2/api-docs&quot;</span>); <span class="hljs-comment">//放行的请求</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>处理静态资源的映射</p>
<pre><code class="hljs">registry.addResourceHandler(&quot;doc.html&quot;).addResourceLocations(&quot;classpath:/META-INF/resources/&quot;);
    registry.addResourceHandler(&quot;/webjars/**&quot;).addResourceLocations(&quot;classpath:/META-INF/resources/webjars/&quot;);
</code></pre>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//配置静态资源的映射</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addResourceHandlers</span><span class="hljs-params">(ResourceHandlerRegistry registry)</span> &#123;<br>    log.info(<span class="hljs-string">&quot;开始进行静态资源映射&quot;</span>);<br>    <span class="hljs-comment">//这个的意思是  /backend/**请求对应到 类路径下的backend文件夹下的资源</span><br>    registry.addResourceHandler(<span class="hljs-string">&quot;/backend/**&quot;</span>).addResourceLocations(<span class="hljs-string">&quot;classpath:backend/&quot;</span>);<br>    registry.addResourceHandler(<span class="hljs-string">&quot;/front/**&quot;</span>).addResourceLocations(<span class="hljs-string">&quot;classpath:front/&quot;</span>);<br>    registry.addResourceHandler(<span class="hljs-string">&quot;doc.html&quot;</span>).addResourceLocations(<span class="hljs-string">&quot;classpath:/META-INF/resources/&quot;</span>);<br>    registry.addResourceHandler(<span class="hljs-string">&quot;/webjars/**&quot;</span>).addResourceLocations(<span class="hljs-string">&quot;classpath:/META-INF/resources/webjars/&quot;</span>);<br>&#125;<br><br></code></pre></td></tr></table></figure>



<p>然后启动项目访问localhost:8081&#x2F;doc.html</p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212162135502.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221216213532513"></p>
<p>这里可以把接口文档转换为各种离线形式的文件，也可以把这些文件导入到apifox中管理这些接口</p>
<p>上面中有一个Swagger Models这个就是数据模型，能检测到所有方法的返回对象</p>
<h2 id="Swagger常用注解"><a href="#Swagger常用注解" class="headerlink" title="Swagger常用注解"></a>Swagger常用注解</h2><p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212162150995.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221216215055058"></p>
<p>@ApiModel这些东西加在对应的地方，在生成的文档里他们的名字都会是注解中value的值</p>
<p>作用在Controller类上的要这么用</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@Api(tags=<span class="hljs-string">&quot;套餐相关接口&quot;</span>)</span><br></code></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//分页查询功能的实现</span><br><span class="hljs-comment">//这个和之前那个菜品类型管理的分页查询功能类似</span><br><span class="hljs-meta">@ApiOperation(&quot;套餐分页查询接口&quot;)</span><br><span class="hljs-meta">@ApiImplicitParams(&#123;</span><br><span class="hljs-meta">        //name中的page和方法参数中page名字相同，value是说明作用，required说明这个参数是否必须</span><br><span class="hljs-meta">        @ApiImplicitParam(name=&quot;page&quot;,value=&quot;页码&quot;,required = true),</span><br><span class="hljs-meta">        @ApiImplicitParam(name=&quot;pageSize&quot;,value=&quot;每页记录数&quot;,required = true),</span><br><span class="hljs-meta">        @ApiImplicitParam(name=&quot;name&quot;,value=&quot;套餐名称&quot;,required = false)</span><br><span class="hljs-meta">&#125;)</span><br><span class="hljs-meta">@GetMapping(&quot;/page&quot;)</span><br><span class="hljs-keyword">public</span> R&lt;Page&gt; <span class="hljs-title function_">page</span><span class="hljs-params">(<span class="hljs-type">int</span> page, <span class="hljs-type">int</span> pageSize, String name)</span>&#123;<br></code></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ApiModel(&quot;套餐&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Setmeal</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br></code></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ApiModel(&quot;套餐&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Setmeal</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">1L</span>;<br><br>    <span class="hljs-keyword">private</span> Long id;<br><br><br>    <span class="hljs-comment">//分类id</span><br>    <span class="hljs-keyword">private</span> Long categoryId;<br><br><br>    <span class="hljs-comment">//套餐名称</span><br>    <span class="hljs-meta">@ApiModelProperty(&quot;套餐名称&quot;)</span><br>    <span class="hljs-keyword">private</span> String name;<br></code></pre></td></tr></table></figure>

<h1 id="项目部署"><a href="#项目部署" class="headerlink" title="项目部署"></a>项目部署</h1><p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212170931866.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221217093112542"></p>
<h2 id="前端项目的部署"><a href="#前端项目的部署" class="headerlink" title="前端项目的部署"></a>前端项目的部署</h2><p>1.把dist包传到html目录下</p>
<p>dist目录就是打包的前端项目，虽然我不知道是怎么打包的</p>
<p>2.修改Nginx配置文件nginx.conf</p>
<p>请求 URL: </p>
<p><img src="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202212171039082.png" srcset="https://zhao1129.oss-cn-qingdao.aliyuncs.com/img/202209301019837.jpeg" lazyload alt="image-20221217103924578"></p>
<p>把root设为html&#x2F;dist 默认访问&#x2F; 时访问的是html&#x2F;dist&#x2F;index.html</p>
<p>没有反向代理时候的url，39.105.5.187:80就是下面这个其实就是nginx服务的端口和ip</p>
<p><a target="_blank" rel="noopener" href="http://39.105.5.187/api/employee/login,%E5%9C%A8nginx%E4%B8%AD%E8%BF%99%E7%A7%8D%E8%AF%B7%E6%B1%82%E6%80%BB%E6%98%AF%E4%BC%9A%E5%8A%A0%E4%B8%8A%E7%B1%BB%E4%BC%BCapi%E8%BF%99%E7%A7%8D%E5%89%8D%E7%BC%80">http://39.105.5.187/api/employee/login,在nginx中这种请求总是会加上类似api这种前缀</a></p>
<p>下面是反向代理的设置  ^~ &#x2F;api&#x2F;可以匹配上面这种类型的请求，</p>
<p>然后rewrite  (.*)匹配到employee&#x2F;login            $1可以引用employee&#x2F;login      然后设置源地址服务器为<a target="_blank" rel="noopener" href="http://39.105.5.187:8080/">http://39.105.5.187:8080</a></p>
<p><strong>前端这个地方只部署了后台管理那个，客户端应该是在小程序上部署</strong></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>瑞吉外卖项目</div>
      <div>http://example.com/2022/09/29/瑞吉外卖项目/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>John Doe</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>September 29, 2022</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>Licensed under</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/09/29/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" title="数据结构与算法">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">数据结构与算法</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/09/29/redis%E5%85%A5%E9%97%A8/" title="Redis基础">
                        <span class="hidden-mobile">Redis基础</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;Table of Contents</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    
      <script  src="/js/img-lazyload.js" ></script>
    
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":true},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
